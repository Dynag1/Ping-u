<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Ping √º</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        /* ============ Sidebar Layout ============ */
        .app-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .sidebar {
            width: 260px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .sidebar-menu-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            color: #555;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
        }

        .sidebar-menu-item:hover {
            background: rgba(102, 126, 234, 0.1);
            border-left-color: #667eea;
            color: #667eea;
        }

        .sidebar-menu-item.active {
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.15) 0%, transparent 100%);
            border-left-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .sidebar-menu-item .icon {
            font-size: 20px;
            min-width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        .main-content-full {
            width: 100%;
            margin-top: 20px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .app-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
                max-height: none;
            }

            .sidebar-menu {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .sidebar-menu-item {
                padding: 12px 15px;
                border-radius: 8px;
                border-left: none;
                text-align: center;
                justify-content: center;
            }

            .sidebar-menu-item.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Language selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .lang-selector label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 600;
        }

        .lang-selector select {
            background: transparent;
            border: none;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 4px;
        }

        .lang-selector select:focus {
            outline: none;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-info {
            background: #3b82f6;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            font-size: 22px;
            margin-bottom: 20px;
        }

        /* ===== Sections Collapsibles ===== */
        .collapsible-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
            margin-bottom: 0;
        }

        .collapsible-section:hover {
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px 22px;
            cursor: pointer;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-bottom: 1px solid transparent;
            transition: all 0.3s ease;
            user-select: none;
        }

        .collapsible-header:hover {
            background: linear-gradient(135deg, #f1f5f9 0%, #f8fafc 100%);
        }

        .collapsible-section.open .collapsible-header {
            border-bottom: 1px solid #e5e7eb;
        }

        .collapsible-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .collapsible-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }

        .editable-title-container {
            display: inline-flex;
            align-items: center;
        }

        .editable-title {
            cursor: pointer;
            border-bottom: 1px dashed transparent;
            transition: all 0.2s;
            margin: 0;
            display: block;
        }

        .editable-title:hover {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .editable-title-input {
            font-family: inherit;
            font-size: 22px;
            font-weight: bold;
            color: #1f2937;
            border: 2px solid #667eea;
            border-radius: 4px;
            padding: 2px 8px;
            background: white;
            outline: none;
            width: auto;
            min-width: 250px;
        }

        .collapsible-icon.add-hosts {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }

        .collapsible-icon.monitoring {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }

        .collapsible-icon.alerts {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        }

        .collapsible-icon.actions {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }

        .collapsible-icon.sites {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
        }

        .collapsible-icon.advanced {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
        }

        .collapsible-title h2 {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
            color: #1f2937;
        }

        .collapsible-title p {
            margin: 2px 0 0;
            font-size: 12px;
            color: #9ca3af;
        }

        .collapsible-toggle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .collapsible-section.open .collapsible-toggle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: rotate(180deg);
        }

        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, padding 0.3s ease;
            padding: 0 22px;
        }

        .collapsible-section.open .collapsible-content {
            max-height: 2000px;
            padding: 20px 22px;
        }

        .collapsible-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        .hosts-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .hosts-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .hosts-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hosts-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }

        .hosts-table tr:hover {
            background: #f9fafb;
        }

        .host-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .host-status.online {
            background: #d1fae5;
            color: #065f46;
        }

        .host-status.offline {
            background: #fee2e2;
            color: #991b1b;
        }

        .latency-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            min-width: 70px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .latency-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .latency-badge.excellent {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .latency-badge.good {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .latency-badge.warning {
            background: linear-gradient(135deg, #fed7aa 0%, #fdba74 100%);
            color: #9a3412;
            border: 1px solid #fb923c;
        }

        .latency-badge.critical {
            background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
            color: #991b1b;
            border: 1px solid #f87171;
        }

        .latency-badge.offline {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #991b1b;
            border: 1px solid #9ca3af;
            font-weight: 700;
        }

        .host-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 6px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-indicator.running {
            background: #d1fae5;
            color: #065f46;
        }

        .status-indicator.stopped {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.running {
            background: #10b981;
        }

        .status-dot.stopped {
            background: #ef4444;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #6b7280;
            font-size: 14px;
        }

        .stat-card.total .value {
            color: #3b82f6;
        }

        .stat-card.online .value {
            color: #10b981;
        }

        .stat-card.offline .value {
            color: #ef4444;
        }

        .stat-card.monitoring .value {
            color: #8b5cf6;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.info {
            background: #3b82f6;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .accordion {
            margin-bottom: 10px;
        }

        .accordion-header {
            background: #f3f4f6;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            font-weight: 600;
            color: #374151;
        }

        .accordion-header:hover {
            background: #e5e7eb;
        }

        .accordion-header.active {
            background: #667eea;
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .accordion-content {
            display: none;
            padding: 20px;
            background: #f9fafb;
            border-radius: 0 0 8px 8px;
            margin-bottom: 10px;
        }

        .accordion-content.active {
            display: block;
        }

        .accordion-icon {
            transition: transform 0.3s;
        }

        .accordion-icon.active {
            transform: rotate(180deg);
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        /* ==================== Menu Hamburger & Panneau Lat√©ral ==================== */

        /* Overlay sombre */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Menu lat√©ral */
        .side-menu {
            position: fixed;
            top: 0;
            left: -360px;
            width: 340px;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: 4px 0 30px rgba(0, 0, 0, 0.15);
            z-index: 999;
            transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .side-menu.active {
            left: 0;
        }

        .side-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .side-menu-header h2 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
        }

        .close-menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* Sections du menu */
        .menu-section {
            padding: 18px 25px;
            border-bottom: 1px solid #e5e7eb;
        }

        .menu-section:last-child {
            border-bottom: none;
        }

        .menu-section-title {
            font-size: 13px;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Boutons d'action dans le menu */
        .menu-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .menu-actions .btn {
            width: 100%;
            justify-content: flex-start;
            padding: 12px 18px;
            border-radius: 10px;
        }

        /* Statut dans le menu */
        .menu-section .status-indicator {
            width: 100%;
            justify-content: center;
        }

        /* Lang selector dans le menu */
        .menu-section .lang-selector {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            background: #f3f4f6;
        }

        .menu-section .lang-selector select {
            width: 100%;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 14px;
            background: white;
        }

        /* Header minimaliste */
        .header-minimal {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .main-title {
            color: #333;
            font-size: 26px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            margin: 0;
        }

        /* Bouton hamburger */
        .hamburger-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            flex-shrink: 0;
        }

        .hamburger-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .hamburger-line {
            width: 24px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 6px);
        }

        .hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
            transform: scaleX(0);
        }

        .hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -7px);
        }

        /* Header mini info */
        .header-mini-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-mini-info .status-indicator {
            padding: 6px 14px;
            font-size: 13px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-minimal {
                padding: 12px 15px;
                gap: 12px;
            }

            .main-title {
                font-size: 18px;
            }

            .hamburger-btn {
                width: 42px;
                height: 42px;
            }

            .side-menu {
                width: 300px;
                left: -320px;
            }
        }

        /* Navigation items dans le menu */
        .menu-nav {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .menu-nav-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 10px;
            color: #555;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
            background: #f9fafb;
        }

        .menu-nav-item:hover {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
        }

        .menu-nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .menu-nav-item .icon {
            font-size: 18px;
            min-width: 24px;
            text-align: center;
        }

        /* ==================== Page Accueil ==================== */
        .home-welcome {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .welcome-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .welcome-header h2 {
            font-size: 32px;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .welcome-header p {
            font-size: 16px;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
        }

        .home-quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .quick-stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .quick-stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .quick-stat-card.online {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        .quick-stat-card.offline {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
        }

        .quick-stat-icon {
            font-size: 40px;
        }

        .quick-stat-info {
            display: flex;
            flex-direction: column;
        }

        .quick-stat-value {
            font-size: 36px;
            font-weight: 800;
            color: #1f2937;
        }

        .quick-stat-card.online .quick-stat-value {
            color: #059669;
        }

        .quick-stat-card.offline .quick-stat-value {
            color: #dc2626;
        }

        .quick-stat-label {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .home-shortcuts {
            text-align: center;
        }

        .home-shortcuts h3 {
            font-size: 20px;
            color: #374151;
            margin-bottom: 20px;
        }

        .shortcut-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
        }

        .shortcut-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 25px 30px;
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
            min-width: 140px;
        }

        .shortcut-btn:hover {
            border-color: #667eea;
            background: linear-gradient(145deg, #ffffff 0%, #ede9fe 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
        }

        .shortcut-icon {
            font-size: 32px;
        }

        @media (max-width: 768px) {
            .home-welcome {
                padding: 25px;
            }

            .welcome-header h2 {
                font-size: 24px;
            }

            .quick-stat-card {
                padding: 20px;
            }

            .quick-stat-value {
                font-size: 28px;
            }

            .shortcut-btn {
                padding: 20px;
                min-width: 120px;
            }
        }
    </style>
</head>

<body>
    <!-- Overlay sombre pour fermer le menu -->
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>

    <!-- Menu lat√©ral (slide-in) -->
    <div class="side-menu" id="side-menu">
        <div class="side-menu-header">
            <h2 data-i18n="menu">Menu</h2>
            <button class="close-menu-btn" onclick="toggleMenu()">‚úï</button>
        </div>

        <!-- Section Langue -->
        <div class="menu-section">
            <div class="menu-section-title">üåç <span data-i18n="language">Langue</span></div>
            <div class="lang-selector">
                <select id="lang-select" onchange="changeLanguage(this.value)">
                    <option value="fr">Fran√ßais</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>

        <!-- Section Statut -->
        <div class="menu-section">
            <div class="menu-section-title">üìä <span data-i18n="status">Statut</span></div>
            <div class="status-indicator" id="monitoring-status">
                <span class="status-dot stopped"></span>
                <span data-i18n="status_stopped">Arr√™t√©</span>
            </div>
        </div>

        <!-- Section Actions principales -->
        <div class="menu-section">
            <div class="menu-section-title">üéõÔ∏è <span data-i18n="actions">Actions</span></div>
            <div class="menu-actions">
                <!-- Bouton unique Start/Stop qui change selon l'√©tat -->
                <button id="btn-toggle-monitoring" class="btn btn-primary">
                    <span id="btn-toggle-icon">‚ñ∂Ô∏è</span> <span id="btn-toggle-text" data-i18n="start">D√©marrer</span>
                </button>
                <button id="btn-change-password" class="btn btn-info">üîë <span data-i18n="change_credentials">Changer
                        identifiants</span></button>
            </div>
        </div>

        <!-- Section Pages (ancienne sidebar) -->
        <div class="menu-section">
            <div class="menu-section-title">üìë <span data-i18n="sections">Sections</span></div>
            <nav class="menu-nav">
                <div class="menu-nav-item active" data-section="accueil" onclick="switchSection('accueil')">
                    <span class="icon">üè†</span>
                    <span data-i18n="menu_home">Accueil</span>
                </div>
                <div class="menu-nav-item" data-section="ajout" onclick="switchSection('ajout')">
                    <span class="icon">üìç</span>
                    <span data-i18n="menu_add">Ajout</span>
                </div>
                <div class="menu-nav-item" data-section="sites" onclick="switchSection('sites')">
                    <span class="icon">üè¢</span>
                    <span data-i18n="menu_sites">Gestion des sites</span>
                </div>
                <div class="menu-nav-item" data-section="advanced" onclick="switchSection('advanced')">
                    <span class="icon">‚öôÔ∏è</span>
                    <span data-i18n="menu_advanced">Param√®tres avanc√©s</span>
                </div>
                <div class="menu-nav-item" data-section="configuration" onclick="switchSection('configuration')">
                    <span class="icon">üéõÔ∏è</span>
                    <span data-i18n="menu_config">Configuration</span>
                </div>
            </nav>
        </div>

        <!-- Section Navigation -->
        <div class="menu-section">
            <div class="menu-section-title">üîó <span data-i18n="navigation">Navigation</span></div>
            <div class="menu-actions">
                <a href="/" class="btn btn-secondary">üìä <span data-i18n="monitoring_view">Vue Monitoring</span></a>
                <button id="btn-logout" class="btn btn-danger">üö™ <span data-i18n="logout">D√©connexion</span></button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header minimaliste avec bouton hamburger -->
        <div class="header-minimal">
            <button class="hamburger-btn" id="hamburger-btn" onclick="toggleMenu()" title="Menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <h1 class="main-title">
                ‚öôÔ∏è <span data-i18n="admin_title">Administration - Ping √º</span>
            </h1>
            <!-- Mini statut visible dans le header -->
            <div class="header-mini-info">
                <div class="status-indicator" id="monitoring-status-mini">
                    <span class="status-dot stopped"></span>
                    <span data-i18n="status_stopped">Arr√™t√©</span>
                </div>
            </div>
        </div>

        <!-- Modal Gestion des Utilisateurs -->
        <div id="modal-change-password"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
            <div
                style="background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <h2 style="margin-bottom: 20px; color: #333;" data-i18n="manage_users_title">üë• Gestion des Utilisateurs
                </h2>

                <!-- Onglets -->
                <div class="user-tabs"
                    style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; padding-bottom: 10px;">
                    <button type="button" class="user-tab active" data-tab="admin" onclick="switchUserTab('admin')"
                        style="padding: 10px 20px; border: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üëë <span data-i18n="admin_user">Administrateur</span>
                    </button>
                    <button type="button" class="user-tab" data-tab="user" onclick="switchUserTab('user')"
                        style="padding: 10px 20px; border: 1px solid #e5e7eb; background: white; color: #374151; border-radius: 8px; cursor: pointer; font-weight: 600;">
                        üë§ <span data-i18n="standard_user">Utilisateur</span>
                    </button>
                </div>

                <!-- Formulaire Admin -->
                <div id="tab-admin" class="user-tab-content">
                    <div
                        style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <p style="margin: 0; color: #667eea; font-size: 14px;">
                            <strong>üëë <span data-i18n="admin_role">R√¥le Admin</span></strong> - <span
                                data-i18n="admin_role_desc">Acc√®s complet √† l'administration</span>
                        </p>
                    </div>
                    <form id="form-change-password">
                        <div class="form-group">
                            <label data-i18n="current_password">Mot de passe actuel</label>
                            <input type="password" id="old-password" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="new_username">Nouveau nom d'utilisateur</label>
                            <input type="text" id="new-username" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="new_password">Nouveau mot de passe</label>
                            <input type="password" id="new-password" required>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ <span
                                    data-i18n="save">Enregistrer</span></button>
                            <button type="button" id="btn-cancel-change" class="btn btn-secondary" style="flex: 1;">‚ùå
                                <span data-i18n="cancel">Annuler</span></button>
                        </div>
                    </form>
                </div>

                <!-- Formulaire User -->
                <div id="tab-user" class="user-tab-content" style="display: none;">
                    <div
                        style="background: linear-gradient(135deg, #10b98122 0%, #059d6e22 100%); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                        <p style="margin: 0; color: #059669; font-size: 14px;">
                            <strong>üë§ <span data-i18n="user_role">R√¥le Utilisateur</span></strong> - <span
                                data-i18n="user_role_desc">Acc√®s √† la vue monitoring uniquement</span>
                        </p>
                    </div>
                    <form id="form-change-user-password">
                        <div class="form-group">
                            <label data-i18n="new_username">Nom d'utilisateur</label>
                            <input type="text" id="user-new-username" required>
                        </div>
                        <div class="form-group">
                            <label data-i18n="new_password">Mot de passe</label>
                            <input type="password" id="user-new-password" required>
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 20px;">
                            <button type="submit" class="btn btn-success" style="flex: 1;">üíæ <span
                                    data-i18n="save">Enregistrer</span></button>
                            <button type="button" class="btn btn-secondary" onclick="closeUserModal()"
                                style="flex: 1;">‚ùå <span data-i18n="cancel">Annuler</span></button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <style>
            /* ===== Sites Management Premium Styles ===== */
            .sites-collapsible {
                margin-bottom: 25px;
                border: 1px solid rgba(102, 126, 234, 0.15);
            }

            .sites-collapsible::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #667eea);
                background-size: 300% 100%;
                animation: gradientShift 8s ease infinite;
            }

            @keyframes gradientShift {

                0%,
                100% {
                    background-position: 0% 50%;
                }

                50% {
                    background-position: 100% 50%;
                }
            }

            .sites-content {
                background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            }

            .add-site-form {
                display: flex;
                gap: 10px;
                align-items: center;
            }

            .site-input {
                padding: 12px 18px;
                border-radius: 25px;
                border: 2px solid #e5e7eb;
                font-size: 14px;
                width: 200px;
                transition: all 0.3s ease;
                background: white;
            }

            .site-input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            }

            .add-site-btn {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 12px 24px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 25px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .add-site-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            }

            .btn-icon {
                font-size: 16px;
            }

            /* Grille des cartes de contr√¥le */
            .sites-controls-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
            }

            .site-control-card {
                background: white;
                border-radius: 16px;
                padding: 20px;
                border: 1px solid #e5e7eb;
                transition: all 0.3s ease;
            }

            .site-control-card:hover {
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
                transform: translateY(-2px);
            }

            .filter-card {
                border-left: 4px solid #3b82f6;
            }

            .monitor-card {
                border-left: 4px solid #10b981;
            }

            .control-card-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 15px;
            }

            .control-icon {
                width: 42px;
                height: 42px;
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
            }

            .filter-icon {
                background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            }

            .monitor-icon {
                background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            }

            .control-info h3 {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
                color: #1f2937;
            }

            .control-info p {
                margin: 2px 0 0;
                font-size: 12px;
                color: #9ca3af;
            }

            .control-card-body {
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .site-multiselect {
                width: 100%;
                min-height: 80px;
                padding: 10px;
                border: 2px solid #e5e7eb;
                border-radius: 12px;
                font-size: 13px;
                background: #f9fafb;
                transition: all 0.3s ease;
            }

            .site-multiselect:focus {
                outline: none;
                border-color: #667eea;
                background: white;
            }

            .site-multiselect option {
                padding: 8px 12px;
                border-radius: 6px;
                margin: 2px 0;
            }

            .site-multiselect option:checked {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }

            .control-actions {
                display: flex;
                gap: 10px;
            }

            .control-btn {
                flex: 1;
                padding: 10px 15px;
                border-radius: 10px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s ease;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 6px;
            }

            .apply-btn {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
            }

            .apply-btn:hover {
                transform: scale(1.02);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            }

            .reset-btn {
                background: white;
                color: #6b7280;
                border: 2px solid #e5e7eb;
            }

            .reset-btn:hover {
                background: #f3f4f6;
                border-color: #d1d5db;
            }

            /* Section liste des sites */
            .sites-list-section {
                background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
                border-radius: 16px;
                padding: 20px;
            }

            .sites-list-header {
                margin-bottom: 15px;
            }

            .sites-count-badge {
                display: inline-flex;
                align-items: center;
                padding: 6px 14px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }

            .sites-tags-container {
                display: flex;
                flex-wrap: wrap;
                gap: 12px;
                min-height: 50px;
            }

            .site-tag-premium {
                display: inline-flex;
                align-items: center;
                gap: 10px;
                padding: 10px 18px;
                background: white;
                border-radius: 25px;
                font-size: 14px;
                font-weight: 600;
                color: #1f2937;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
                border: 1px solid #e5e7eb;
                transition: all 0.3s ease;
                animation: fadeInUp 0.4s ease;
            }

            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .site-tag-premium:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
                border-color: #667eea;
            }

            .site-tag-icon {
                width: 28px;
                height: 28px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 14px;
            }

            .site-tag-name {
                color: #374151;
            }

            .site-tag-delete {
                width: 24px;
                height: 24px;
                border-radius: 50%;
                background: #fee2e2;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 12px;
                transition: all 0.2s ease;
                margin-left: 5px;
            }

            .site-tag-delete:hover {
                background: #fecaca;
                transform: scale(1.1);
            }

            .no-sites-message {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 30px;
                color: #9ca3af;
                text-align: center;
            }

            .no-sites-message .empty-icon {
                font-size: 40px;
                margin-bottom: 10px;
                opacity: 0.5;
            }

            .no-sites-message p {
                margin: 0;
                font-size: 14px;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .sites-header {
                    flex-direction: column;
                    align-items: stretch;
                }

                .add-site-form {
                    width: 100%;
                }

                .site-input {
                    flex: 1;
                }

                .sites-controls-grid {
                    grid-template-columns: 1fr;
                }
            }
        </style>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="value" id="stat-total">0</div>
                <div class="label" data-i18n="total_hosts">Total H√¥tes</div>
            </div>
            <div class="stat-card online">
                <div class="value" id="stat-online">0</div>
                <div class="label" data-i18n="online">En ligne</div>
            </div>
            <div class="stat-card offline">
                <div class="value" id="stat-offline">0</div>
                <div class="label" data-i18n="offline">Hors ligne</div>
            </div>
            <div class="stat-card monitoring">
                <div class="value" id="stat-delai">0</div>
                <div class="label" data-i18n="delay_sec">D√©lai (sec)</div>
            </div>
        </div>

        <!-- Main Content (sans sidebar, navigation dans le menu hamburger) -->
        <div class="main-content-full">
            <!-- Section: Accueil (visible par d√©faut) -->
            <div id="content-accueil" class="content-section active">
                <!-- La page d'accueil affiche directement la liste des h√¥tes monitor√©s -->
            </div>

            <!-- Section: Ajout -->
            <div id="content-ajout" class="content-section">
                <div class="collapsible-grid">
                    <!-- Ajout d'IP -->
                    <div class="collapsible-section" id="section-add-hosts">
                        <div class="collapsible-header" onclick="toggleSection('section-add-hosts')">
                            <div class="collapsible-title">
                                <div class="collapsible-icon add-hosts">‚ûï</div>
                                <div>
                                    <h2 data-i18n="add_hosts">Ajout d'H√¥tes</h2>
                                    <p data-i18n="add_hosts_desc">Scanner et ajouter des h√¥tes</p>
                                </div>
                            </div>
                            <div class="collapsible-toggle">‚ñº</div>
                        </div>
                        <div class="collapsible-content">
                            <form id="form-add-hosts">
                                <div class="form-group">
                                    <label for="input-ip" data-i18n="base_ip">Adresse IP de base</label>
                                    <input type="text" id="input-ip" placeholder="192.168.1.1" required>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="input-hosts" data-i18n="hosts_count">Nombre d'h√¥tes</label>
                                        <input type="number" id="input-hosts" value="1" min="1" max="255">
                                    </div>
                                    <div class="form-group">
                                        <label for="input-port">Port</label>
                                        <input type="text" id="input-port" value="80">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="select-scan-type" data-i18n="scan_type">Type de scan</label>
                                        <select id="select-scan-type">
                                            <option value="alive" data-i18n="scan_alive">Alive (actifs uniquement)
                                            </option>
                                            <option value="all" data-i18n="scan_all">Tous les h√¥tes</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="select-scan-site" data-i18n="assign_to_site">Assigner au
                                            site</label>
                                        <select id="select-scan-site" class="scan-site-select">
                                            <option value="" data-i18n="no_site">- Aucun -</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%;">
                                    üîç <span data-i18n="scan_hosts">Scanner les h√¥tes</span>
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Scanner R√©seau -->
                    <div class="collapsible-section" id="section-network-scan">
                        <div class="collapsible-header" onclick="toggleSection('section-network-scan')">
                            <div class="collapsible-title">
                                <div class="collapsible-icon"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üîç</div>
                                <div>
                                    <h2 data-i18n="network_scanner">Scanner R√©seau</h2>
                                    <p data-i18n="network_scanner_desc">D√©couvrir automatiquement les p√©riph√©riques
                                    </p>
                                </div>
                            </div>
                            <div class="collapsible-toggle">‚ñº</div>
                        </div>
                        <div class="collapsible-content">
                            <div style="display: flex; flex-direction: column; gap: 20px;">
                                <!-- S√©lection des types de scan -->
                                <div class="form-group">
                                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">
                                        üéØ <span data-i18n="scan_types">Types de scan</span>
                                    </label>
                                    <div
                                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;">
                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-hik" value="hik" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üìπ Hikvision</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-dahua" value="dahua" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üìπ Dahua</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-onvif" value="onvif" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üìπ ONVIF</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-samsung" value="samsung" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üìπ Samsung</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-avigilon" value="avigilon" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üìπ Avigilon</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-upnp" value="upnp" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üåê UPnP</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-snmp" value="snmp" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üñ•Ô∏è Serveur</span>
                                        </label>

                                        <label class="scan-option-card"
                                            style="display: flex; align-items: center; padding: 12px 15px; border-radius: 10px; border: 1px solid #e2e8f0; background: rgba(255,255,255,0.8); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                            <input type="checkbox" id="scan-type-ups" value="ups" checked
                                                style="width: 18px; height: 18px; cursor: pointer; accent-color: #667eea; margin-right: 12px;">
                                            <span style="font-weight: 500; font-size: 15px;">üîã Onduleur</span>
                                        </label>
                                    </div>
                                </div>

                                <!-- Boutons de contr√¥le -->
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button id="btn-start-scan" class="btn btn-primary" style="flex: 0 0 auto;">
                                        üîç <span data-i18n="start_scan">D√©marrer le scan</span>
                                    </button>
                                    <button id="btn-stop-scan" class="btn btn-danger"
                                        style="flex: 0 0 auto; display: none;">
                                        ‚èπÔ∏è <span data-i18n="stop_scan">Arr√™ter</span>
                                    </button>
                                    <div id="scan-progress"
                                        style="display: none; flex: 1; font-size: 14px; color: var(--text-secondary);">
                                        <span id="scan-status-text">Scan en cours...</span>
                                        <span id="scan-devices-count" style="margin-left: 10px; font-weight: 600;">0
                                            p√©riph√©rique(s)</span>
                                    </div>
                                </div>

                                <!-- Tableau des r√©sultats -->
                                <div id="scan-results-container" style="display: none;">
                                    <h3 style="margin: 0 0 15px 0; font-size: 16px; color: var(--text-primary);">
                                        üì° <span data-i18n="scan_results">R√©sultats du scan</span>
                                    </h3>
                                    <div
                                        style="overflow-x: auto; border-radius: 8px; border: 1px solid var(--border-color);">
                                        <table class="hosts-table" id="scan-results-table">
                                            <thead>
                                                <tr>
                                                    <th data-i18n="ip">IP</th>
                                                    <th data-i18n="type">Type</th>
                                                    <th data-i18n="manufacturer">Fabricant</th>
                                                    <th data-i18n="model">Mod√®le</th>
                                                    <th data-i18n="name">Nom</th>
                                                    <th data-i18n="protocol">Protocole</th>
                                                    <th data-i18n="actions">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="scan-results-body">
                                                <!-- Les r√©sultats seront ajout√©s ici -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- Fin collapsible-grid ajout -->
            </div><!-- Fin content-ajout -->
            <!-- Section: Sites -->
            <div id="content-sites" class="content-section">
                <!-- Gestion des Sites - Design Premium Collapsible -->
                <div class="collapsible-section open sites-collapsible" id="section-sites">
                    <div class="collapsible-header" onclick="toggleSection('section-sites')">
                        <div class="collapsible-title">
                            <div class="collapsible-icon sites">üè¢</div>
                            <div>
                                <h2 data-i18n="sites_management">Gestion des Sites</h2>
                                <p data-i18n="sites_subtitle">Organisez vos h√¥tes par localisation</p>
                            </div>
                        </div>
                        <div class="collapsible-toggle">‚ñº</div>
                    </div>
                    <div class="collapsible-content sites-content">
                        <!-- Ajout rapide de site -->
                        <div class="add-site-form" style="margin-bottom: 20px;">
                            <input type="text" id="input-new-site" placeholder="Nom du nouveau site..."
                                class="site-input">
                            <button onclick="addSite()" class="add-site-btn">
                                <span class="btn-icon">‚ú®</span>
                                <span data-i18n="add_site">Cr√©er</span>
                            </button>
                        </div>

                        <!-- Cartes de contr√¥le -->
                        <div class="sites-controls-grid">
                            <!-- Carte Filtre d'affichage -->
                            <div class="site-control-card filter-card">
                                <div class="control-card-header">
                                    <div class="control-icon filter-icon">üëÅÔ∏è</div>
                                    <div class="control-info">
                                        <h3 data-i18n="display_filter">Affichage</h3>
                                        <p data-i18n="filter_desc">Sites visibles dans le tableau</p>
                                    </div>
                                </div>
                                <div class="control-card-body">
                                    <select id="select-site-filter" multiple class="site-multiselect">
                                    </select>
                                    <div class="control-actions">
                                        <button onclick="applySiteFilter()" class="control-btn apply-btn">
                                            <span>‚úì</span> <span data-i18n="apply">Appliquer</span>
                                        </button>
                                        <button onclick="clearSiteFilter()" class="control-btn reset-btn">
                                            <span data-i18n="show_all">Tout afficher</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Carte Sites √† surveiller -->
                            <div class="site-control-card monitor-card">
                                <div class="control-card-header">
                                    <div class="control-icon monitor-icon">üì°</div>
                                    <div class="control-info">
                                        <h3 data-i18n="monitor_sites">Surveillance</h3>
                                        <p data-i18n="monitor_desc">Sites √† pinger activement</p>
                                    </div>
                                </div>
                                <div class="control-card-body">
                                    <select id="select-sites-actifs" multiple class="site-multiselect">
                                    </select>
                                    <div class="control-actions">
                                        <button onclick="applySitesActifs()" class="control-btn apply-btn">
                                            <span>‚úì</span> <span data-i18n="apply">Appliquer</span>
                                        </button>
                                        <button onclick="clearSitesActifs()" class="control-btn reset-btn">
                                            <span data-i18n="monitor_all">Tout surveiller</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Liste des sites cr√©√©s -->
                        <div class="sites-list-section">
                            <div class="sites-list-header">
                                <span class="sites-count-badge" id="sites-count-badge">0 sites</span>
                            </div>
                            <div id="sites-list" class="sites-tags-container">
                                <!-- Sites g√©n√©r√©s dynamiquement -->
                            </div>
                        </div>
                    </div><!-- Fin collapsible-content -->
                </div><!-- Fin collapsible-section sites -->
            </div><!-- Fin content-sites -->

            <!-- Section: Advanced -->
            <div id="content-advanced" class="content-section">
                <!-- Param√®tres Avanc√©s -->
                <div class="collapsible-section" id="section-advanced" style="margin-bottom: 25px;">
                    <div class="collapsible-header" onclick="toggleSection('section-advanced')">
                        <div class="collapsible-title">
                            <div class="collapsible-icon advanced">‚öôÔ∏è</div>
                            <div>
                                <div class="editable-title-container" onclick="event.stopPropagation()">
                                    <h2 id="advanced-settings-title" class="editable-title"
                                        onclick="editSectionTitle('advanced-settings-title')"
                                        data-i18n="advanced_settings">
                                        Param√®tres Avanc√©s</h2>
                                    <input type="text" id="advanced-settings-title-input" class="editable-title-input"
                                        style="display: none;" onblur="saveSectionTitle('advanced-settings-title')"
                                        onkeydown="if(event.key==='Enter') saveSectionTitle('advanced-settings-title')">
                                </div>
                                <p data-i18n="advanced_settings_desc">Configuration SMTP, Telegram et syst√®me</p>
                            </div>
                        </div>
                        <div class="collapsible-toggle">‚ñº</div>
                    </div>
                    <div class="collapsible-content">

                        <!-- Configuration SMTP -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('smtp')">
                                <span>üìß <span data-i18n="smtp_config">Configuration Email (SMTP)</span></span>
                                <span class="accordion-icon" id="icon-smtp">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-smtp">
                                <form id="form-smtp">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="smtp-server" data-i18n="smtp_server">Serveur SMTP</label>
                                            <input type="text" id="smtp-server" placeholder="smtp.gmail.com">
                                        </div>
                                        <div class="form-group">
                                            <label for="smtp-port">Port</label>
                                            <input type="number" id="smtp-port" placeholder="587" value="587">
                                            <small
                                                style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                                                üí° Port 587 (STARTTLS) <span data-i18n="or">ou</span> 465 (SSL/TLS)
                                            </small>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="smtp-email" data-i18n="sender_email">Email exp√©diteur</label>
                                        <input type="email" id="smtp-email" placeholder="votre-email@gmail.com">
                                    </div>
                                    <div class="form-group">
                                        <label for="smtp-password" data-i18n="password">Mot de passe</label>
                                        <input type="password" id="smtp-password"
                                            data-placeholder-i18n="password_placeholder"
                                            placeholder="Mot de passe ou app password">
                                    </div>
                                    <div class="form-group">
                                        <label for="smtp-recipients" data-i18n="recipients">Destinataires (s√©par√©s
                                            par des
                                            virgules)</label>
                                        <input type="text" id="smtp-recipients"
                                            placeholder="email1@exemple.com, email2@exemple.com">
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                                            üíæ <span data-i18n="save">Sauvegarder</span>
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="testSMTP()"
                                            style="flex: 1;">
                                            ‚úâÔ∏è <span data-i18n="test">Tester</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Configuration Telegram -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('telegram')">
                                <span>üì± <span data-i18n="telegram_config">Configuration Telegram</span></span>
                                <span class="accordion-icon" id="icon-telegram">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-telegram">
                                <form id="form-telegram">
                                    <div class="form-group">
                                        <label for="telegram-token" data-i18n="bot_token">Token du Bot</label>
                                        <input type="text" id="telegram-token"
                                            placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                                    </div>
                                    <div class="form-group">
                                        <label for="telegram-chatid">Chat ID</label>
                                        <input type="text" id="telegram-chatid" placeholder="123456789">
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                                            üíæ <span data-i18n="save">Sauvegarder</span>
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="testTelegram()"
                                            style="flex: 1;">
                                            üì≤ <span data-i18n="test">Tester</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Configuration Email R√©capitulatif -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('mailrecap')">
                                <span>üìä <span data-i18n="recap_email_config">Email R√©capitulatif
                                        P√©riodique</span></span>
                                <span class="accordion-icon" id="icon-mailrecap">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-mailrecap">
                                <form id="form-mail-recap">
                                    <div class="form-group">
                                        <label for="recap-heure" data-i18n="send_time">Heure d'envoi</label>
                                        <input type="time" id="recap-heure" value="08:00">
                                    </div>
                                    <div
                                        style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                        <label
                                            style="display: block; margin-bottom: 10px; font-weight: 600; color: #374151;"
                                            data-i18n="send_days">Jours d'envoi</label>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-lundi">
                                                <label for="recap-lundi" data-i18n="monday">Lundi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-mardi">
                                                <label for="recap-mardi" data-i18n="tuesday">Mardi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-mercredi">
                                                <label for="recap-mercredi" data-i18n="wednesday">Mercredi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-jeudi">
                                                <label for="recap-jeudi" data-i18n="thursday">Jeudi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-vendredi">
                                                <label for="recap-vendredi" data-i18n="friday">Vendredi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0;">
                                                <input type="checkbox" id="recap-samedi">
                                                <label for="recap-samedi" data-i18n="saturday">Samedi</label>
                                            </div>
                                            <div class="checkbox-group" style="margin: 0; grid-column: 1 / -1;">
                                                <input type="checkbox" id="recap-dimanche">
                                                <label for="recap-dimanche" data-i18n="sunday">Dimanche</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                                            üíæ <span data-i18n="save">Sauvegarder</span>
                                        </button>
                                        <button type="button" class="btn btn-info" onclick="sendTestRecap()"
                                            style="flex: 1;">
                                            üì® <span data-i18n="send_test">Envoyer un test</span>
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Param√®tres G√©n√©raux -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('general')">
                                <span>üåê <span data-i18n="general_settings">Param√®tres G√©n√©raux</span></span>
                                <span class="accordion-icon" id="icon-general">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-general">
                                <form id="form-general">
                                    <div class="form-group">
                                        <label for="general-site" data-i18n="site_name">Nom du Site</label>
                                        <input type="text" id="general-site" placeholder="Site">
                                    </div>
                                    <div class="form-group">
                                        <label for="general-theme" data-i18n="theme">Th√®me</label>
                                        <select id="general-theme">
                                            <option value="nord">Nord</option>
                                            <option value="dark">Dark</option>
                                            <option value="light">Light</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                                        üíæ <span data-i18n="save">Sauvegarder</span>
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Licence -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('license')">
                                <span>üîë <span data-i18n="license_management">Gestion de Licence</span></span>
                                <span class="accordion-icon" id="icon-license">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-license">
                                <div
                                    style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <span style="font-size: 24px;" id="license-icon">‚ùå</span>
                                        <div>
                                            <div style="font-weight: 600; color: #374151;" id="license-status"
                                                data-i18n="no_license">Pas de licence active</div>
                                            <div style="font-size: 13px; color: #6b7280;" id="license-days"></div>
                                        </div>
                                    </div>
                                    <div style="margin-top: 15px; border-top: 1px solid #e5e7eb; padding-top: 10px;">
                                        <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;"
                                            data-i18n="activation_code_label">Code d'activation (Hardware ID) √†
                                            envoyer :
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <input type="text" id="activation-code" readonly
                                                style="background: #e5e7eb; color: #374151; font-family: monospace; font-size: 14px;"
                                                onclick="this.select()">
                                            <button class="btn btn-secondary btn-small"
                                                onclick="navigator.clipboard.writeText(document.getElementById('activation-code').value); showNotification(t('copied'), 'success')">üìã</button>
                                        </div>
                                    </div>
                                </div>
                                <form id="form-license">
                                    <div class="form-group">
                                        <label for="license-key" data-i18n="license_key">Cl√© de licence</label>
                                        <input type="text" id="license-key" data-placeholder-i18n="enter_license"
                                            placeholder="Entrez votre cl√© de licence">
                                    </div>
                                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                                        üîì <span data-i18n="activate_license">Activer la licence</span>
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Informations Syst√®me -->
                        <div class="accordion">
                            <div class="accordion-header" onclick="toggleAccordion('system')">
                                <span>‚ÑπÔ∏è <span data-i18n="system_info">Informations Syst√®me</span></span>
                                <span class="accordion-icon" id="icon-system">‚ñº</span>
                            </div>
                            <div class="accordion-content" id="content-system">
                                <div style="background: #f3f4f6; padding: 15px; border-radius: 8px;">
                                    <div style="margin-bottom: 10px;">
                                        <strong>Version:</strong> <span id="system-version">-</span>
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <strong>Mode:</strong> <span data-i18n="web_server">Serveur Web</span>
                                    </div>
                                    <div style="margin-bottom: 10px;">
                                        <strong>Port:</strong> <span>9090</span>
                                    </div>
                                    <div>
                                        <strong data-i18n="connected_user">Utilisateur connect√©:</strong> <span
                                            id="system-user">admin</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- Fin collapsible-section advanced -->
            </div><!-- Fin content-advanced -->


            <!-- Section: Configuration -->
            <div id="content-configuration" class="content-section">
                <div class="collapsible-grid">
                    <!-- Contr√¥le du Monitoring -->
                    <div class="collapsible-section open" id="section-monitoring">
                        <div class="collapsible-header" onclick="toggleSection('section-monitoring')">
                            <div class="collapsible-title">
                                <div class="collapsible-icon monitoring">üéÆ</div>
                                <div>
                                    <h2 data-i18n="monitoring_control">Contr√¥le du Monitoring</h2>
                                    <p data-i18n="monitoring_desc">D√©marrer/arr√™ter et configurer</p>
                                </div>
                            </div>
                            <div class="collapsible-toggle">‚ñº</div>
                        </div>
                        <div class="collapsible-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="input-delai" data-i18n="ping_delay">D√©lai entre pings (sec)</label>
                                    <input type="number" id="input-delai" value="10" min="1" max="3600">
                                </div>
                                <div class="form-group">
                                    <label for="input-nb-hs" data-i18n="hs_before_alert">Nombre de HS avant
                                        alerte</label>
                                    <input type="number" id="input-nb-hs" value="3" min="1" max="10">
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button id="btn-start-monitoring" class="btn btn-primary" style="flex: 1;">
                                    ‚ñ∂Ô∏è <span data-i18n="start">D√©marrer</span>
                                </button>
                                <button id="btn-stop-monitoring" class="btn btn-danger" style="flex: 1;">
                                    ‚èπÔ∏è <span data-i18n="stop">Arr√™ter</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Alertes -->
                    <div class="collapsible-section" id="section-alerts">
                        <div class="collapsible-header" onclick="toggleSection('section-alerts')">
                            <div class="collapsible-title">
                                <div class="collapsible-icon alerts">üîî</div>
                                <div>
                                    <h2 data-i18n="alerts_config">Configuration des Alertes</h2>
                                    <p data-i18n="alerts_desc">Email, Telegram, popup</p>
                                </div>
                            </div>
                            <div class="collapsible-toggle">‚ñº</div>
                        </div>
                        <div class="collapsible-content">
                            <div class="checkbox-group">
                                <input type="checkbox" id="check-popup">
                                <label for="check-popup">üí¨ <span data-i18n="alert_popup">Popup (notification
                                        visuelle)</span></label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="check-mail">
                                <label for="check-mail">üìß <span data-i18n="alert_email">Email
                                        d'alerte</span></label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="check-telegram">
                                <label for="check-telegram">üì± Telegram</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="check-mail-recap">
                                <label for="check-mail-recap">üìä <span data-i18n="alert_recap">Email
                                        r√©capitulatif</span></label>
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="check-db-externe">
                                <label for="check-db-externe">üíæ <span data-i18n="alert_db">Base de donn√©es
                                        externe</span></label>
                            </div>

                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="check-temp-alert">
                                    <label for="check-temp-alert">üå°Ô∏è <span data-i18n="alert_temp">Alerte
                                            temp√©rature
                                            √©lev√©e</span></label>
                                </div>
                                <div class="form-row" style="margin-top: 10px;">
                                    <div class="form-group">
                                        <label for="input-temp-seuil-warning" data-i18n="temp_threshold_warning">Seuil
                                            de
                                            warning (¬∞C)</label>
                                        <input type="number" id="input-temp-seuil-warning" value="60" min="30"
                                            max="120">
                                        <small style="color: #666; font-size: 12px;" data-i18n="alert_if_temp_warning">
                                            Visuel uniquement si temp√©rature ‚â• seuil
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label for="input-temp-seuil" data-i18n="temp_threshold">Seuil critique
                                            (¬∞C)</label>
                                        <input type="number" id="input-temp-seuil" value="70" min="30" max="120">
                                        <small style="color: #666; font-size: 12px;" data-i18n="alert_if_temp">
                                            Alerte + Visuel si temp√©rature ‚â• seuil
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <button id="btn-save-alerts" class="btn btn-info" style="width: 100%; margin-top: 15px;">
                                üíæ <span data-i18n="save_alerts">Sauvegarder les alertes</span>
                            </button>
                        </div>
                    </div>

                    <!-- Actions rapides -->
                    <div class="collapsible-section" id="section-actions">
                        <div class="collapsible-header" onclick="toggleSection('section-actions')">
                            <div class="collapsible-title">
                                <div class="collapsible-icon actions">‚ö°</div>
                                <div>
                                    <h2 data-i18n="quick_actions">Actions Rapides</h2>
                                    <p data-i18n="actions_desc">Import, export, nettoyage</p>
                                </div>
                            </div>
                            <div class="collapsible-toggle">‚ñº</div>
                        </div>
                        <div class="collapsible-content">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button id="btn-clear-all" class="btn btn-danger">
                                    üóëÔ∏è <span data-i18n="clear_all">Tout effacer</span>
                                </button>
                                <button id="btn-remove-duplicates" class="btn btn-warning">
                                    üîÑ <span data-i18n="remove_duplicates">Suppr. doublons</span>
                                </button>
                                <button id="btn-export-csv" class="btn btn-info">
                                    üì• <span data-i18n="export_csv">Exporter CSV</span>
                                </button>
                                <button id="btn-import-csv" class="btn btn-info">
                                    üì§ <span data-i18n="import_csv">Importer CSV</span>
                                </button>
                                <button id="btn-export-xls" class="btn btn-primary" style="background: #217346;">
                                    üìä <span data-i18n="export_xls">Exporter Excel</span>
                                </button>
                                <button id="btn-import-xls" class="btn btn-primary" style="background: #217346;">
                                    üìã <span data-i18n="import_xls">Importer Excel</span>
                                </button>
                                <button onclick="setSelectedHostsSite()" class="btn btn-primary"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); grid-column: span 2;">
                                    üè¢ <span data-i18n="assign_site">Assigner site aux s√©lectionn√©s</span>
                                </button>
                                <button id="btn-save-settings" class="btn btn-primary" style="grid-column: 1 / -1;">
                                    üíæ <span data-i18n="save">Sauvegarder</span>
                                </button>
                            </div>
                            <input type="file" id="file-import-csv" accept=".csv" style="display: none;">
                            <input type="file" id="file-import-xls" accept=".xlsx,.xls" style="display: none;">
                        </div>
                    </div>
                </div>



            </div>

            <script>
                // ==================== Menu Hamburger ====================
                function toggleMenu() {
                    const sideMenu = document.getElementById('side-menu');
                    const overlay = document.getElementById('menu-overlay');
                    const hamburgerBtn = document.getElementById('hamburger-btn');

                    sideMenu.classList.toggle('active');
                    overlay.classList.toggle('active');
                    hamburgerBtn.classList.toggle('active');
                }

                // Fermer le menu avec la touche Escape
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        const sideMenu = document.getElementById('side-menu');
                        if (sideMenu && sideMenu.classList.contains('active')) {
                            toggleMenu();
                        }
                    }
                });

                // ==================== Syst√®me de traduction ====================
                const translations = {
                    fr: {
                        admin_title: "Administration - Ping √º",
                        menu: "Menu",
                        language: "Langue",
                        status: "Statut",
                        actions: "Actions",
                        sections: "Sections",
                        menu_home: "Accueil",
                        welcome_title: "Bienvenue dans l'administration",
                        welcome_desc: "G√©rez vos h√¥tes, configurez les alertes et supervisez votre r√©seau depuis cette interface.",
                        quick_actions: "Actions rapides",
                        navigation: "Navigation",
                        change_credentials: "Changer identifiants",
                        monitoring_view: "Vue Monitoring",
                        logout: "D√©connexion",
                        status_running: "En cours",
                        status_stopped: "Arr√™t√©",
                        manage_users_title: "Gestion des Utilisateurs",
                        admin_user: "Administrateur",
                        standard_user: "Utilisateur",
                        admin_role: "R√¥le Admin",
                        admin_role_desc: "Acc√®s complet √† l'administration",
                        user_role: "R√¥le Utilisateur",
                        user_role_desc: "Acc√®s √† la vue monitoring uniquement",
                        change_credentials_title: "Changer les identifiants",
                        current_password: "Mot de passe actuel",
                        new_username: "Nouveau nom d'utilisateur",
                        new_password: "Nouveau mot de passe",
                        user_credentials_changed: "Identifiants utilisateur modifi√©s",
                        save: "Enregistrer",
                        cancel: "Annuler",
                        total_hosts: "Total H√¥tes",
                        online: "En ligne",
                        offline: "Hors ligne",
                        delay_sec: "D√©lai (sec)",
                        add_hosts: "Ajout d'H√¥tes",
                        add_hosts_desc: "Scanner et ajouter des h√¥tes",
                        monitoring_desc: "D√©marrer/arr√™ter et configurer",
                        alerts_desc: "Email, Telegram, popup",
                        actions_desc: "Import, export, nettoyage",
                        base_ip: "Adresse IP de base",
                        hosts_count: "Nombre d'h√¥tes",
                        scan_type: "Type de scan",
                        scan_alive: "Alive (actifs uniquement)",
                        scan_all: "Tous les h√¥tes",
                        scan_site: "Site sp√©cifique",
                        scan_hosts: "Scanner les h√¥tes",
                        assign_to_site: "Assigner au site",
                        monitoring_control: "Contr√¥le du Monitoring",
                        ping_delay: "D√©lai entre pings (sec)",
                        hs_before_alert: "Nombre de HS avant alerte",
                        start: "D√©marrer",
                        stop: "Arr√™ter",
                        alerts_config: "Configuration des Alertes",
                        alert_popup: "Popup (notification visuelle)",
                        alert_email: "Email d'alerte",
                        alert_recap: "Email r√©capitulatif",
                        alert_db: "Base de donn√©es externe",
                        alert_temp: "Alerte temp√©rature √©lev√©e",
                        temp_threshold: "Seuil critique (¬∞C)",
                        temp_threshold_warning: "Seuil de warning (¬∞C)",
                        alert_if_temp: "Alerte + Visuel si temp√©rature ‚â• seuil critique",
                        alert_if_temp_warning: "Visuel uniquement si temp√©rature ‚â• seuil de warning",
                        save_alerts: "Sauvegarder les alertes",
                        quick_actions: "Actions Rapides",
                        clear_all: "Tout effacer",
                        remove_duplicates: "Suppr. doublons",
                        export_csv: "Exporter CSV",
                        import_csv: "Importer CSV",
                        export_xls: "Exporter Excel",
                        import_xls: "Importer Excel",
                        export_xls_started: "Export Excel d√©marr√©",
                        import_xls_success: "Import Excel r√©ussi",
                        // Gestion des sites
                        sites_management: "Gestion des Sites",
                        sites_subtitle: "Organisez vos h√¥tes par localisation",
                        display_filter: "Affichage",
                        filter_desc: "Sites visibles dans le tableau",
                        monitor_sites: "Surveillance",
                        monitor_desc: "Sites √† pinger activement",
                        apply: "Appliquer",
                        show_all: "Tout afficher",
                        monitor_all: "Tout surveiller",
                        add_site: "Cr√©er",
                        add_site_hint: "Cr√©ez votre premier site ci-dessus",
                        all: "Tous",
                        add: "Ajouter",
                        site: "Site",
                        no_site: "Aucun",
                        no_sites: "Aucun site d√©fini",
                        enter_site_name: "Entrez un nom de site",
                        confirm_delete_site: "Supprimer le site",
                        filter_applied: "Filtre appliqu√©",
                        filter_cleared: "Affichage de tous les sites",
                        monitoring_sites_updated: "Sites de surveillance mis √† jour",
                        all_sites_monitored: "Tous les sites surveill√©s",
                        site_updated: "Site mis √† jour",
                        select_hosts_first: "S√©lectionnez au moins un h√¥te",
                        enter_site_for_hosts: "Entrez le nom du site pour les h√¥tes s√©lectionn√©s:",
                        assign_site: "Assigner site",
                        advanced_settings: "Param√®tres Avanc√©s",
                        advanced_settings_desc: "Configuration SMTP, Telegram et syst√®me",
                        smtp_config: "Configuration Email (SMTP)",
                        smtp_server: "Serveur SMTP",
                        or: "ou",
                        sender_email: "Email exp√©diteur",
                        password: "Mot de passe",
                        password_placeholder: "Mot de passe ou app password",
                        recipients: "Destinataires (s√©par√©s par des virgules)",
                        test: "Tester",
                        telegram_config: "Configuration Telegram",
                        bot_token: "Token du Bot",
                        recap_email_config: "Email R√©capitulatif P√©riodique",
                        send_time: "Heure d'envoi",
                        send_days: "Jours d'envoi",
                        monday: "Lundi",
                        tuesday: "Mardi",
                        wednesday: "Mercredi",
                        thursday: "Jeudi",
                        friday: "Vendredi",
                        saturday: "Samedi",
                        sunday: "Dimanche",
                        send_test: "Envoyer un test",
                        general_settings: "Param√®tres G√©n√©raux",
                        site_name: "Nom du Site",
                        theme: "Th√®me",
                        license_management: "Gestion de Licence",
                        no_license: "Pas de licence active",
                        license_active: "Licence active",
                        days_remaining: "jours restants",
                        features_limited: "Certaines fonctionnalit√©s sont limit√©es (Alertes)",
                        activation_code_label: "Code d'activation (Hardware ID) √† envoyer :",
                        license_key: "Cl√© de licence",
                        enter_license: "Entrez votre cl√© de licence",
                        activate_license: "Activer la licence",
                        system_info: "Informations Syst√®me",
                        web_server: "Serveur Web",
                        connected_user: "Utilisateur connect√©:",
                        hosts_list: "Liste des H√¥tes Monitor√©s",
                        name: "Nom",
                        latency: "Latence",
                        temperature: "Temp√©rature",
                        status: "Statut",
                        actions: "Actions",
                        no_hosts_configured: "Aucun h√¥te configur√©. Ajoutez des h√¥tes pour commencer le monitoring.",
                        status_online: "En ligne",
                        status_offline: "Hors ligne",
                        copied: "Copi√© !",
                        confirm_delete_all: "Voulez-vous vraiment effacer tous les h√¥tes ?",
                        confirm_delete_host: "Voulez-vous vraiment supprimer l'h√¥te",
                        confirm_logout: "Voulez-vous vraiment vous d√©connecter ?",
                        monitoring_started: "Monitoring d√©marr√©",
                        monitoring_stopped: "Monitoring arr√™t√©",
                        alerts_saved: "Alertes sauvegard√©es",
                        all_hosts_deleted: "Tous les h√¥tes ont √©t√© supprim√©s",
                        duplicates_removed: "doublon(s) supprim√©(s)",
                        no_duplicates: "Aucun doublon trouv√©",
                        export_started: "Export CSV d√©marr√©",
                        import_success: "Import r√©ussi",
                        settings_saved: "Param√®tres sauvegard√©s",
                        host_deleted: "H√¥te supprim√©",
                        host_excluded: "H√¥te exclu",
                        host_included: "H√¥te r√©inclus",
                        name_modified: "Nom modifi√© pour",
                        comment_modified: "Commentaire modifi√© pour",
                        smtp_saved: "Configuration SMTP sauvegard√©e",
                        test_email_sent: "Email de test envoy√©",
                        telegram_saved: "Configuration Telegram sauvegard√©e",
                        telegram_test_sent: "Message de test envoy√© sur Telegram",
                        recap_saved: "Configuration email r√©capitulatif sauvegard√©e",
                        recap_test_sent: "Email r√©capitulatif de test envoy√©",
                        general_saved: "Param√®tres g√©n√©raux sauvegard√©s",
                        license_saved: "Licence enregistr√©e",
                        credentials_changed: "Identifiants modifi√©s ! Reconnexion n√©cessaire.",
                        scan_complete: "Scan termin√© !",
                        hosts_scanned: "h√¥te(s) scann√©(s)",
                        requires_license: "N√©cessite une licence active",
                        edit_name: "Modifier le nom",
                        edit_comment: "Modifier le commentaire",
                        comment: "Commentaire",
                        delete: "Supprimer",
                        include_excluded: "Inclure (Actuellement exclu)",
                        exclude: "Exclure"
                    },
                    en: {
                        admin_title: "Administration - Ping √º",
                        menu: "Menu",
                        language: "Language",
                        status: "Status",
                        actions: "Actions",
                        navigation: "Navigation",
                        sections: "Sections",
                        menu_home: "Home",
                        welcome_title: "Welcome to Administration",
                        welcome_desc: "Manage your hosts, configure alerts and supervise your network from this interface.",
                        quick_actions: "Quick Actions",
                        change_credentials: "Change credentials",
                        monitoring_view: "Monitoring View",
                        logout: "Logout",
                        status_running: "Running",
                        status_stopped: "Stopped",
                        manage_users_title: "User Management",
                        admin_user: "Administrator",
                        standard_user: "User",
                        admin_role: "Admin Role",
                        admin_role_desc: "Full access to administration",
                        user_role: "User Role",
                        user_role_desc: "Access to monitoring view only",
                        change_credentials_title: "Change credentials",
                        current_password: "Current password",
                        new_username: "New username",
                        new_password: "New password",
                        user_credentials_changed: "User credentials changed",
                        save: "Save",
                        cancel: "Cancel",
                        total_hosts: "Total Hosts",
                        online: "Online",
                        offline: "Offline",
                        delay_sec: "Delay (sec)",
                        add_hosts: "Add Hosts",
                        add_hosts_desc: "Scan and add hosts",
                        monitoring_desc: "Start/stop and configure",
                        alerts_desc: "Email, Telegram, popup",
                        actions_desc: "Import, export, cleanup",
                        base_ip: "Base IP address",
                        hosts_count: "Number of hosts",
                        scan_type: "Scan type",
                        scan_alive: "Alive (active only)",
                        scan_all: "All hosts",
                        scan_site: "Specific site",
                        scan_hosts: "Scan hosts",
                        assign_to_site: "Assign to site",
                        monitoring_control: "Monitoring Control",
                        ping_delay: "Delay between pings (sec)",
                        hs_before_alert: "Failures before alert",
                        start: "Start",
                        stop: "Stop",
                        alerts_config: "Alerts Configuration",
                        alert_popup: "Popup (visual notification)",
                        alert_email: "Alert email",
                        alert_recap: "Summary email",
                        alert_db: "External database",
                        alert_temp: "High temperature alert",
                        temp_threshold: "Critical Threshold (¬∞C)",
                        temp_threshold_warning: "Warning Threshold (¬∞C)",
                        alert_if_temp: "Alert + Visual if temperature ‚â• critical threshold",
                        alert_if_temp_warning: "Visual only if temperature ‚â• warning threshold",
                        save_alerts: "Save alerts",
                        quick_actions: "Quick Actions",
                        clear_all: "Clear all",
                        remove_duplicates: "Remove duplicates",
                        export_csv: "Export CSV",
                        import_csv: "Import CSV",
                        export_xls: "Export Excel",
                        import_xls: "Import Excel",
                        export_xls_started: "Excel export started",
                        import_xls_success: "Excel import successful",
                        // Sites management
                        sites_management: "Sites Management",
                        sites_subtitle: "Organize your hosts by location",
                        display_filter: "Display",
                        filter_desc: "Sites visible in the table",
                        monitor_sites: "Monitoring",
                        monitor_desc: "Sites to actively ping",
                        apply: "Apply",
                        show_all: "Show all",
                        monitor_all: "Monitor all",
                        add_site: "Create",
                        add_site_hint: "Create your first site above",
                        all: "All",
                        add: "Add",
                        site: "Site",
                        no_site: "None",
                        no_sites: "No sites defined",
                        enter_site_name: "Enter a site name",
                        confirm_delete_site: "Delete site",
                        filter_applied: "Filter applied",
                        filter_cleared: "Displaying all sites",
                        monitoring_sites_updated: "Monitoring sites updated",
                        all_sites_monitored: "All sites monitored",
                        site_updated: "Site updated",
                        select_hosts_first: "Select at least one host",
                        enter_site_for_hosts: "Enter the site name for selected hosts:",
                        assign_site: "Assign site",
                        advanced_settings: "Advanced Settings",
                        advanced_settings_desc: "SMTP, Telegram and system configuration",
                        smtp_config: "Email Configuration (SMTP)",
                        smtp_server: "SMTP Server",
                        or: "or",
                        sender_email: "Sender email",
                        password: "Password",
                        password_placeholder: "Password or app password",
                        recipients: "Recipients (comma separated)",
                        test: "Test",
                        telegram_config: "Telegram Configuration",
                        bot_token: "Bot Token",
                        recap_email_config: "Periodic Summary Email",
                        send_time: "Send time",
                        send_days: "Send days",
                        monday: "Monday",
                        tuesday: "Tuesday",
                        wednesday: "Wednesday",
                        thursday: "Thursday",
                        friday: "Friday",
                        saturday: "Saturday",
                        sunday: "Sunday",
                        send_test: "Send a test",
                        general_settings: "General Settings",
                        site_name: "Site Name",
                        theme: "Theme",
                        license_management: "License Management",
                        no_license: "No active license",
                        license_active: "License active",
                        days_remaining: "days remaining",
                        features_limited: "Some features are limited (Alerts)",
                        activation_code_label: "Activation code (Hardware ID) to send:",
                        license_key: "License key",
                        enter_license: "Enter your license key",
                        activate_license: "Activate license",
                        system_info: "System Information",
                        web_server: "Web Server",
                        connected_user: "Connected user:",
                        hosts_list: "Monitored Hosts List",
                        name: "Name",
                        latency: "Latency",
                        temperature: "Temperature",
                        status: "Status",
                        actions: "Actions",
                        no_hosts_configured: "No hosts configured. Add hosts to start monitoring.",
                        status_online: "Online",
                        status_offline: "Offline",
                        copied: "Copied!",
                        confirm_delete_all: "Are you sure you want to delete all hosts?",
                        confirm_delete_host: "Are you sure you want to delete host",
                        confirm_logout: "Are you sure you want to logout?",
                        monitoring_started: "Monitoring started",
                        monitoring_stopped: "Monitoring stopped",
                        alerts_saved: "Alerts saved",
                        all_hosts_deleted: "All hosts have been deleted",
                        duplicates_removed: "duplicate(s) removed",
                        no_duplicates: "No duplicates found",
                        export_started: "CSV export started",
                        import_success: "Import successful",
                        settings_saved: "Settings saved",
                        host_deleted: "Host deleted",
                        host_excluded: "Host excluded",
                        host_included: "Host re-included",
                        name_modified: "Name modified for",
                        comment_modified: "Comment modified for",
                        smtp_saved: "SMTP configuration saved",
                        test_email_sent: "Test email sent",
                        telegram_saved: "Telegram configuration saved",
                        telegram_test_sent: "Test message sent on Telegram",
                        recap_saved: "Summary email configuration saved",
                        recap_test_sent: "Test summary email sent",
                        general_saved: "General settings saved",
                        license_saved: "License saved",
                        credentials_changed: "Credentials changed! Reconnection required.",
                        scan_complete: "Scan complete!",
                        hosts_scanned: "host(s) scanned",
                        requires_license: "Requires active license",
                        edit_name: "Edit name",
                        edit_comment: "Edit comment",
                        comment: "Commentaire",
                        delete: "Delete",
                        include_excluded: "Include (Currently excluded)",
                        exclude: "Exclude"
                    }
                };

                let currentLang = 'fr';

                // D√©tecter la langue du navigateur
                function detectBrowserLanguage() {
                    const browserLang = navigator.language || navigator.userLanguage;
                    return browserLang.startsWith('fr') ? 'fr' : 'en';
                }

                // Charger la langue sauvegard√©e ou d√©tecter automatiquement
                function loadLanguage() {
                    const savedLang = localStorage.getItem('ping√º_lang');
                    if (savedLang && translations[savedLang]) {
                        currentLang = savedLang;
                    } else {
                        currentLang = detectBrowserLanguage();
                    }
                    document.getElementById('lang-select').value = currentLang;
                    applyTranslations();
                }

                // Changer la langue
                function changeLanguage(lang) {
                    if (translations[lang]) {
                        currentLang = lang;
                        localStorage.setItem('ping√º_lang', lang);
                        applyTranslations();
                        // Re-render le tableau des h√¥tes
                        if (hostsData.length > 0) {
                            updateHostsTable(hostsData);
                        }
                    }
                }

                // Appliquer les traductions
                function applyTranslations() {
                    const trans = translations[currentLang];

                    // Mettre √† jour les √©l√©ments avec data-i18n
                    document.querySelectorAll('[data-i18n]').forEach(el => {
                        const key = el.getAttribute('data-i18n');
                        if (trans[key]) {
                            el.textContent = trans[key];
                        }
                    });

                    // Mettre √† jour les placeholders
                    document.querySelectorAll('[data-placeholder-i18n]').forEach(el => {
                        const key = el.getAttribute('data-placeholder-i18n');
                        if (trans[key]) {
                            el.placeholder = trans[key];
                        }
                    });

                    // Mettre √† jour les options des selects
                    document.querySelectorAll('select option[data-i18n]').forEach(option => {
                        const key = option.getAttribute('data-i18n');
                        if (key && trans[key]) {
                            option.textContent = trans[key];
                        }
                    });

                    // Mettre √† jour le titre de la page
                    document.title = trans.admin_title;

                    // Mettre √† jour l'attribut lang du HTML
                    document.documentElement.lang = currentLang;

                    // Mettre √† jour le statut du monitoring
                    updateMonitoringStatus(monitoringRunning);
                }

                // Fonction d'aide pour obtenir une traduction
                function t(key) {
                    return translations[currentLang][key] || key;
                }

                // ==================== Socket.IO ====================
                const socket = io({
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: 10
                });

                let hostsData = [];
                let monitoringRunning = false;
                let sitesList = [];
                let sitesActifs = [];
                let siteFilter = [];

                // ==================== Sections Collapsibles ====================

                function toggleSection(sectionId) {
                    const section = document.getElementById(sectionId);
                    if (section) {
                        section.classList.toggle('open');
                        // Sauvegarder l'√©tat dans localStorage
                        saveSectionsState();
                    }
                }

                function saveSectionsState() {
                    const sections = document.querySelectorAll('.collapsible-section');
                    const state = {};
                    sections.forEach(section => {
                        state[section.id] = section.classList.contains('open');
                    });
                    localStorage.setItem('adminSectionsState', JSON.stringify(state));
                }

                function loadSectionsState() {
                    try {
                        const saved = localStorage.getItem('adminSectionsState');
                        if (saved) {
                            const state = JSON.parse(saved);
                            Object.keys(state).forEach(sectionId => {
                                const section = document.getElementById(sectionId);
                                if (section) {
                                    if (state[sectionId]) {
                                        section.classList.add('open');
                                    } else {
                                        section.classList.remove('open');
                                    }
                                }
                            });
                        }
                    } catch (e) {
                        console.log('Erreur chargement √©tat sections:', e);
                    }
                }

                // Charger l'√©tat des sections au d√©marrage
                document.addEventListener('DOMContentLoaded', loadSectionsState);

                // ==================== Gestion des Sites ====================

                async function loadSites() {
                    try {
                        const response = await fetch('/api/get_sites');
                        const data = await response.json();

                        if (data.success) {
                            sitesList = data.sites || [];
                            sitesActifs = data.sites_actifs || [];
                            siteFilter = data.site_filter || [];

                            updateSitesUI();
                        }
                    } catch (error) {
                        console.error('Erreur chargement sites:', error);
                    }
                }

                function updateSitesUI() {
                    // Mettre √† jour la liste des sites
                    const sitesList_container = document.getElementById('sites-list');
                    const countBadge = document.getElementById('sites-count-badge');

                    if (countBadge) {
                        countBadge.textContent = `${sitesList.length} site${sitesList.length > 1 ? 's' : ''}`;
                    }

                    if (sitesList_container) {
                        if (sitesList.length === 0) {
                            sitesList_container.innerHTML = `
                        <div class="no-sites-message">
                            <div class="empty-icon">üèóÔ∏è</div>
                            <p>${t('no_sites') || 'Aucun site d√©fini'}</p>
                            <p style="font-size: 12px; margin-top: 5px;">${t('add_site_hint') || 'Cr√©ez votre premier site ci-dessus'}</p>
                        </div>
                    `;
                        } else {
                            sitesList_container.innerHTML = sitesList.map((site, index) => `
                        <div class="site-tag-premium" style="animation-delay: ${index * 0.05}s;">
                            <div class="site-tag-icon">üè¢</div>
                            <span class="site-tag-name">${escapeHtml(site)}</span>
                            <button class="site-tag-delete" onclick="deleteSite('${escapeHtml(site)}')" title="${t('delete') || 'Supprimer'}">‚úï</button>
                        </div>
                    `).join('');
                        }
                    }

                    // Mettre √† jour les selects de filtrage
                    updateSiteSelect('select-site-filter', siteFilter);
                    updateSiteSelect('select-sites-actifs', sitesActifs);

                    // Mettre √† jour le s√©lecteur de site dans le formulaire de scan
                    updateScanSiteSelect();
                }

                function updateScanSiteSelect() {
                    const select = document.getElementById('select-scan-site');
                    if (!select) return;

                    // Garder la valeur s√©lectionn√©e
                    const currentValue = select.value;

                    select.innerHTML = `<option value="">${t('no_site') || '- Aucun -'}</option>` +
                        sitesList.map(site => `<option value="${escapeHtml(site)}">${escapeHtml(site)}</option>`).join('');

                    // Restaurer la valeur si elle existe encore
                    if (currentValue && sitesList.includes(currentValue)) {
                        select.value = currentValue;
                    }
                }

                function updateSiteSelect(selectId, selectedValues) {
                    const select = document.getElementById(selectId);
                    if (!select) return;

                    select.innerHTML = sitesList.map(site => `
                    <option value="${escapeHtml(site)}" ${selectedValues.includes(site) ? 'selected' : ''}>${escapeHtml(site)}</option>
                    `).join('');
                }

                async function addSite() {
                    const input = document.getElementById('input-new-site');
                    const siteName = input.value.trim();

                    if (!siteName) {
                        showNotification(t('enter_site_name') || 'Entrez un nom de site', 'warning');
                        return;
                    }

                    try {
                        const response = await fetch('/api/add_site', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name: siteName })
                        });

                        const data = await response.json();

                        if (data.success) {
                            sitesList = data.sites;
                            input.value = '';
                            updateSitesUI();
                            showNotification(data.message, 'success');
                            socket.emit('request_update');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur ajout site', 'error');
                    }
                }

                async function deleteSite(siteName) {
                    if (!confirm(`${t('confirm_delete_site') || 'Supprimer le site'} "${siteName}" ?`)) return;

                    try {
                        const response = await fetch('/api/delete_site', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ name: siteName })
                        });

                        const data = await response.json();

                        if (data.success) {
                            sitesList = data.sites;
                            sitesActifs = sitesActifs.filter(s => s !== siteName);
                            siteFilter = siteFilter.filter(s => s !== siteName);
                            updateSitesUI();
                            showNotification(data.message, 'success');
                            socket.emit('request_update');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur suppression site', 'error');
                    }
                }

                async function applySiteFilter() {
                    const select = document.getElementById('select-site-filter');
                    const selectedSites = Array.from(select.selectedOptions).map(opt => opt.value);

                    try {
                        const response = await fetch('/api/set_site_filter', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ sites: selectedSites })
                        });

                        const data = await response.json();

                        if (data.success) {
                            siteFilter = data.site_filter;
                            showNotification(t('filter_applied') || 'Filtre appliqu√©', 'success');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur application filtre', 'error');
                    }
                }

                async function clearSiteFilter() {
                    try {
                        const response = await fetch('/api/set_site_filter', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ sites: [] })
                        });

                        const data = await response.json();

                        if (data.success) {
                            siteFilter = [];
                            updateSiteSelect('select-site-filter', []);
                            showNotification(t('filter_cleared') || 'Affichage de tous les sites', 'success');
                        }
                    } catch (error) {
                        showNotification('Erreur', 'error');
                    }
                }

                async function applySitesActifs() {
                    const select = document.getElementById('select-sites-actifs');
                    const selectedSites = Array.from(select.selectedOptions).map(opt => opt.value);

                    try {
                        const response = await fetch('/api/set_sites_actifs', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ sites: selectedSites })
                        });

                        const data = await response.json();

                        if (data.success) {
                            sitesActifs = data.sites_actifs;
                            showNotification(t('monitoring_sites_updated') || 'Sites de surveillance mis √† jour', 'success');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur', 'error');
                    }
                }

                async function clearSitesActifs() {
                    try {
                        const response = await fetch('/api/set_sites_actifs', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ sites: [] })
                        });

                        const data = await response.json();

                        if (data.success) {
                            sitesActifs = [];
                            updateSiteSelect('select-sites-actifs', []);
                            showNotification(t('all_sites_monitored') || 'Tous les sites surveill√©s', 'success');
                        }
                    } catch (error) {
                        showNotification('Erreur', 'error');
                    }
                }

                async function setHostSite(ip, site) {
                    try {
                        const response = await fetch('/api/set_host_site', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ip: ip, site: site })
                        });

                        const data = await response.json();

                        if (data.success) {
                            showNotification(t('site_updated') || 'Site mis √† jour', 'success');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur assignation site', 'error');
                    }
                }

                async function setSelectedHostsSite() {
                    const selectedIps = getSelectedHosts();

                    if (selectedIps.length === 0) {
                        showNotification(t('select_hosts_first') || 'S√©lectionnez au moins un h√¥te', 'warning');
                        return;
                    }

                    const siteName = prompt(t('enter_site_for_hosts') || 'Entrez le nom du site pour les h√¥tes s√©lectionn√©s:');
                    if (siteName === null) return;

                    try {
                        const response = await fetch('/api/set_multiple_hosts_site', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ ips: selectedIps, site: siteName.trim() })
                        });

                        const data = await response.json();

                        if (data.success) {
                            showNotification(data.message, 'success');
                        } else {
                            showNotification(data.error, 'error');
                        }
                    } catch (error) {
                        showNotification('Erreur', 'error');
                    }
                }

                // ==================== Socket Events ====================
                socket.on('connect', function () {
                    console.log('‚úÖ Connected to server');
                    loadSites();
                    loadSettings();
                    socket.emit('request_update');
                });

                socket.on('disconnect', function () {
                    console.log('‚ùå Disconnected from server');
                });

                socket.on('hosts_update', function (hosts) {
                    if (!Array.isArray(hosts)) {
                        hosts = [];
                    }
                    hostsData = hosts;
                    // Appliquer le tri actuel si d√©fini
                    if (currentSort.column) {
                        const savedDirection = currentSort.direction;
                        currentSort.direction = savedDirection === 'asc' ? 'desc' : 'asc';
                        sortHosts(currentSort.column);
                    } else {
                        updateHostsTable(hosts);
                    }
                    updateStats(hosts);
                });

                socket.on('monitoring_status', function (data) {
                    monitoringRunning = data.running;
                    updateMonitoringStatus(data.running);
                });

                socket.on('notification', function (data) {
                    showNotification(data.message, data.type || 'info');
                });

                socket.on('scan_complete', function (data) {
                    console.log('üì° Scan complete:', data.count, 'host(s)');
                    showNotification(`${t('scan_complete')} ${data.count} ${t('hosts_scanned')}`, 'success');
                    showBrowserNotification(t('scan_complete'), `${data.count} ${t('hosts_scanned')}`);
                    socket.emit('request_update');
                });

                // ==================== Sorting Functions ====================
                let currentSort = { column: 'ip', direction: 'asc' };

                function naturalSort(a, b) {
                    const ax = [], bx = [];
                    a.replace(/(\d+)|(\D+)/g, function (_, $1, $2) { ax.push([$1 || Infinity, $2 || ""]) });
                    b.replace(/(\d+)|(\D+)/g, function (_, $1, $2) { bx.push([$1 || Infinity, $2 || ""]) });
                    while (ax.length && bx.length) {
                        const an = ax.shift();
                        const bn = bx.shift();
                        const nn = (an[0] - bn[0]) || an[1].localeCompare(bn[1]);
                        if (nn) return nn;
                    }
                    return ax.length - bx.length;
                }

                function sortHosts(column) {
                    if (currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'asc';
                    }

                    document.querySelectorAll('.sort-icon').forEach(icon => icon.textContent = '‚ÜïÔ∏è');
                    const currentIcon = document.getElementById(`sort-${column}`);
                    if (currentIcon) {
                        currentIcon.textContent = currentSort.direction === 'asc' ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è';
                    }

                    hostsData.sort((a, b) => {
                        let valA = a[column] || '';
                        let valB = b[column] || '';

                        if (column === 'ip') {
                            const ipA = valA.split('.').map(Number);
                            const ipB = valB.split('.').map(Number);
                            for (let i = 0; i < 4; i++) {
                                if (ipA[i] !== ipB[i]) {
                                    return (ipA[i] - ipB[i]) * (currentSort.direction === 'asc' ? 1 : -1);
                                }
                            }
                            return 0;
                        }

                        if (column === 'commentaire') {
                            valA = a.commentaire || '';
                            valB = b.commentaire || '';
                        }

                        const comparison = naturalSort(String(valA), String(valB));
                        return currentSort.direction === 'asc' ? comparison : -comparison;
                    });

                    updateHostsTable(hostsData);
                }

                function updateStats(hosts) {
                    const total = hosts.length;
                    const online = hosts.filter(h => h.status === 'online').length;
                    const offline = total - online;

                    // Stats dans la grille principale
                    document.getElementById('stat-total').textContent = total;
                    document.getElementById('stat-online').textContent = online;
                    document.getElementById('stat-offline').textContent = offline;

                    // Stats dans la page d'accueil
                    const homeTotal = document.getElementById('home-stat-total');
                    const homeOnline = document.getElementById('home-stat-online');
                    const homeOffline = document.getElementById('home-stat-offline');
                    if (homeTotal) homeTotal.textContent = total;
                    if (homeOnline) homeOnline.textContent = online;
                    if (homeOffline) homeOffline.textContent = offline;
                }

                function updateMonitoringStatus(running) {
                    const statusEl = document.getElementById('monitoring-status');
                    const statusMiniEl = document.getElementById('monitoring-status-mini');
                    const dot = statusEl.querySelector('.status-dot');
                    const text = statusEl.querySelector('span[data-i18n]');

                    // Mise √† jour du bouton toggle
                    const toggleBtn = document.getElementById('btn-toggle-monitoring');
                    const toggleIcon = document.getElementById('btn-toggle-icon');
                    const toggleText = document.getElementById('btn-toggle-text');

                    if (running) {
                        statusEl.className = 'status-indicator running';
                        dot.className = 'status-dot running';
                        text.textContent = t('status_running');
                        text.setAttribute('data-i18n', 'status_running');

                        // Bouton devient "Arr√™ter" en rouge
                        toggleBtn.className = 'btn btn-danger';
                        toggleIcon.textContent = '‚èπÔ∏è';
                        toggleText.textContent = t('stop');
                        toggleText.setAttribute('data-i18n', 'stop');
                    } else {
                        statusEl.className = 'status-indicator stopped';
                        dot.className = 'status-dot stopped';
                        text.textContent = t('status_stopped');
                        text.setAttribute('data-i18n', 'status_stopped');

                        // Bouton devient "D√©marrer" en bleu
                        toggleBtn.className = 'btn btn-primary';
                        toggleIcon.textContent = '‚ñ∂Ô∏è';
                        toggleText.textContent = t('start');
                        toggleText.setAttribute('data-i18n', 'start');
                    }

                    // Mise √† jour du mini statut dans le header
                    if (statusMiniEl) {
                        const dotMini = statusMiniEl.querySelector('.status-dot');
                        const textMini = statusMiniEl.querySelector('span[data-i18n]');
                        if (running) {
                            statusMiniEl.className = 'status-indicator running';
                            dotMini.className = 'status-dot running';
                            textMini.textContent = t('status_running');
                            textMini.setAttribute('data-i18n', 'status_running');
                        } else {
                            statusMiniEl.className = 'status-indicator stopped';
                            dotMini.className = 'status-dot stopped';
                            textMini.textContent = t('status_stopped');
                            textMini.setAttribute('data-i18n', 'status_stopped');
                        }
                    }
                }

                function updateHostsTable(hosts) {
                    const tbody = document.getElementById('hosts-table-body');

                    if (hosts.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px; color: #9ca3af;">
                            ${t('no_hosts_configured')}
                        </td>
                    </tr>
                `;
                        return;
                    }

                    tbody.innerHTML = hosts.map(host => `
                    <tr>
                        <td><strong>${escapeHtml(host.ip)}</strong></td>
                        <td>
                            <span class="host-name-display" id="name-display-${escapeHtml(host.ip).replace(/\./g, '-')}"
                                onclick="editHostName('${host.ip}')"
                                style="cursor: pointer; display: inline-block; min-width: 50px; border-bottom: 1px dashed #667eea55;"
                                title="${t('edit_name')}">
                                ${escapeHtml(host.nom) || '-'}
                            </span>
                            <input type="text" class="host-name-input" id="name-input-${escapeHtml(host.ip).replace(/\./g, '-')}"
                                value="${escapeHtml(host.nom)}"
                                onblur="saveHostName('${host.ip}')"
                                onkeydown="if(event.key === 'Enter') this.blur()"
                                style="display: none; width: 100%; padding: 5px; border: 2px solid #10b981; border-radius: 6px; font-weight: 600;">
                        </td>
                        <td>${escapeHtml(host.mac) || '-'}</td>
                        <td>${escapeHtml(host.port) || '-'}</td>
                        <td style="text-align: center;">
                            <span class="latency-badge ${getLatencyClass(host.latence)}">${escapeHtml(host.latence) || '-'}</span>
                        </td>
                        <td>${escapeHtml(host.temp) || '-'}</td>
                        <td>
                            <span class="host-status ${host.status}">
                                ${host.status === 'online' ? t('status_online') : t('status_offline')}
                            </span>
                        </td>
                        <td>
                            <select class="site-select" onchange="setHostSite('${host.ip}', this.value)"
                                style="padding: 5px 10px; border-radius: 15px; border: 1px solid #d1d5db; background: ${host.site ? '#ecfdf5' : '#f9fafb'}; font-size: 12px; cursor: pointer;">
                                <option value="" ${!host.site ? 'selected' : ''}>- ${t('no_site') || 'Aucun'} -</option>
                                ${sitesList.map(site => `<option value="${escapeHtml(site)}" ${host.site === site ? 'selected' : ''}>${escapeHtml(site)}</option>`).join('')}
                            </select>
                        </td>
                        <td>
                            <span class="host-comment-display" id="comment-display-${escapeHtml(host.ip).replace(/\./g, '-')}"
                                onclick="editHostComment('${host.ip}')"
                                style="cursor: pointer; display: inline-block; min-width: 80px; border-bottom: 1px dashed #667eea55;"
                                title="${t('edit_comment')}">
                                ${escapeHtml(host.commentaire) || '-'}
                            </span>
                            <input type="text" class="host-comment-input" id="comment-input-${escapeHtml(host.ip).replace(/\./g, '-')}"
                                value="${escapeHtml(host.commentaire)}"
                                onblur="saveHostComment('${host.ip}')"
                                onkeydown="if(event.key === 'Enter') this.blur()"
                                style="display: none; width: 100%; padding: 5px; border: 2px solid #10b981; border-radius: 6px;">
                        </td>
                        <td class="host-actions">
                            <button class="btn btn-danger btn-small" onclick="deleteHost('${host.ip}')" title="${t('delete')}">
                                üóëÔ∏è
                            </button>
                            <button class="btn ${host.excl === 'x' ? 'btn-secondary' : 'btn-secondary'} btn-small"
                                onclick="excludeHost('${host.ip}', ${host.excl === 'x' ? true : false})"
                                title="${host.excl === 'x' ? t('include_excluded') : t('exclude')}"
                                style="${host.excl === 'x' ? 'background: #f59e0b;' : ''}">
                                ${host.excl === 'x' ? '‚ö†Ô∏è' : 'üö´'}
                            </button>
                        </td>
                    </tr>
                    `).join('');
                }

                // ==================== API Functions ====================
                async function apiCall(endpoint, method = 'GET', data = null) {
                    try {
                        const options = {
                            method: method,
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        };

                        if (data && method !== 'GET') {
                            options.body = JSON.stringify(data);
                        }

                        const response = await fetch(endpoint, options);
                        const result = await response.json();

                        if (!response.ok) {
                            throw new Error(result.error || 'API Error');
                        }

                        return result;
                    } catch (error) {
                        console.error('API Error:', error);
                        showNotification('Error: ' + error.message, 'error');
                        throw error;
                    }
                }

                // ==================== Event Handlers ====================
                document.getElementById('form-add-hosts').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        ip: document.getElementById('input-ip').value,
                        hosts: parseInt(document.getElementById('input-hosts').value),
                        port: document.getElementById('input-port').value,
                        scan_type: document.getElementById('select-scan-type').value,
                        site: document.getElementById('select-scan-site').value  // Site √† assigner
                    };

                    try {
                        const result = await apiCall('/api/add_hosts', 'POST', data);
                        showNotification(result.message || t('scan_hosts'), 'success');
                        setTimeout(() => socket.emit('request_update'), 2000);
                    } catch (error) { }
                });

                document.getElementById('btn-start-monitoring').addEventListener('click', async function () {
                    const delai = parseInt(document.getElementById('input-delai').value);
                    const nbHs = parseInt(document.getElementById('input-nb-hs').value);

                    try {
                        const result = await apiCall('/api/start_monitoring', 'POST', { delai, nb_hs: nbHs });
                        showNotification(t('monitoring_started'), 'success');
                        monitoringRunning = true;
                        updateMonitoringStatus(true);
                    } catch (error) { }
                });

                document.getElementById('btn-stop-monitoring').addEventListener('click', async function () {
                    try {
                        const result = await apiCall('/api/stop_monitoring', 'POST');
                        showNotification(t('monitoring_stopped'), 'info');
                        monitoringRunning = false;
                        updateMonitoringStatus(false);
                    } catch (error) { }
                });

                // Bouton toggle unique dans le header qui change selon l'√©tat
                document.getElementById('btn-toggle-monitoring').addEventListener('click', async function () {
                    if (monitoringRunning) {
                        // Arr√™ter le monitoring
                        try {
                            const result = await apiCall('/api/stop_monitoring', 'POST');
                            showNotification(t('monitoring_stopped'), 'info');
                            monitoringRunning = false;
                            updateMonitoringStatus(false);
                        } catch (error) { }
                    } else {
                        // D√©marrer le monitoring
                        const delai = parseInt(document.getElementById('input-delai').value);
                        const nbHs = parseInt(document.getElementById('input-nb-hs').value);

                        try {
                            const result = await apiCall('/api/start_monitoring', 'POST', { delai, nb_hs: nbHs });
                            showNotification(t('monitoring_started'), 'success');
                            monitoringRunning = true;
                            updateMonitoringStatus(true);
                        } catch (error) { }
                    }
                });

                document.getElementById('btn-save-alerts').addEventListener('click', async function () {
                    const alerts = {
                        popup: document.getElementById('check-popup').checked,
                        mail: document.getElementById('check-mail').checked,
                        telegram: document.getElementById('check-telegram').checked,
                        mail_recap: document.getElementById('check-mail-recap').checked,
                        db_externe: document.getElementById('check-db-externe').checked,
                        temp_alert: document.getElementById('check-temp-alert').checked,
                        temp_seuil: parseInt(document.getElementById('input-temp-seuil').value) || 70,
                        temp_seuil_warning: parseInt(document.getElementById('input-temp-seuil-warning').value) || 60
                    };

                    try {
                        const result = await apiCall('/api/save_alerts', 'POST', alerts);
                        showNotification(t('alerts_saved'), 'success');
                    } catch (error) { }
                });

                document.getElementById('btn-clear-all').addEventListener('click', async function () {
                    if (!confirm(t('confirm_delete_all'))) {
                        return;
                    }

                    try {
                        const result = await apiCall('/api/clear_all', 'POST');
                        showNotification(t('all_hosts_deleted'), 'info');
                        socket.emit('request_update');
                    } catch (error) { }
                });

                document.getElementById('btn-remove-duplicates').addEventListener('click', async function () {
                    try {
                        const result = await apiCall('/api/remove_duplicates', 'POST');
                        if (result.duplicates_removed > 0) {
                            showNotification(`${result.duplicates_removed} ${t('duplicates_removed')}`, 'success');
                        } else {
                            showNotification(t('no_duplicates'), 'info');
                        }
                        socket.emit('request_update');
                    } catch (error) { }
                });

                document.getElementById('btn-export-csv').addEventListener('click', async function () {
                    try {
                        window.location.href = '/api/export_csv';
                        showNotification(t('export_started'), 'success');
                    } catch (error) {
                        showNotification('Export error', 'error');
                    }
                });

                document.getElementById('btn-import-csv').addEventListener('click', function () {
                    document.getElementById('file-import-csv').click();
                });

                document.getElementById('file-import-csv').addEventListener('change', async function (e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    const formData = new FormData();
                    formData.append('file', file);

                    try {
                        const response = await fetch('/api/import_csv', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (response.ok) {
                            showNotification(result.message || t('import_success'), 'success');
                            socket.emit('request_update');
                        } else {
                            showNotification(result.error || 'Import error', 'error');
                        }
                    } catch (error) {
                        showNotification('Import error', 'error');
                    }

                    e.target.value = '';
                });

                document.getElementById('btn-save-settings').addEventListener('click', async function () {
                    try {
                        const result = await apiCall('/api/save_settings', 'POST');
                        showNotification(t('settings_saved'), 'success');
                    } catch (error) { }
                });

                // ==================== Export/Import Excel ====================
                document.getElementById('btn-export-xls').addEventListener('click', async function () {
                    try {
                        window.location.href = '/api/export_xls';
                        showNotification(t('export_xls_started'), 'success');
                    } catch (error) {
                        showNotification('Export error', 'error');
                    }
                });

                document.getElementById('btn-import-xls').addEventListener('click', function () {
                    document.getElementById('file-import-xls').click();
                });

                document.getElementById('file-import-xls').addEventListener('change', async function (e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    const formData = new FormData();
                    formData.append('file', file);

                    try {
                        const response = await fetch('/api/import_xls', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (response.ok) {
                            showNotification(result.message || t('import_xls_success'), 'success');
                            socket.emit('request_update');
                        } else {
                            showNotification(result.error || 'Import error', 'error');
                        }
                    } catch (error) {
                        showNotification('Import error', 'error');
                    }

                    e.target.value = '';
                });

                // ==================== Network Scanner ====================
                let scanDevicesFound = 0;

                document.getElementById('btn-start-scan').addEventListener('click', async function () {
                    try {
                        // R√©cup√©rer les types de scan s√©lectionn√©s
                        const scanTypes = [];
                        if (document.getElementById('scan-type-hik').checked) scanTypes.push('hik');
                        if (document.getElementById('scan-type-dahua').checked) scanTypes.push('dahua');
                        if (document.getElementById('scan-type-onvif').checked) scanTypes.push('onvif');
                        if (document.getElementById('scan-type-samsung').checked) scanTypes.push('samsung');
                        if (document.getElementById('scan-type-avigilon').checked) scanTypes.push('avigilon');
                        if (document.getElementById('scan-type-upnp').checked) scanTypes.push('upnp');
                        if (document.getElementById('scan-type-snmp') && document.getElementById('scan-type-snmp').checked) scanTypes.push('server');
                        if (document.getElementById('scan-type-ups') && document.getElementById('scan-type-ups').checked) scanTypes.push('ups');

                        if (scanTypes.length === 0) {
                            showNotification('S√©lectionnez au moins un type de scan', 'warning');
                            return;
                        }

                        // Reset UI
                        scanDevicesFound = 0;
                        document.getElementById('scan-results-body').innerHTML = '';
                        document.getElementById('scan-devices-count').textContent = '0 p√©riph√©rique(s)';

                        // D√©marrer le scan
                        const result = await apiCall('/api/network_scan/start', 'POST', {
                            scan_types: scanTypes,
                            timeout: 15
                        });

                        if (result.success) {
                            // Afficher UI de scan en cours
                            document.getElementById('btn-start-scan').style.display = 'none';
                            document.getElementById('btn-stop-scan').style.display = 'inline-flex';
                            document.getElementById('scan-progress').style.display = 'flex';
                            document.getElementById('scan-results-container').style.display = 'block';
                            showNotification('Scan d√©marr√©', 'success');
                        }
                    } catch (error) {
                        console.error('Erreur scan:', error);
                        showNotification('Erreur lors du scan', 'error');
                    }
                });

                document.getElementById('btn-stop-scan').addEventListener('click', async function () {
                    try {
                        await apiCall('/api/network_scan/stop', 'POST');
                        showNotification('Scan arr√™t√©', 'info');
                        resetScanUI();
                    } catch (error) {
                        console.error('Erreur arr√™t scan:', error);
                    }
                });

                function resetScanUI() {
                    document.getElementById('btn-start-scan').style.display = 'inline-flex';
                    document.getElementById('btn-stop-scan').style.display = 'none';
                    document.getElementById('scan-progress').style.display = 'none';
                }

                function addDeviceToScanResults(device) {
                    const tbody = document.getElementById('scan-results-body');
                    const row = tbody.insertRow(0); // Ins√©rer en premier
                    row.style.animation = 'fadeIn 0.3s ease-in';

                    // V√©rifier si l'h√¥te est d√©j√† monitor√©
                    const currentHosts = window.hostsData || [];
                    const isMonitored = currentHosts.some(h => h.ip === device.ip);

                    // Type icon mapping
                    const typeIcons = {
                        'camera_hikvision': 'üìπ',
                        'camera_dahua': 'üìπ',
                        'camera_generic': 'üìπ',
                        'camera_samsung': 'üìπ',
                        'camera_avigilon': 'üìπ',
                        'upnp_device': 'üåê',
                        'switch': 'üîÄ',
                        'server': 'üñ•Ô∏è',
                        'ups': 'üîã'
                    };

                    const icon = typeIcons[device.type] || '‚ùì';
                    const typeName = device.type.replace('camera_', '').replace('_', ' ');

                    let actionBtn;
                    if (isMonitored) {
                        actionBtn = `<button class="btn btn-sm" style="background-color: #d97706; color: white;" 
                            onclick="addScannedDevice('${device.ip}', '${device.name || device.ip}', true)">
                            ‚ö†Ô∏è D√©j√† pr√©sent
                        </button>`;
                    } else {
                        actionBtn = `<button class="btn btn-sm btn-primary" 
                            onclick="addScannedDevice('${device.ip}', '${device.name || device.ip}', false)">
                            ‚ûï Ajouter
                        </button>`;
                    }

                    row.innerHTML = `
                    <td><code>${device.ip}</code></td>
                    <td>${icon} ${typeName}</td>
                    <td>${device.manufacturer || '-'}</td>
                    <td>${device.model || '-'}</td>
                    <td>${device.name || '-'}</td>
                    <td><span style="background: var(--accent-color); color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">${device.protocol}</span></td>
                    <td>
                        ${actionBtn}
                    </td>
                    `;

                    scanDevicesFound++;
                    document.getElementById('scan-devices-count').textContent = `${scanDevicesFound} p√©riph√©rique(s)`;
                }

                // Fonction globale pour ajouter un p√©riph√©rique d√©couvert au monitoring
                window.addScannedDevice = async function (ip, name, isDuplicate = false) {
                    if (isDuplicate) {
                        if (!confirm(`L'h√¥te ${ip} est d√©j√† dans votre liste de monitoring.\nVoulez-vous vraiment l'ajouter en doublon ?`)) {
                            return;
                        }
                    }
                    try {
                        const result = await apiCall('/api/add_hosts', 'POST', {
                            ip: ip,
                            hosts: 1,
                            port: '80',
                            scan_type: 'alive',
                            site: ''
                        });

                        if (result.success) {
                            showNotification(`${name} (${ip}) ajout√© au monitoring`, 'success');
                            // Optionnel: mettre √† jour le nom
                            if (name && name !== ip) {
                                await apiCall('/api/update_host_name', 'POST', { ip: ip, name: name });
                            }
                        } else {
                            showNotification('Erreur: ' + result.error, 'error');
                        }
                    } catch (error) {
                        console.error('Erreur ajout p√©riph√©rique:', error);
                        showNotification('Erreur lors de l\'ajout', 'error');
                    }
                };

                // WebSocket listeners pour le scanner
                socket.on('scan_device_found', function (device) {
                    addDeviceToScanResults(device);
                });

                socket.on('scan_status', function (data) {
                    if (data.status === 'complete') {
                        showNotification(`Scan termin√©: ${scanDevicesFound} p√©riph√©rique(s) trouv√©(s)`, 'success');
                        resetScanUI();
                    } else if (data.status === 'error') {
                        showNotification('Erreur durant le scan: ' + data.message, 'error');
                        resetScanUI();
                    }
                });

                // ==================== Host Actions ====================
                async function deleteHost(ip) {
                    if (!confirm(`${t('confirm_delete_host')} ${ip} ?`)) {
                        return;
                    }

                    try {
                        const result = await apiCall('/api/delete_host', 'POST', { ip });
                        showNotification(`${t('host_deleted')}: ${ip}`, 'info');
                        socket.emit('request_update');
                    } catch (error) { }
                }

                async function excludeHost(ip, isExcluded) {
                    try {
                        const endpoint = isExcluded ? '/api/include_host' : '/api/exclude_host';
                        const message = isExcluded ? `${t('host_included')}: ${ip}` : `${t('host_excluded')}: ${ip}`;
                        const type = isExcluded ? 'success' : 'info';

                        const result = await apiCall(endpoint, 'POST', { ip });
                        showNotification(message, type);
                        socket.emit('request_update');
                    } catch (error) { }
                }

                function editHostName(ip) {
                    const ipClean = ip.replace(/\./g, '-');
                    const displayEl = document.getElementById(`name-display-${ipClean}`);
                    const inputEl = document.getElementById(`name-input-${ipClean}`);

                    if (displayEl && inputEl) {
                        displayEl.style.display = 'none';
                        inputEl.style.display = 'block';
                        inputEl.focus();
                        inputEl.select();
                    }
                }

                async function saveHostName(ip) {
                    const ipClean = ip.replace(/\./g, '-');
                    const displayEl = document.getElementById(`name-display-${ipClean}`);
                    const inputEl = document.getElementById(`name-input-${ipClean}`);

                    if (!inputEl || inputEl.style.display === 'none') return;

                    const newName = inputEl.value.trim();

                    try {
                        const result = await apiCall('/api/update_host_name', 'POST', {
                            ip: ip,
                            name: newName
                        });

                        if (displayEl) {
                            displayEl.textContent = newName || '-';
                            displayEl.style.display = 'inline-block';
                        }
                        if (inputEl) {
                            inputEl.style.display = 'none';
                        }

                        showNotification(`${t('name_modified')} ${ip}`, 'success');
                        socket.emit('request_update');
                    } catch (error) {
                        if (displayEl) displayEl.style.display = 'inline-block';
                        if (inputEl) inputEl.style.display = 'none';
                    }
                }

                function editHostComment(ip) {
                    const ipClean = ip.replace(/\./g, '-');
                    const displayEl = document.getElementById(`comment-display-${ipClean}`);
                    const inputEl = document.getElementById(`comment-input-${ipClean}`);

                    if (displayEl && inputEl) {
                        displayEl.style.display = 'none';
                        inputEl.style.display = 'block';
                        inputEl.focus();
                        inputEl.select();
                    }
                }

                async function saveHostComment(ip) {
                    const ipClean = ip.replace(/\./g, '-');
                    const displayEl = document.getElementById(`comment-display-${ipClean}`);
                    const inputEl = document.getElementById(`comment-input-${ipClean}`);

                    if (!inputEl || inputEl.style.display === 'none') return;

                    const newComment = inputEl.value.trim();

                    try {
                        const result = await apiCall('/api/update_comment', 'POST', {
                            ip: ip,
                            comment: newComment
                        });

                        if (displayEl) {
                            displayEl.textContent = newComment || '-';
                            displayEl.style.display = 'inline-block';
                        }
                        if (inputEl) {
                            inputEl.style.display = 'none';
                        }

                        showNotification(`${t('comment_modified') || 'Commentaire modifi√©'} ${ip}`, 'success');
                        socket.emit('request_update');
                    } catch (error) {
                        if (displayEl) displayEl.style.display = 'inline-block';
                        if (inputEl) inputEl.style.display = 'none';
                    }
                }

                // ==================== Settings ====================
                async function loadSettings() {
                    try {
                        const result = await apiCall('/api/get_settings');

                        if (result.delai) {
                            document.getElementById('input-delai').value = result.delai;
                            document.getElementById('stat-delai').textContent = result.delai;
                        }
                        if (result.nb_hs) {
                            document.getElementById('input-nb-hs').value = result.nb_hs;
                        }

                        if (result.alerts) {
                            document.getElementById('check-popup').checked = result.alerts.popup || false;
                            document.getElementById('check-mail').checked = result.alerts.mail || false;
                            document.getElementById('check-telegram').checked = result.alerts.telegram || false;
                            document.getElementById('check-mail-recap').checked = result.alerts.mail_recap || false;
                            document.getElementById('check-db-externe').checked = result.alerts.db_externe || false;
                            document.getElementById('check-temp-alert').checked = result.alerts.temp_alert || false;
                            document.getElementById('input-temp-seuil').value = result.alerts.temp_seuil || 70;
                            document.getElementById('input-temp-seuil-warning').value = result.alerts.temp_seuil_warning || 60;
                        }

                        if (typeof result.monitoring_running !== 'undefined') {
                            monitoringRunning = result.monitoring_running;
                            updateMonitoringStatus(result.monitoring_running);
                        }

                        if (result.smtp) {
                            document.getElementById('smtp-server').value = result.smtp.server || '';
                            document.getElementById('smtp-port').value = result.smtp.port || '587';
                            document.getElementById('smtp-email').value = result.smtp.email || '';
                            document.getElementById('smtp-recipients').value = result.smtp.recipients || '';
                        }

                        if (result.telegram) {
                            document.getElementById('telegram-token').value = result.telegram.token || '';
                            document.getElementById('telegram-chatid').value = result.telegram.chatid || '';
                        }

                        if (result.general) {
                            document.getElementById('general-site').value = result.general.site || '';
                            document.getElementById('general-theme').value = result.general.theme || 'nord';

                            if (result.general.advanced_title) {
                                const titleEl = document.getElementById('advanced-settings-title');
                                const inputEl = document.getElementById('advanced-settings-title-input');
                                if (titleEl) titleEl.textContent = result.general.advanced_title;
                                if (inputEl) inputEl.textContent = result.general.advanced_title;
                            }
                        }

                        if (result.version) {
                            document.getElementById('system-version').textContent = result.version;
                        }
                    } catch (error) {
                        console.error('Settings load error:', error);
                    }
                }

                function editSectionTitle(id) {
                    const displayEl = document.getElementById(id);
                    const inputEl = document.getElementById(id + '-input');

                    if (displayEl && inputEl) {
                        displayEl.style.display = 'none';
                        inputEl.style.display = 'block';
                        inputEl.value = displayEl.textContent;
                        inputEl.focus();
                        inputEl.select();
                    }
                }

                async function saveSectionTitle(id) {
                    const displayEl = document.getElementById(id);
                    const inputEl = document.getElementById(id + '-input');

                    if (!inputEl || inputEl.style.display === 'none') return;

                    const newTitle = inputEl.value.trim();
                    if (!newTitle) {
                        displayEl.style.display = 'block';
                        inputEl.style.display = 'none';
                        return;
                    }

                    try {
                        // Pour l'instant on g√®re seulement advanced-settings-title
                        const result = await apiCall('/api/update_general_setting', 'POST', {
                            advanced_title: newTitle
                        });

                        if (displayEl) {
                            displayEl.textContent = newTitle;
                            displayEl.style.display = 'block';
                        }
                        if (inputEl) {
                            inputEl.style.display = 'none';
                        }

                        showNotification(t('settings_saved') || 'Titre mis √† jour', 'success');
                    } catch (error) {
                        if (displayEl) displayEl.style.display = 'block';
                        if (inputEl) inputEl.style.display = 'none';
                    }
                }

                // ==================== Utility Functions ====================
                function showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.animation = 'slideOut 0.3s ease';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }

                function showBrowserNotification(title, body) {
                    if (!("Notification" in window)) {
                        return;
                    }

                    if (Notification.permission === "granted") {
                        new Notification(title, {
                            body: body,
                            icon: '/static/favicon.ico',
                            badge: '/static/favicon.ico',
                            tag: 'scan-complete',
                            requireInteraction: false
                        });
                    } else if (Notification.permission !== "denied") {
                        Notification.requestPermission().then(function (permission) {
                            if (permission === "granted") {
                                new Notification(title, {
                                    body: body,
                                    icon: '/static/favicon.ico',
                                    badge: '/static/favicon.ico',
                                    tag: 'scan-complete'
                                });
                            }
                        });
                    }
                }

                if ("Notification" in window && Notification.permission === "default") {
                    setTimeout(() => {
                        Notification.requestPermission();
                    }, 2000);
                }

                function escapeHtml(text) {
                    if (!text) return '';
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }

                function getLatencyClass(latence) {
                    if (!latence || latence === '-') return 'offline';

                    const latenceStr = String(latence).toLowerCase();

                    // Si c'est HS ou contient "hs"
                    if (latenceStr === 'hs' || latenceStr.includes('hs')) {
                        return 'offline';
                    }

                    // Extraire la valeur num√©rique
                    const match = latenceStr.match(/[\d.]+/);
                    if (!match) return 'good';

                    const ms = parseFloat(match[0]);

                    if (ms < 20) return 'excellent';      // Vert - Excellent (< 20ms)
                    if (ms < 50) return 'good';           // Jaune clair - Bon (20-50ms)
                    if (ms < 100) return 'warning';       // Orange - Attention (50-100ms)
                    return 'critical';                     // Rouge - Critique (> 100ms)
                }

                // ==================== Auto-refresh ====================
                setInterval(() => {
                    socket.emit('request_update');
                }, 10000);

                // ==================== Accordions ====================
                function toggleAccordion(id) {
                    const content = document.getElementById('content-' + id);
                    const icon = document.getElementById('icon-' + id);
                    const header = icon.parentElement;

                    if (content.classList.contains('active')) {
                        content.classList.remove('active');
                        icon.classList.remove('active');
                        header.classList.remove('active');
                    } else {
                        content.classList.add('active');
                        icon.classList.add('active');
                        header.classList.add('active');
                    }
                }

                // ==================== Configuration SMTP ====================
                document.getElementById('form-smtp').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        server: document.getElementById('smtp-server').value,
                        port: document.getElementById('smtp-port').value,
                        email: document.getElementById('smtp-email').value,
                        password: document.getElementById('smtp-password').value,
                        recipients: document.getElementById('smtp-recipients').value
                    };

                    try {
                        const result = await apiCall('/api/save_smtp', 'POST', data);
                        showNotification(t('smtp_saved'), 'success');
                    } catch (error) { }
                });

                async function testSMTP() {
                    try {
                        const result = await apiCall('/api/test_smtp', 'POST', {});
                        showNotification(result.message || t('test_email_sent'), 'success');
                    } catch (error) { }
                }

                // ==================== Configuration Telegram ====================
                document.getElementById('form-telegram').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        token: document.getElementById('telegram-token').value,
                        chatid: document.getElementById('telegram-chatid').value
                    };

                    try {
                        const result = await apiCall('/api/save_telegram', 'POST', data);
                        showNotification(t('telegram_saved'), 'success');
                    } catch (error) { }
                });

                async function testTelegram() {
                    try {
                        const result = await apiCall('/api/test_telegram', 'POST', {});
                        showNotification(result.message || t('telegram_test_sent'), 'success');
                    } catch (error) { }
                }

                // ==================== Email R√©capitulatif ====================
                document.getElementById('form-mail-recap').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        heure: document.getElementById('recap-heure').value,
                        lundi: document.getElementById('recap-lundi').checked,
                        mardi: document.getElementById('recap-mardi').checked,
                        mercredi: document.getElementById('recap-mercredi').checked,
                        jeudi: document.getElementById('recap-jeudi').checked,
                        vendredi: document.getElementById('recap-vendredi').checked,
                        samedi: document.getElementById('recap-samedi').checked,
                        dimanche: document.getElementById('recap-dimanche').checked
                    };

                    try {
                        const result = await apiCall('/api/save_mail_recap', 'POST', data);
                        showNotification(t('recap_saved'), 'success');
                    } catch (error) { }
                });

                async function sendTestRecap() {
                    try {
                        const result = await apiCall('/api/send_test_recap', 'POST', {});
                        showNotification(result.message || t('recap_test_sent'), 'success');
                    } catch (error) { }
                }

                async function loadMailRecapSettings() {
                    try {
                        const result = await apiCall('/api/get_mail_recap_settings');

                        if (result.heure) {
                            document.getElementById('recap-heure').value = result.heure;
                        }

                        document.getElementById('recap-lundi').checked = result.lundi || false;
                        document.getElementById('recap-mardi').checked = result.mardi || false;
                        document.getElementById('recap-mercredi').checked = result.mercredi || false;
                        document.getElementById('recap-jeudi').checked = result.jeudi || false;
                        document.getElementById('recap-vendredi').checked = result.vendredi || false;
                        document.getElementById('recap-samedi').checked = result.samedi || false;
                        document.getElementById('recap-dimanche').checked = result.dimanche || false;
                    } catch (error) {
                        console.error('Mail recap settings load error:', error);
                    }
                }

                // ==================== Param√®tres G√©n√©raux ====================
                document.getElementById('form-general').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        site: document.getElementById('general-site').value,
                        license: '',
                        theme: document.getElementById('general-theme').value
                    };

                    try {
                        const result = await apiCall('/api/save_general', 'POST', data);
                        showNotification(t('general_saved'), 'success');
                    } catch (error) { }
                });

                // ==================== Licence ====================
                document.getElementById('form-license').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const licenseKey = document.getElementById('license-key').value;

                    const data = {
                        site: document.getElementById('general-site').value,
                        license: licenseKey,
                        theme: document.getElementById('general-theme').value
                    };

                    try {
                        const result = await apiCall('/api/save_general', 'POST', data);
                        showNotification(t('license_saved'), 'success');
                        loadLicenseInfo();
                    } catch (error) { }
                });

                async function loadLicenseInfo() {
                    try {
                        const result = await apiCall('/api/get_license_info');

                        const icon = document.getElementById('license-icon');
                        const status = document.getElementById('license-status');
                        const days = document.getElementById('license-days');
                        const codeInput = document.getElementById('activation-code');

                        if (result.activation_code) {
                            codeInput.value = result.activation_code;
                        }

                        const isLicenseActive = result.active;

                        const paidAlerts = ['check-mail', 'check-telegram', 'check-mail-recap', 'check-db-externe'];
                        paidAlerts.forEach(id => {
                            const el = document.getElementById(id);
                            if (el) {
                                el.disabled = !isLicenseActive;
                                if (!isLicenseActive) {
                                    el.checked = false;
                                    el.parentElement.title = t('requires_license');
                                    el.parentElement.style.opacity = "0.6";
                                } else {
                                    el.parentElement.title = "";
                                    el.parentElement.style.opacity = "1";
                                }
                            }
                        });

                        if (isLicenseActive) {
                            icon.textContent = '‚úÖ';
                            status.textContent = t('license_active');
                            days.textContent = `${result.days_remaining} ${t('days_remaining')}`;
                            status.style.color = '#10b981';
                        } else {
                            icon.textContent = '‚ùå';
                            status.textContent = t('no_license');
                            days.textContent = t('features_limited');
                            status.style.color = '#ef4444';
                        }
                    } catch (error) {
                        console.error('License info load error:', error);
                    }
                }

                // ==================== Authentification ====================
                document.getElementById('btn-logout').addEventListener('click', async function () {
                    if (!confirm(t('confirm_logout'))) {
                        return;
                    }

                    try {
                        const result = await apiCall('/api/logout', 'POST');
                        window.location.href = '/login';
                    } catch (error) { }
                });

                document.getElementById('btn-change-password').addEventListener('click', function () {
                    const modal = document.getElementById('modal-change-password');
                    modal.style.display = 'flex';
                });

                document.getElementById('btn-cancel-change').addEventListener('click', function () {
                    closeUserModal();
                });

                function closeUserModal() {
                    const modal = document.getElementById('modal-change-password');
                    modal.style.display = 'none';
                    document.getElementById('form-change-password').reset();
                    document.getElementById('form-change-user-password').reset();
                }

                function switchUserTab(tab) {
                    // Masquer tous les contenus
                    document.querySelectorAll('.user-tab-content').forEach(c => c.style.display = 'none');
                    // D√©sactiver tous les onglets
                    document.querySelectorAll('.user-tab').forEach(t => {
                        t.style.background = 'white';
                        t.style.color = '#374151';
                        t.style.border = '1px solid #e5e7eb';
                        t.classList.remove('active');
                    });

                    // Activer l'onglet s√©lectionn√©
                    const activeTab = document.querySelector(`.user-tab[data-tab="${tab}"]`);
                    if (tab === 'admin') {
                        activeTab.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    } else {
                        activeTab.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    }
                    activeTab.style.color = 'white';
                    activeTab.style.border = 'none';
                    activeTab.classList.add('active');

                    // Afficher le contenu correspondant
                    document.getElementById(`tab-${tab}`).style.display = 'block';

                    // Charger les infos utilisateur si onglet user
                    if (tab === 'user') {
                        loadUserCredentials();
                    }
                }

                async function loadUserCredentials() {
                    try {
                        const result = await apiCall('/api/get_users');
                        if (result.users) {
                            const userAccount = result.users.find(u => u.role === 'user');
                            if (userAccount) {
                                document.getElementById('user-new-username').value = userAccount.username;
                            }
                        }
                    } catch (error) {
                        console.error('Erreur chargement utilisateurs:', error);
                    }
                }

                document.getElementById('form-change-password').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        old_password: document.getElementById('old-password').value,
                        new_username: document.getElementById('new-username').value,
                        new_password: document.getElementById('new-password').value
                    };

                    try {
                        const result = await apiCall('/api/change_credentials', 'POST', data);
                        showNotification(t('credentials_changed'), 'success');
                        setTimeout(() => {
                            window.location.href = '/login';
                        }, 2000);
                    } catch (error) { }
                });

                document.getElementById('form-change-user-password').addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const data = {
                        role: 'user',
                        new_username: document.getElementById('user-new-username').value,
                        new_password: document.getElementById('user-new-password').value
                    };

                    try {
                        const result = await apiCall('/api/change_user_credentials', 'POST', data);
                        showNotification(t('user_credentials_changed') || 'Identifiants utilisateur modifi√©s', 'success');
                        closeUserModal();
                    } catch (error) { }
                });

                // ==================== User Info ====================
                async function loadUserInfo() {
                    try {
                        const result = await apiCall('/api/get_user_info');
                        if (result.username) {
                            document.getElementById('system-user').textContent = result.username;
                        }
                    } catch (error) {
                        console.error('User info load error:', error);
                    }
                }

                // Initial load
                loadLanguage();
                loadSettings();
                loadLicenseInfo();
                loadUserInfo();
                loadMailRecapSettings();

                // ==================== Navigation depuis le menu hamburger ====================
                function switchSection(section) {
                    // Update menu active state
                    document.querySelectorAll('.menu-nav-item').forEach(i =>
                        i.classList.remove('active'));
                    document.querySelector('.menu-nav-item[data-section="' + section + '"]').classList.add('active');

                    // Update content visibility
                    document.querySelectorAll('.content-section').forEach(s =>
                        s.classList.remove('active'));
                    document.getElementById('content-' + section).classList.add('active');

                    // Fermer le menu apr√®s s√©lection
                    toggleMenu();

                    // Scroll to top of content
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            </script>

        </div><!-- Fin collapsible-grid configuration -->
    </div><!-- Fin content-configuration -->

    <!-- Liste des h√¥tes (toujours visible en bas) -->
    <div class="card full-width" style="margin-top: 20px;">
        <h2>üìã <span data-i18n="hosts_list">Liste des H√¥tes Monitor√©s</span></h2>
        <div class="hosts-table">
            <table>
                <thead>
                    <tr>
                        <th style="cursor: pointer;" onclick="sortHosts('ip')">IP <span id="sort-ip"
                                class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th style="cursor: pointer;" onclick="sortHosts('nom')" data-i18n="name">Nom <span id="sort-nom"
                                class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th style="cursor: pointer;" onclick="sortHosts('mac')">MAC <span id="sort-mac"
                                class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th style="cursor: pointer;" onclick="sortHosts('port')">Port <span id="sort-port"
                                class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th style="cursor: pointer;" onclick="sortHosts('delai')" data-i18n="delay">D√©lai <span
                                id="sort-delai" class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th style="cursor: pointer;" onclick="sortHosts('site')" data-i18n="site">Site <span
                                id="sort-site" class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th data-i18n="status">Statut</th>
                        <th data-i18n="actions">Actions</th>
                        <th><input type="checkbox" id="select-all-hosts" onclick="toggleSelectAll(this)"></th>
                    </tr>
                </thead>
                <tbody id="hosts-table-body">
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: #9ca3af;"
                            data-i18n="no_hosts_configured">
                            Aucun h√¥te configur√©. Ajoutez des h√¥tes pour commencer le monitoring.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div><!-- Fin main-content-full -->
    </div><!-- Fin container -->
</body>

</html>