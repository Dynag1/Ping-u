<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Ping √º</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #333;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Language selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 20px;
        }

        .lang-selector label {
            color: #6b7280;
            font-size: 12px;
            font-weight: 600;
        }

        .lang-selector select {
            background: transparent;
            border: none;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 4px;
        }

        .lang-selector select:focus {
            outline: none;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-info {
            background: #3b82f6;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        .hosts-table {
            width: 100%;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .hosts-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .hosts-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .hosts-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }

        .hosts-table tr:hover {
            background: #f9fafb;
        }

        .host-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .host-status.online {
            background: #d1fae5;
            color: #065f46;
        }

        .host-status.offline {
            background: #fee2e2;
            color: #991b1b;
        }

        .host-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 6px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .status-indicator.running {
            background: #d1fae5;
            color: #065f46;
        }

        .status-indicator.stopped {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.running {
            background: #10b981;
        }

        .status-dot.stopped {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card .label {
            color: #6b7280;
            font-size: 14px;
        }

        .stat-card.total .value { color: #3b82f6; }
        .stat-card.online .value { color: #10b981; }
        .stat-card.offline .value { color: #ef4444; }
        .stat-card.monitoring .value { color: #8b5cf6; }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        .notification.success {
            background: #10b981;
        }

        .notification.error {
            background: #ef4444;
        }

        .notification.info {
            background: #3b82f6;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .accordion {
            margin-bottom: 10px;
        }

        .accordion-header {
            background: #f3f4f6;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            font-weight: 600;
            color: #374151;
        }

        .accordion-header:hover {
            background: #e5e7eb;
        }

        .accordion-header.active {
            background: #667eea;
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .accordion-content {
            display: none;
            padding: 20px;
            background: #f9fafb;
            border-radius: 0 0 8px 8px;
            margin-bottom: 10px;
        }

        .accordion-content.active {
            display: block;
        }

        .accordion-icon {
            transition: transform 0.3s;
        }

        .accordion-icon.active {
            transform: rotate(180deg);
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>‚öôÔ∏è <span data-i18n="admin_title">Administration - Ping √º</span></h1>
            <div class="header-actions">
                <div class="lang-selector">
                    <label>üåç</label>
                    <select id="lang-select" onchange="changeLanguage(this.value)">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <div class="status-indicator" id="monitoring-status">
                    <span class="status-dot stopped"></span>
                    <span data-i18n="status_stopped">Arr√™t√©</span>
                </div>
                <button id="btn-change-password" class="btn btn-info">üîë <span data-i18n="change_credentials">Changer identifiants</span></button>
                <a href="/" class="btn btn-secondary">üìä <span data-i18n="monitoring_view">Vue Monitoring</span></a>
                <button id="btn-logout" class="btn btn-danger">üö™ <span data-i18n="logout">D√©connexion</span></button>
            </div>
        </div>

        <!-- Modal Changement de mot de passe -->
        <div id="modal-change-password" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                <h2 style="margin-bottom: 20px; color: #333;" data-i18n="change_credentials_title">Changer les identifiants</h2>
                <form id="form-change-password">
                    <div class="form-group">
                        <label data-i18n="current_password">Mot de passe actuel</label>
                        <input type="password" id="old-password" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="new_username">Nouveau nom d'utilisateur</label>
                        <input type="text" id="new-username" required>
                    </div>
                    <div class="form-group">
                        <label data-i18n="new_password">Nouveau mot de passe</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ <span data-i18n="save">Enregistrer</span></button>
                        <button type="button" id="btn-cancel-change" class="btn btn-secondary" style="flex: 1;">‚ùå <span data-i18n="cancel">Annuler</span></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="value" id="stat-total">0</div>
                <div class="label" data-i18n="total_hosts">Total H√¥tes</div>
            </div>
            <div class="stat-card online">
                <div class="value" id="stat-online">0</div>
                <div class="label" data-i18n="online">En ligne</div>
            </div>
            <div class="stat-card offline">
                <div class="value" id="stat-offline">0</div>
                <div class="label" data-i18n="offline">Hors ligne</div>
            </div>
            <div class="stat-card monitoring">
                <div class="value" id="stat-delai">0</div>
                <div class="label" data-i18n="delay_sec">D√©lai (sec)</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Ajout d'IP -->
            <div class="card">
                <h2>‚ûï <span data-i18n="add_hosts">Ajout d'H√¥tes</span></h2>
                <form id="form-add-hosts">
                    <div class="form-group">
                        <label for="input-ip" data-i18n="base_ip">Adresse IP de base</label>
                        <input type="text" id="input-ip" placeholder="192.168.1.1" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-hosts" data-i18n="hosts_count">Nombre d'h√¥tes</label>
                            <input type="number" id="input-hosts" value="1" min="1" max="255">
                        </div>
                        <div class="form-group">
                            <label for="input-port">Port</label>
                            <input type="text" id="input-port" value="80">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="select-scan-type" data-i18n="scan_type">Type de scan</label>
                        <select id="select-scan-type">
                            <option value="alive" data-i18n="scan_alive">Alive (actifs uniquement)</option>
                            <option value="all" data-i18n="scan_all">Tous les h√¥tes</option>
                            <option value="site" data-i18n="scan_site">Site sp√©cifique</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üîç <span data-i18n="scan_hosts">Scanner les h√¥tes</span>
                    </button>
                </form>
            </div>

            <!-- Contr√¥le du Monitoring -->
            <div class="card">
                <h2>üéÆ <span data-i18n="monitoring_control">Contr√¥le du Monitoring</span></h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="input-delai" data-i18n="ping_delay">D√©lai entre pings (sec)</label>
                        <input type="number" id="input-delai" value="10" min="1" max="3600">
                    </div>
                    <div class="form-group">
                        <label for="input-nb-hs" data-i18n="hs_before_alert">Nombre de HS avant alerte</label>
                        <input type="number" id="input-nb-hs" value="3" min="1" max="10">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="btn-start-monitoring" class="btn btn-primary" style="flex: 1;">
                        ‚ñ∂Ô∏è <span data-i18n="start">D√©marrer</span>
                    </button>
                    <button id="btn-stop-monitoring" class="btn btn-danger" style="flex: 1;">
                        ‚èπÔ∏è <span data-i18n="stop">Arr√™ter</span>
                    </button>
                </div>
            </div>

            <!-- Alertes -->
            <div class="card">
                <h2>üîî <span data-i18n="alerts_config">Configuration des Alertes</span></h2>
                <div class="checkbox-group">
                    <input type="checkbox" id="check-popup">
                    <label for="check-popup">üí¨ <span data-i18n="alert_popup">Popup (notification visuelle)</span></label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="check-mail">
                    <label for="check-mail">üìß <span data-i18n="alert_email">Email d'alerte</span></label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="check-telegram">
                    <label for="check-telegram">üì± Telegram</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="check-mail-recap">
                    <label for="check-mail-recap">üìä <span data-i18n="alert_recap">Email r√©capitulatif</span></label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="check-db-externe">
                    <label for="check-db-externe">üíæ <span data-i18n="alert_db">Base de donn√©es externe</span></label>
                </div>
                
                <!-- Alerte Temp√©rature -->
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <div class="checkbox-group">
                        <input type="checkbox" id="check-temp-alert">
                        <label for="check-temp-alert">üå°Ô∏è <span data-i18n="alert_temp">Alerte temp√©rature √©lev√©e</span></label>
                    </div>
                    <div class="form-group" style="margin-top: 10px;">
                        <label for="input-temp-seuil" data-i18n="temp_threshold">Seuil de temp√©rature (¬∞C)</label>
                        <input type="number" id="input-temp-seuil" value="70" min="30" max="120" style="width: 100px;">
                        <small style="color: #666; font-size: 12px; margin-left: 10px;" data-i18n="alert_if_temp">
                            Alerte si temp√©rature ‚â• seuil
                        </small>
                    </div>
                </div>
                
                <button id="btn-save-alerts" class="btn btn-info" style="width: 100%; margin-top: 15px;">
                    üíæ <span data-i18n="save_alerts">Sauvegarder les alertes</span>
                </button>
            </div>

            <!-- Actions rapides -->
            <div class="card">
                <h2>‚ö° <span data-i18n="quick_actions">Actions Rapides</span></h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button id="btn-clear-all" class="btn btn-danger">
                        üóëÔ∏è <span data-i18n="clear_all">Tout effacer</span>
                    </button>
                    <button id="btn-remove-duplicates" class="btn btn-warning">
                        üîÑ <span data-i18n="remove_duplicates">Suppr. doublons</span>
                    </button>
                    <button id="btn-export-csv" class="btn btn-info">
                        üì• <span data-i18n="export_csv">Exporter CSV</span>
                    </button>
                    <button id="btn-import-csv" class="btn btn-info">
                        üì§ <span data-i18n="import_csv">Importer CSV</span>
                    </button>
                    <button id="btn-save-settings" class="btn btn-primary">
                        üíæ <span data-i18n="save">Sauvegarder</span>
                    </button>
                </div>
                <input type="file" id="file-import-csv" accept=".csv" style="display: none;">
            </div>
        </div>

        <!-- Param√®tres Avanc√©s -->
        <div class="card full-width">
            <h2>‚öôÔ∏è <span data-i18n="advanced_settings">Param√®tres Avanc√©s</span></h2>
            
            <!-- Configuration SMTP -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('smtp')">
                    <span>üìß <span data-i18n="smtp_config">Configuration Email (SMTP)</span></span>
                    <span class="accordion-icon" id="icon-smtp">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-smtp">
                    <form id="form-smtp">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="smtp-server" data-i18n="smtp_server">Serveur SMTP</label>
                                <input type="text" id="smtp-server" placeholder="smtp.gmail.com">
                            </div>
                            <div class="form-group">
                                <label for="smtp-port">Port</label>
                                <input type="number" id="smtp-port" placeholder="587" value="587">
                                <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                                    üí° Port 587 (STARTTLS) <span data-i18n="or">ou</span> 465 (SSL/TLS)
                                </small>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="smtp-email" data-i18n="sender_email">Email exp√©diteur</label>
                            <input type="email" id="smtp-email" placeholder="votre-email@gmail.com">
                        </div>
                        <div class="form-group">
                            <label for="smtp-password" data-i18n="password">Mot de passe</label>
                            <input type="password" id="smtp-password" data-placeholder-i18n="password_placeholder" placeholder="Mot de passe ou app password">
                        </div>
                        <div class="form-group">
                            <label for="smtp-recipients" data-i18n="recipients">Destinataires (s√©par√©s par des virgules)</label>
                            <input type="text" id="smtp-recipients" placeholder="email1@exemple.com, email2@exemple.com">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ <span data-i18n="save">Sauvegarder</span>
                            </button>
                            <button type="button" class="btn btn-info" onclick="testSMTP()" style="flex: 1;">
                                ‚úâÔ∏è <span data-i18n="test">Tester</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Configuration Telegram -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('telegram')">
                    <span>üì± <span data-i18n="telegram_config">Configuration Telegram</span></span>
                    <span class="accordion-icon" id="icon-telegram">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-telegram">
                    <form id="form-telegram">
                        <div class="form-group">
                            <label for="telegram-token" data-i18n="bot_token">Token du Bot</label>
                            <input type="text" id="telegram-token" placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz">
                        </div>
                        <div class="form-group">
                            <label for="telegram-chatid">Chat ID</label>
                            <input type="text" id="telegram-chatid" placeholder="123456789">
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ <span data-i18n="save">Sauvegarder</span>
                            </button>
                            <button type="button" class="btn btn-info" onclick="testTelegram()" style="flex: 1;">
                                üì≤ <span data-i18n="test">Tester</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Configuration Email R√©capitulatif -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('mailrecap')">
                    <span>üìä <span data-i18n="recap_email_config">Email R√©capitulatif P√©riodique</span></span>
                    <span class="accordion-icon" id="icon-mailrecap">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-mailrecap">
                    <form id="form-mail-recap">
                        <div class="form-group">
                            <label for="recap-heure" data-i18n="send_time">Heure d'envoi</label>
                            <input type="time" id="recap-heure" value="08:00">
                        </div>
                        <div style="background: #f9fafb; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #374151;" data-i18n="send_days">Jours d'envoi</label>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-lundi">
                                    <label for="recap-lundi" data-i18n="monday">Lundi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-mardi">
                                    <label for="recap-mardi" data-i18n="tuesday">Mardi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-mercredi">
                                    <label for="recap-mercredi" data-i18n="wednesday">Mercredi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-jeudi">
                                    <label for="recap-jeudi" data-i18n="thursday">Jeudi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-vendredi">
                                    <label for="recap-vendredi" data-i18n="friday">Vendredi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0;">
                                    <input type="checkbox" id="recap-samedi">
                                    <label for="recap-samedi" data-i18n="saturday">Samedi</label>
                                </div>
                                <div class="checkbox-group" style="margin: 0; grid-column: 1 / -1;">
                                    <input type="checkbox" id="recap-dimanche">
                                    <label for="recap-dimanche" data-i18n="sunday">Dimanche</label>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                üíæ <span data-i18n="save">Sauvegarder</span>
                            </button>
                            <button type="button" class="btn btn-info" onclick="sendTestRecap()" style="flex: 1;">
                                üì® <span data-i18n="send_test">Envoyer un test</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Param√®tres G√©n√©raux -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('general')">
                    <span>üåê <span data-i18n="general_settings">Param√®tres G√©n√©raux</span></span>
                    <span class="accordion-icon" id="icon-general">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-general">
                    <form id="form-general">
                        <div class="form-group">
                            <label for="general-site" data-i18n="site_name">Nom du Site</label>
                            <input type="text" id="general-site" placeholder="Site">
                        </div>
                        <div class="form-group">
                            <label for="general-theme" data-i18n="theme">Th√®me</label>
                            <select id="general-theme">
                                <option value="nord">Nord</option>
                                <option value="dark">Dark</option>
                                <option value="light">Light</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            üíæ <span data-i18n="save">Sauvegarder</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Licence -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('license')">
                    <span>üîë <span data-i18n="license_management">Gestion de Licence</span></span>
                    <span class="accordion-icon" id="icon-license">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-license">
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 24px;" id="license-icon">‚ùå</span>
                            <div>
                                <div style="font-weight: 600; color: #374151;" id="license-status" data-i18n="no_license">Pas de licence active</div>
                                <div style="font-size: 13px; color: #6b7280;" id="license-days"></div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; border-top: 1px solid #e5e7eb; padding-top: 10px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;" data-i18n="activation_code_label">Code d'activation (Hardware ID) √† envoyer :</div>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="activation-code" readonly style="background: #e5e7eb; color: #374151; font-family: monospace; font-size: 14px;" onclick="this.select()">
                                <button class="btn btn-secondary btn-small" onclick="navigator.clipboard.writeText(document.getElementById('activation-code').value); showNotification(t('copied'), 'success')">üìã</button>
                            </div>
                        </div>
                    </div>
                    <form id="form-license">
                        <div class="form-group">
                            <label for="license-key" data-i18n="license_key">Cl√© de licence</label>
                            <input type="text" id="license-key" data-placeholder-i18n="enter_license" placeholder="Entrez votre cl√© de licence">
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            üîì <span data-i18n="activate_license">Activer la licence</span>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Informations Syst√®me -->
            <div class="accordion">
                <div class="accordion-header" onclick="toggleAccordion('system')">
                    <span>‚ÑπÔ∏è <span data-i18n="system_info">Informations Syst√®me</span></span>
                    <span class="accordion-icon" id="icon-system">‚ñº</span>
                </div>
                <div class="accordion-content" id="content-system">
                    <div style="background: #f3f4f6; padding: 15px; border-radius: 8px;">
                        <div style="margin-bottom: 10px;">
                            <strong>Version:</strong> <span id="system-version">-</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Mode:</strong> <span data-i18n="web_server">Serveur Web</span>
                        </div>
                        <div style="margin-bottom: 10px;">
                            <strong>Port:</strong> <span>9090</span>
                        </div>
                        <div>
                            <strong data-i18n="connected_user">Utilisateur connect√©:</strong> <span id="system-user">admin</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Liste des h√¥tes -->
        <div class="card full-width">
            <h2>üìã <span data-i18n="hosts_list">Liste des H√¥tes Monitor√©s</span></h2>
            <div class="hosts-table">
                <table>
                    <thead>
                        <tr>
                            <th style="cursor: pointer;" onclick="sortHosts('ip')">IP <span id="sort-ip" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('nom')" data-i18n="name">Nom <span id="sort-nom" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('mac')">MAC <span id="sort-mac" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('port')">Port <span id="sort-port" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('latence')" data-i18n="latency">Latence <span id="sort-latence" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('temp')" data-i18n="temperature">Temp√©rature <span id="sort-temp" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="cursor: pointer;" onclick="sortHosts('status')" data-i18n="status">Statut <span id="sort-status" class="sort-icon">‚ÜïÔ∏è</span></th>
                            <th style="width: 150px;" data-i18n="actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="hosts-table-body">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #9ca3af;" data-i18n="no_hosts_configured">
                                Aucun h√¥te configur√©. Ajoutez des h√¥tes pour commencer le monitoring.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ==================== Syst√®me de traduction ====================
        const translations = {
            fr: {
                admin_title: "Administration - Ping √º",
                change_credentials: "Changer identifiants",
                monitoring_view: "Vue Monitoring",
                logout: "D√©connexion",
                status_running: "En cours",
                status_stopped: "Arr√™t√©",
                change_credentials_title: "Changer les identifiants",
                current_password: "Mot de passe actuel",
                new_username: "Nouveau nom d'utilisateur",
                new_password: "Nouveau mot de passe",
                save: "Enregistrer",
                cancel: "Annuler",
                total_hosts: "Total H√¥tes",
                online: "En ligne",
                offline: "Hors ligne",
                delay_sec: "D√©lai (sec)",
                add_hosts: "Ajout d'H√¥tes",
                base_ip: "Adresse IP de base",
                hosts_count: "Nombre d'h√¥tes",
                scan_type: "Type de scan",
                scan_alive: "Alive (actifs uniquement)",
                scan_all: "Tous les h√¥tes",
                scan_site: "Site sp√©cifique",
                scan_hosts: "Scanner les h√¥tes",
                monitoring_control: "Contr√¥le du Monitoring",
                ping_delay: "D√©lai entre pings (sec)",
                hs_before_alert: "Nombre de HS avant alerte",
                start: "D√©marrer",
                stop: "Arr√™ter",
                alerts_config: "Configuration des Alertes",
                alert_popup: "Popup (notification visuelle)",
                alert_email: "Email d'alerte",
                alert_recap: "Email r√©capitulatif",
                alert_db: "Base de donn√©es externe",
                alert_temp: "Alerte temp√©rature √©lev√©e",
                temp_threshold: "Seuil de temp√©rature (¬∞C)",
                alert_if_temp: "Alerte si temp√©rature ‚â• seuil",
                save_alerts: "Sauvegarder les alertes",
                quick_actions: "Actions Rapides",
                clear_all: "Tout effacer",
                remove_duplicates: "Suppr. doublons",
                export_csv: "Exporter CSV",
                import_csv: "Importer CSV",
                advanced_settings: "Param√®tres Avanc√©s",
                smtp_config: "Configuration Email (SMTP)",
                smtp_server: "Serveur SMTP",
                or: "ou",
                sender_email: "Email exp√©diteur",
                password: "Mot de passe",
                password_placeholder: "Mot de passe ou app password",
                recipients: "Destinataires (s√©par√©s par des virgules)",
                test: "Tester",
                telegram_config: "Configuration Telegram",
                bot_token: "Token du Bot",
                recap_email_config: "Email R√©capitulatif P√©riodique",
                send_time: "Heure d'envoi",
                send_days: "Jours d'envoi",
                monday: "Lundi",
                tuesday: "Mardi",
                wednesday: "Mercredi",
                thursday: "Jeudi",
                friday: "Vendredi",
                saturday: "Samedi",
                sunday: "Dimanche",
                send_test: "Envoyer un test",
                general_settings: "Param√®tres G√©n√©raux",
                site_name: "Nom du Site",
                theme: "Th√®me",
                license_management: "Gestion de Licence",
                no_license: "Pas de licence active",
                license_active: "Licence active",
                days_remaining: "jours restants",
                features_limited: "Certaines fonctionnalit√©s sont limit√©es (Alertes)",
                activation_code_label: "Code d'activation (Hardware ID) √† envoyer :",
                license_key: "Cl√© de licence",
                enter_license: "Entrez votre cl√© de licence",
                activate_license: "Activer la licence",
                system_info: "Informations Syst√®me",
                web_server: "Serveur Web",
                connected_user: "Utilisateur connect√©:",
                hosts_list: "Liste des H√¥tes Monitor√©s",
                name: "Nom",
                latency: "Latence",
                temperature: "Temp√©rature",
                status: "Statut",
                actions: "Actions",
                no_hosts_configured: "Aucun h√¥te configur√©. Ajoutez des h√¥tes pour commencer le monitoring.",
                status_online: "En ligne",
                status_offline: "Hors ligne",
                copied: "Copi√© !",
                confirm_delete_all: "Voulez-vous vraiment effacer tous les h√¥tes ?",
                confirm_delete_host: "Voulez-vous vraiment supprimer l'h√¥te",
                confirm_logout: "Voulez-vous vraiment vous d√©connecter ?",
                monitoring_started: "Monitoring d√©marr√©",
                monitoring_stopped: "Monitoring arr√™t√©",
                alerts_saved: "Alertes sauvegard√©es",
                all_hosts_deleted: "Tous les h√¥tes ont √©t√© supprim√©s",
                duplicates_removed: "doublon(s) supprim√©(s)",
                no_duplicates: "Aucun doublon trouv√©",
                export_started: "Export CSV d√©marr√©",
                import_success: "Import r√©ussi",
                settings_saved: "Param√®tres sauvegard√©s",
                host_deleted: "H√¥te supprim√©",
                host_excluded: "H√¥te exclu",
                host_included: "H√¥te r√©inclus",
                name_modified: "Nom modifi√© pour",
                smtp_saved: "Configuration SMTP sauvegard√©e",
                test_email_sent: "Email de test envoy√©",
                telegram_saved: "Configuration Telegram sauvegard√©e",
                telegram_test_sent: "Message de test envoy√© sur Telegram",
                recap_saved: "Configuration email r√©capitulatif sauvegard√©e",
                recap_test_sent: "Email r√©capitulatif de test envoy√©",
                general_saved: "Param√®tres g√©n√©raux sauvegard√©s",
                license_saved: "Licence enregistr√©e",
                credentials_changed: "Identifiants modifi√©s ! Reconnexion n√©cessaire.",
                scan_complete: "Scan termin√© !",
                hosts_scanned: "h√¥te(s) scann√©(s)",
                requires_license: "N√©cessite une licence active",
                edit_name: "Modifier le nom",
                delete: "Supprimer",
                include_excluded: "Inclure (Actuellement exclu)",
                exclude: "Exclure"
            },
            en: {
                admin_title: "Administration - Ping √º",
                change_credentials: "Change credentials",
                monitoring_view: "Monitoring View",
                logout: "Logout",
                status_running: "Running",
                status_stopped: "Stopped",
                change_credentials_title: "Change credentials",
                current_password: "Current password",
                new_username: "New username",
                new_password: "New password",
                save: "Save",
                cancel: "Cancel",
                total_hosts: "Total Hosts",
                online: "Online",
                offline: "Offline",
                delay_sec: "Delay (sec)",
                add_hosts: "Add Hosts",
                base_ip: "Base IP address",
                hosts_count: "Number of hosts",
                scan_type: "Scan type",
                scan_alive: "Alive (active only)",
                scan_all: "All hosts",
                scan_site: "Specific site",
                scan_hosts: "Scan hosts",
                monitoring_control: "Monitoring Control",
                ping_delay: "Delay between pings (sec)",
                hs_before_alert: "Failures before alert",
                start: "Start",
                stop: "Stop",
                alerts_config: "Alerts Configuration",
                alert_popup: "Popup (visual notification)",
                alert_email: "Alert email",
                alert_recap: "Summary email",
                alert_db: "External database",
                alert_temp: "High temperature alert",
                temp_threshold: "Temperature threshold (¬∞C)",
                alert_if_temp: "Alert if temperature ‚â• threshold",
                save_alerts: "Save alerts",
                quick_actions: "Quick Actions",
                clear_all: "Clear all",
                remove_duplicates: "Remove duplicates",
                export_csv: "Export CSV",
                import_csv: "Import CSV",
                advanced_settings: "Advanced Settings",
                smtp_config: "Email Configuration (SMTP)",
                smtp_server: "SMTP Server",
                or: "or",
                sender_email: "Sender email",
                password: "Password",
                password_placeholder: "Password or app password",
                recipients: "Recipients (comma separated)",
                test: "Test",
                telegram_config: "Telegram Configuration",
                bot_token: "Bot Token",
                recap_email_config: "Periodic Summary Email",
                send_time: "Send time",
                send_days: "Send days",
                monday: "Monday",
                tuesday: "Tuesday",
                wednesday: "Wednesday",
                thursday: "Thursday",
                friday: "Friday",
                saturday: "Saturday",
                sunday: "Sunday",
                send_test: "Send a test",
                general_settings: "General Settings",
                site_name: "Site Name",
                theme: "Theme",
                license_management: "License Management",
                no_license: "No active license",
                license_active: "License active",
                days_remaining: "days remaining",
                features_limited: "Some features are limited (Alerts)",
                activation_code_label: "Activation code (Hardware ID) to send:",
                license_key: "License key",
                enter_license: "Enter your license key",
                activate_license: "Activate license",
                system_info: "System Information",
                web_server: "Web Server",
                connected_user: "Connected user:",
                hosts_list: "Monitored Hosts List",
                name: "Name",
                latency: "Latency",
                temperature: "Temperature",
                status: "Status",
                actions: "Actions",
                no_hosts_configured: "No hosts configured. Add hosts to start monitoring.",
                status_online: "Online",
                status_offline: "Offline",
                copied: "Copied!",
                confirm_delete_all: "Are you sure you want to delete all hosts?",
                confirm_delete_host: "Are you sure you want to delete host",
                confirm_logout: "Are you sure you want to logout?",
                monitoring_started: "Monitoring started",
                monitoring_stopped: "Monitoring stopped",
                alerts_saved: "Alerts saved",
                all_hosts_deleted: "All hosts have been deleted",
                duplicates_removed: "duplicate(s) removed",
                no_duplicates: "No duplicates found",
                export_started: "CSV export started",
                import_success: "Import successful",
                settings_saved: "Settings saved",
                host_deleted: "Host deleted",
                host_excluded: "Host excluded",
                host_included: "Host re-included",
                name_modified: "Name modified for",
                smtp_saved: "SMTP configuration saved",
                test_email_sent: "Test email sent",
                telegram_saved: "Telegram configuration saved",
                telegram_test_sent: "Test message sent on Telegram",
                recap_saved: "Summary email configuration saved",
                recap_test_sent: "Test summary email sent",
                general_saved: "General settings saved",
                license_saved: "License saved",
                credentials_changed: "Credentials changed! Reconnection required.",
                scan_complete: "Scan complete!",
                hosts_scanned: "host(s) scanned",
                requires_license: "Requires active license",
                edit_name: "Edit name",
                delete: "Delete",
                include_excluded: "Include (Currently excluded)",
                exclude: "Exclude"
            }
        };

        let currentLang = 'fr';

        // D√©tecter la langue du navigateur
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            return browserLang.startsWith('fr') ? 'fr' : 'en';
        }

        // Charger la langue sauvegard√©e ou d√©tecter automatiquement
        function loadLanguage() {
            const savedLang = localStorage.getItem('ping√º_lang');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
            } else {
                currentLang = detectBrowserLanguage();
            }
            document.getElementById('lang-select').value = currentLang;
            applyTranslations();
        }

        // Changer la langue
        function changeLanguage(lang) {
            if (translations[lang]) {
                currentLang = lang;
                localStorage.setItem('ping√º_lang', lang);
                applyTranslations();
                // Re-render le tableau des h√¥tes
                if (hostsData.length > 0) {
                    updateHostsTable(hostsData);
                }
            }
        }

        // Appliquer les traductions
        function applyTranslations() {
            const trans = translations[currentLang];
            
            // Mettre √† jour les √©l√©ments avec data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (trans[key]) {
                    el.textContent = trans[key];
                }
            });

            // Mettre √† jour les placeholders
            document.querySelectorAll('[data-placeholder-i18n]').forEach(el => {
                const key = el.getAttribute('data-placeholder-i18n');
                if (trans[key]) {
                    el.placeholder = trans[key];
                }
            });

            // Mettre √† jour les options des selects
            document.querySelectorAll('select option[data-i18n]').forEach(option => {
                const key = option.getAttribute('data-i18n');
                if (key && trans[key]) {
                    option.textContent = trans[key];
                }
            });

            // Mettre √† jour le titre de la page
            document.title = trans.admin_title;
            
            // Mettre √† jour l'attribut lang du HTML
            document.documentElement.lang = currentLang;

            // Mettre √† jour le statut du monitoring
            updateMonitoringStatus(monitoringRunning);
        }

        // Fonction d'aide pour obtenir une traduction
        function t(key) {
            return translations[currentLang][key] || key;
        }

        // ==================== Socket.IO ====================
        const socket = io({
            transports: ['websocket', 'polling'],
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionAttempts: 10
        });

        let hostsData = [];
        let monitoringRunning = false;

        // ==================== Socket Events ====================
        socket.on('connect', function() {
            console.log('‚úÖ Connected to server');
            loadSettings();
            socket.emit('request_update');
        });

        socket.on('disconnect', function() {
            console.log('‚ùå Disconnected from server');
        });

        socket.on('hosts_update', function(hosts) {
            if (!Array.isArray(hosts)) {
                hosts = [];
            }
            hostsData = hosts;
            // Appliquer le tri actuel si d√©fini
            if (currentSort.column) {
                const savedDirection = currentSort.direction;
                currentSort.direction = savedDirection === 'asc' ? 'desc' : 'asc';
                sortHosts(currentSort.column);
            } else {
                updateHostsTable(hosts);
            }
            updateStats(hosts);
        });

        socket.on('monitoring_status', function(data) {
            monitoringRunning = data.running;
            updateMonitoringStatus(data.running);
        });

        socket.on('notification', function(data) {
            showNotification(data.message, data.type || 'info');
        });

        socket.on('scan_complete', function(data) {
            console.log('üì° Scan complete:', data.count, 'host(s)');
            showNotification(`${t('scan_complete')} ${data.count} ${t('hosts_scanned')}`, 'success');
            showBrowserNotification(t('scan_complete'), `${data.count} ${t('hosts_scanned')}`);
            socket.emit('request_update');
        });

        // ==================== Sorting Functions ====================
        let currentSort = { column: 'ip', direction: 'asc' };

        function naturalSort(a, b) {
            const ax = [], bx = [];
            a.replace(/(\d+)|(\D+)/g, function(_, $1, $2) { ax.push([$1 || Infinity, $2 || ""]) });
            b.replace(/(\d+)|(\D+)/g, function(_, $1, $2) { bx.push([$1 || Infinity, $2 || ""]) });
            while(ax.length && bx.length) {
                const an = ax.shift();
                const bn = bx.shift();
                const nn = (an[0] - bn[0]) || an[1].localeCompare(bn[1]);
                if(nn) return nn;
            }
            return ax.length - bx.length;
        }

        function sortHosts(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            document.querySelectorAll('.sort-icon').forEach(icon => icon.textContent = '‚ÜïÔ∏è');
            const currentIcon = document.getElementById(`sort-${column}`);
            if (currentIcon) {
                currentIcon.textContent = currentSort.direction === 'asc' ? '‚¨ÜÔ∏è' : '‚¨áÔ∏è';
            }

            hostsData.sort((a, b) => {
                let valA = a[column] || '';
                let valB = b[column] || '';

                if (column === 'ip') {
                    const ipA = valA.split('.').map(Number);
                    const ipB = valB.split('.').map(Number);
                    for (let i = 0; i < 4; i++) {
                        if (ipA[i] !== ipB[i]) {
                            return (ipA[i] - ipB[i]) * (currentSort.direction === 'asc' ? 1 : -1);
                        }
                    }
                    return 0;
                }

                const comparison = naturalSort(String(valA), String(valB));
                return currentSort.direction === 'asc' ? comparison : -comparison;
            });

            updateHostsTable(hostsData);
        }

        function updateStats(hosts) {
            const total = hosts.length;
            const online = hosts.filter(h => h.status === 'online').length;
            const offline = total - online;

            document.getElementById('stat-total').textContent = total;
            document.getElementById('stat-online').textContent = online;
            document.getElementById('stat-offline').textContent = offline;
        }

        function updateMonitoringStatus(running) {
            const statusEl = document.getElementById('monitoring-status');
            const dot = statusEl.querySelector('.status-dot');
            const text = statusEl.querySelector('span[data-i18n]');

            if (running) {
                statusEl.className = 'status-indicator running';
                dot.className = 'status-dot running';
                text.textContent = t('status_running');
                text.setAttribute('data-i18n', 'status_running');
            } else {
                statusEl.className = 'status-indicator stopped';
                dot.className = 'status-dot stopped';
                text.textContent = t('status_stopped');
                text.setAttribute('data-i18n', 'status_stopped');
            }
        }

        function updateHostsTable(hosts) {
            const tbody = document.getElementById('hosts-table-body');
            
            if (hosts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: #9ca3af;">
                            ${t('no_hosts_configured')}
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = hosts.map(host => `
                <tr>
                    <td><strong>${escapeHtml(host.ip)}</strong></td>
                    <td>
                        <span class="host-name-display" id="name-display-${escapeHtml(host.ip).replace(/\./g, '-')}">${escapeHtml(host.nom) || '-'}</span>
                        <input type="text" class="host-name-input" id="name-input-${escapeHtml(host.ip).replace(/\./g, '-')}" 
                               value="${escapeHtml(host.nom)}" style="display: none; width: 100%; padding: 5px; border: 2px solid #667eea; border-radius: 4px;">
                    </td>
                    <td>${escapeHtml(host.mac) || '-'}</td>
                    <td>${escapeHtml(host.port) || '-'}</td>
                    <td>${escapeHtml(host.latence) || '-'}</td>
                    <td>${escapeHtml(host.temp) || '-'}</td>
                    <td>
                        <span class="host-status ${host.status}">
                            ${host.status === 'online' ? t('status_online') : t('status_offline')}
                        </span>
                    </td>
                    <td class="host-actions">
                        <button class="btn btn-info btn-small" onclick="editHostName('${host.ip}')" id="edit-btn-${escapeHtml(host.ip).replace(/\./g, '-')}" title="${t('edit_name')}">
                            ‚úèÔ∏è
                        </button>
                        <button class="btn btn-primary btn-small" onclick="saveHostName('${host.ip}')" id="save-btn-${escapeHtml(host.ip).replace(/\./g, '-')}" style="display: none;" title="${t('save')}">
                            üíæ
                        </button>
                        <button class="btn btn-danger btn-small" onclick="deleteHost('${host.ip}')" title="${t('delete')}">
                            üóëÔ∏è
                        </button>
                        <button class="btn ${host.excl === 'x' ? 'btn-secondary' : 'btn-secondary'} btn-small" 
                                onclick="excludeHost('${host.ip}', ${host.excl === 'x' ? true : false})" 
                                title="${host.excl === 'x' ? t('include_excluded') : t('exclude')}"
                                style="${host.excl === 'x' ? 'background: #f59e0b;' : ''}">
                            ${host.excl === 'x' ? '‚ö†Ô∏è' : 'üö´'}
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // ==================== API Functions ====================
        async function apiCall(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };

                if (data && method !== 'GET') {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(endpoint, options);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'API Error');
                }

                return result;
            } catch (error) {
                console.error('API Error:', error);
                showNotification('Error: ' + error.message, 'error');
                throw error;
            }
        }

        // ==================== Event Handlers ====================
        document.getElementById('form-add-hosts').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const data = {
                ip: document.getElementById('input-ip').value,
                hosts: parseInt(document.getElementById('input-hosts').value),
                port: document.getElementById('input-port').value,
                scan_type: document.getElementById('select-scan-type').value
            };

            try {
                const result = await apiCall('/api/add_hosts', 'POST', data);
                showNotification(result.message || t('scan_hosts'), 'success');
                setTimeout(() => socket.emit('request_update'), 2000);
            } catch (error) {}
        });

        document.getElementById('btn-start-monitoring').addEventListener('click', async function() {
            const delai = parseInt(document.getElementById('input-delai').value);
            const nbHs = parseInt(document.getElementById('input-nb-hs').value);

            try {
                const result = await apiCall('/api/start_monitoring', 'POST', { delai, nb_hs: nbHs });
                showNotification(t('monitoring_started'), 'success');
                monitoringRunning = true;
                updateMonitoringStatus(true);
            } catch (error) {}
        });

        document.getElementById('btn-stop-monitoring').addEventListener('click', async function() {
            try {
                const result = await apiCall('/api/stop_monitoring', 'POST');
                showNotification(t('monitoring_stopped'), 'info');
                monitoringRunning = false;
                updateMonitoringStatus(false);
            } catch (error) {}
        });

        document.getElementById('btn-save-alerts').addEventListener('click', async function() {
            const alerts = {
                popup: document.getElementById('check-popup').checked,
                mail: document.getElementById('check-mail').checked,
                telegram: document.getElementById('check-telegram').checked,
                mail_recap: document.getElementById('check-mail-recap').checked,
                db_externe: document.getElementById('check-db-externe').checked,
                temp_alert: document.getElementById('check-temp-alert').checked,
                temp_seuil: parseInt(document.getElementById('input-temp-seuil').value) || 70
            };

            try {
                const result = await apiCall('/api/save_alerts', 'POST', alerts);
                showNotification(t('alerts_saved'), 'success');
            } catch (error) {}
        });

        document.getElementById('btn-clear-all').addEventListener('click', async function() {
            if (!confirm(t('confirm_delete_all'))) {
                return;
            }

            try {
                const result = await apiCall('/api/clear_all', 'POST');
                showNotification(t('all_hosts_deleted'), 'info');
                socket.emit('request_update');
            } catch (error) {}
        });

        document.getElementById('btn-remove-duplicates').addEventListener('click', async function() {
            try {
                const result = await apiCall('/api/remove_duplicates', 'POST');
                if (result.duplicates_removed > 0) {
                    showNotification(`${result.duplicates_removed} ${t('duplicates_removed')}`, 'success');
                } else {
                    showNotification(t('no_duplicates'), 'info');
                }
                socket.emit('request_update');
            } catch (error) {}
        });

        document.getElementById('btn-export-csv').addEventListener('click', async function() {
            try {
                window.location.href = '/api/export_csv';
                showNotification(t('export_started'), 'success');
            } catch (error) {
                showNotification('Export error', 'error');
            }
        });

        document.getElementById('btn-import-csv').addEventListener('click', function() {
            document.getElementById('file-import-csv').click();
        });

        document.getElementById('file-import-csv').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/import_csv', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (response.ok) {
                    showNotification(result.message || t('import_success'), 'success');
                    socket.emit('request_update');
                } else {
                    showNotification(result.error || 'Import error', 'error');
                }
            } catch (error) {
                showNotification('Import error', 'error');
            }

            e.target.value = '';
        });

        document.getElementById('btn-save-settings').addEventListener('click', async function() {
            try {
                const result = await apiCall('/api/save_settings', 'POST');
                showNotification(t('settings_saved'), 'success');
            } catch (error) {}
        });

        // ==================== Host Actions ====================
        async function deleteHost(ip) {
            if (!confirm(`${t('confirm_delete_host')} ${ip} ?`)) {
                return;
            }

            try {
                const result = await apiCall('/api/delete_host', 'POST', { ip });
                showNotification(`${t('host_deleted')}: ${ip}`, 'info');
                socket.emit('request_update');
            } catch (error) {}
        }

        async function excludeHost(ip, isExcluded) {
            try {
                const endpoint = isExcluded ? '/api/include_host' : '/api/exclude_host';
                const message = isExcluded ? `${t('host_included')}: ${ip}` : `${t('host_excluded')}: ${ip}`;
                const type = isExcluded ? 'success' : 'info';
                
                const result = await apiCall(endpoint, 'POST', { ip });
                showNotification(message, type);
                socket.emit('request_update');
            } catch (error) {}
        }

        function editHostName(ip) {
            const ipClean = ip.replace(/\./g, '-');
            const displayEl = document.getElementById(`name-display-${ipClean}`);
            const inputEl = document.getElementById(`name-input-${ipClean}`);
            const editBtn = document.getElementById(`edit-btn-${ipClean}`);
            const saveBtn = document.getElementById(`save-btn-${ipClean}`);
            
            if (displayEl && inputEl && editBtn && saveBtn) {
                displayEl.style.display = 'none';
                inputEl.style.display = 'block';
                editBtn.style.display = 'none';
                saveBtn.style.display = 'inline-flex';
                inputEl.focus();
                inputEl.select();
            }
        }

        async function saveHostName(ip) {
            const ipClean = ip.replace(/\./g, '-');
            const displayEl = document.getElementById(`name-display-${ipClean}`);
            const inputEl = document.getElementById(`name-input-${ipClean}`);
            const editBtn = document.getElementById(`edit-btn-${ipClean}`);
            const saveBtn = document.getElementById(`save-btn-${ipClean}`);
            
            const newName = inputEl ? inputEl.value.trim() : '';
            
            try {
                const result = await apiCall('/api/update_host_name', 'POST', { 
                    ip: ip, 
                    name: newName 
                });
                
                if (displayEl) {
                    displayEl.textContent = newName || '-';
                    displayEl.style.display = 'inline';
                }
                if (inputEl) {
                    inputEl.style.display = 'none';
                }
                if (editBtn) {
                    editBtn.style.display = 'inline-flex';
                }
                if (saveBtn) {
                    saveBtn.style.display = 'none';
                }
                
                showNotification(`${t('name_modified')} ${ip}`, 'success');
                socket.emit('request_update');
            } catch (error) {}
        }

        // ==================== Settings ====================
        async function loadSettings() {
            try {
                const result = await apiCall('/api/get_settings');
                
                if (result.delai) {
                    document.getElementById('input-delai').value = result.delai;
                    document.getElementById('stat-delai').textContent = result.delai;
                }
                if (result.nb_hs) {
                    document.getElementById('input-nb-hs').value = result.nb_hs;
                }
                
                if (result.alerts) {
                    document.getElementById('check-popup').checked = result.alerts.popup || false;
                    document.getElementById('check-mail').checked = result.alerts.mail || false;
                    document.getElementById('check-telegram').checked = result.alerts.telegram || false;
                    document.getElementById('check-mail-recap').checked = result.alerts.mail_recap || false;
                    document.getElementById('check-db-externe').checked = result.alerts.db_externe || false;
                    document.getElementById('check-temp-alert').checked = result.alerts.temp_alert || false;
                    document.getElementById('input-temp-seuil').value = result.alerts.temp_seuil || 70;
                }
                
                if (typeof result.monitoring_running !== 'undefined') {
                    monitoringRunning = result.monitoring_running;
                    updateMonitoringStatus(result.monitoring_running);
                }
                
                if (result.smtp) {
                    document.getElementById('smtp-server').value = result.smtp.server || '';
                    document.getElementById('smtp-port').value = result.smtp.port || '587';
                    document.getElementById('smtp-email').value = result.smtp.email || '';
                    document.getElementById('smtp-recipients').value = result.smtp.recipients || '';
                }
                
                if (result.telegram) {
                    document.getElementById('telegram-token').value = result.telegram.token || '';
                    document.getElementById('telegram-chatid').value = result.telegram.chatid || '';
                }
                
                if (result.general) {
                    document.getElementById('general-site').value = result.general.site || '';
                    document.getElementById('general-theme').value = result.general.theme || 'nord';
                }
                
                if (result.version) {
                    document.getElementById('system-version').textContent = result.version;
                }
            } catch (error) {
                console.error('Settings load error:', error);
            }
        }

        // ==================== Utility Functions ====================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showBrowserNotification(title, body) {
            if (!("Notification" in window)) {
                return;
            }

            if (Notification.permission === "granted") {
                new Notification(title, {
                    body: body,
                    icon: '/static/favicon.ico',
                    badge: '/static/favicon.ico',
                    tag: 'scan-complete',
                    requireInteraction: false
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(function(permission) {
                    if (permission === "granted") {
                        new Notification(title, {
                            body: body,
                            icon: '/static/favicon.ico',
                            badge: '/static/favicon.ico',
                            tag: 'scan-complete'
                        });
                    }
                });
            }
        }

        if ("Notification" in window && Notification.permission === "default") {
            setTimeout(() => {
                Notification.requestPermission();
            }, 2000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==================== Auto-refresh ====================
        setInterval(() => {
            socket.emit('request_update');
        }, 10000);

        // ==================== Accordions ====================
        function toggleAccordion(id) {
            const content = document.getElementById('content-' + id);
            const icon = document.getElementById('icon-' + id);
            const header = icon.parentElement;
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                icon.classList.remove('active');
                header.classList.remove('active');
            } else {
                content.classList.add('active');
                icon.classList.add('active');
                header.classList.add('active');
            }
        }

        // ==================== Configuration SMTP ====================
        document.getElementById('form-smtp').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                server: document.getElementById('smtp-server').value,
                port: document.getElementById('smtp-port').value,
                email: document.getElementById('smtp-email').value,
                password: document.getElementById('smtp-password').value,
                recipients: document.getElementById('smtp-recipients').value
            };

            try {
                const result = await apiCall('/api/save_smtp', 'POST', data);
                showNotification(t('smtp_saved'), 'success');
            } catch (error) {}
        });

        async function testSMTP() {
            try {
                const result = await apiCall('/api/test_smtp', 'POST', {});
                showNotification(result.message || t('test_email_sent'), 'success');
            } catch (error) {}
        }

        // ==================== Configuration Telegram ====================
        document.getElementById('form-telegram').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                token: document.getElementById('telegram-token').value,
                chatid: document.getElementById('telegram-chatid').value
            };

            try {
                const result = await apiCall('/api/save_telegram', 'POST', data);
                showNotification(t('telegram_saved'), 'success');
            } catch (error) {}
        });

        async function testTelegram() {
            try {
                const result = await apiCall('/api/test_telegram', 'POST', {});
                showNotification(result.message || t('telegram_test_sent'), 'success');
            } catch (error) {}
        }

        // ==================== Email R√©capitulatif ====================
        document.getElementById('form-mail-recap').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                heure: document.getElementById('recap-heure').value,
                lundi: document.getElementById('recap-lundi').checked,
                mardi: document.getElementById('recap-mardi').checked,
                mercredi: document.getElementById('recap-mercredi').checked,
                jeudi: document.getElementById('recap-jeudi').checked,
                vendredi: document.getElementById('recap-vendredi').checked,
                samedi: document.getElementById('recap-samedi').checked,
                dimanche: document.getElementById('recap-dimanche').checked
            };

            try {
                const result = await apiCall('/api/save_mail_recap', 'POST', data);
                showNotification(t('recap_saved'), 'success');
            } catch (error) {}
        });

        async function sendTestRecap() {
            try {
                const result = await apiCall('/api/send_test_recap', 'POST', {});
                showNotification(result.message || t('recap_test_sent'), 'success');
            } catch (error) {}
        }

        async function loadMailRecapSettings() {
            try {
                const result = await apiCall('/api/get_mail_recap_settings');
                
                if (result.heure) {
                    document.getElementById('recap-heure').value = result.heure;
                }
                
                document.getElementById('recap-lundi').checked = result.lundi || false;
                document.getElementById('recap-mardi').checked = result.mardi || false;
                document.getElementById('recap-mercredi').checked = result.mercredi || false;
                document.getElementById('recap-jeudi').checked = result.jeudi || false;
                document.getElementById('recap-vendredi').checked = result.vendredi || false;
                document.getElementById('recap-samedi').checked = result.samedi || false;
                document.getElementById('recap-dimanche').checked = result.dimanche || false;
            } catch (error) {
                console.error('Mail recap settings load error:', error);
            }
        }

        // ==================== Param√®tres G√©n√©raux ====================
        document.getElementById('form-general').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                site: document.getElementById('general-site').value,
                license: '',
                theme: document.getElementById('general-theme').value
            };

            try {
                const result = await apiCall('/api/save_general', 'POST', data);
                showNotification(t('general_saved'), 'success');
            } catch (error) {}
        });

        // ==================== Licence ====================
        document.getElementById('form-license').addEventListener('submit', async function(e) {
            e.preventDefault();

            const licenseKey = document.getElementById('license-key').value;
            
            const data = {
                site: document.getElementById('general-site').value,
                license: licenseKey,
                theme: document.getElementById('general-theme').value
            };

            try {
                const result = await apiCall('/api/save_general', 'POST', data);
                showNotification(t('license_saved'), 'success');
                loadLicenseInfo();
            } catch (error) {}
        });

        async function loadLicenseInfo() {
            try {
                const result = await apiCall('/api/get_license_info');
                
                const icon = document.getElementById('license-icon');
                const status = document.getElementById('license-status');
                const days = document.getElementById('license-days');
                const codeInput = document.getElementById('activation-code');
                
                if (result.activation_code) {
                    codeInput.value = result.activation_code;
                }
                
                const isLicenseActive = result.active;
                
                const paidAlerts = ['check-mail', 'check-telegram', 'check-mail-recap', 'check-db-externe'];
                paidAlerts.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.disabled = !isLicenseActive;
                        if (!isLicenseActive) {
                            el.checked = false;
                            el.parentElement.title = t('requires_license');
                            el.parentElement.style.opacity = "0.6";
                        } else {
                            el.parentElement.title = "";
                            el.parentElement.style.opacity = "1";
                        }
                    }
                });

                if (isLicenseActive) {
                    icon.textContent = '‚úÖ';
                    status.textContent = t('license_active');
                    days.textContent = `${result.days_remaining} ${t('days_remaining')}`;
                    status.style.color = '#10b981';
                } else {
                    icon.textContent = '‚ùå';
                    status.textContent = t('no_license');
                    days.textContent = t('features_limited');
                    status.style.color = '#ef4444';
                }
            } catch (error) {
                console.error('License info load error:', error);
            }
        }

        // ==================== Authentification ====================
        document.getElementById('btn-logout').addEventListener('click', async function() {
            if (!confirm(t('confirm_logout'))) {
                return;
            }

            try {
                const result = await apiCall('/api/logout', 'POST');
                window.location.href = '/login';
            } catch (error) {}
        });

        document.getElementById('btn-change-password').addEventListener('click', function() {
            const modal = document.getElementById('modal-change-password');
            modal.style.display = 'flex';
        });

        document.getElementById('btn-cancel-change').addEventListener('click', function() {
            const modal = document.getElementById('modal-change-password');
            modal.style.display = 'none';
            document.getElementById('form-change-password').reset();
        });

        document.getElementById('form-change-password').addEventListener('submit', async function(e) {
            e.preventDefault();

            const data = {
                old_password: document.getElementById('old-password').value,
                new_username: document.getElementById('new-username').value,
                new_password: document.getElementById('new-password').value
            };

            try {
                const result = await apiCall('/api/change_credentials', 'POST', data);
                showNotification(t('credentials_changed'), 'success');
                setTimeout(() => {
                    window.location.href = '/login';
                }, 2000);
            } catch (error) {}
        });

        // ==================== User Info ====================
        async function loadUserInfo() {
            try {
                const result = await apiCall('/api/get_user_info');
                if (result.username) {
                    document.getElementById('system-user').textContent = result.username;
                }
            } catch (error) {
                console.error('User info load error:', error);
            }
        }

        // Initial load
        loadLanguage();
        loadSettings();
        loadLicenseInfo();
        loadUserInfo();
        loadMailRecapSettings();
    </script>
</body>
</html>
