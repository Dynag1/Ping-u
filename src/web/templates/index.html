<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring R√©seau - Ping √º</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #e4e4e4;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: rgba(45, 55, 72, 0.95);
            padding: 25px 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header h1 {
            color: #e4e4e4;
            font-size: 32px;
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .badges-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #10b981;
            color: white;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .status-badge.disconnected {
            background: #ef4444;
            animation: none;
        }

        .scan-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #6b7280;
            color: white;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
        }

        .scan-badge.running {
            background: #3b82f6;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        .status-badge.disconnected .status-dot {
            animation: none;
        }

        .scan-badge .status-dot {
            animation: none;
        }

        .scan-badge.running .status-dot {
            animation: blink 1.5s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        /* Language selector */
        .lang-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 20px;
        }

        .lang-selector label {
            color: #a0aec0;
            font-size: 12px;
            font-weight: 600;
        }

        .lang-selector select {
            background: transparent;
            border: none;
            color: #e4e4e4;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            padding: 2px 4px;
        }

        .lang-selector select:focus {
            outline: none;
        }

        /* User controls */
        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            color: #e4e4e4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-icon {
            font-size: 18px;
        }

        .user-name {
            color: #e4e4e4;
        }

        .admin-link {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .admin-link:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .logout-btn {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 6px 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: scale(1.1);
        }

        .controls-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 12px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card .label {
            color: #a0aec0;
            font-size: 14px;
        }

        .stat-card .value {
            color: #e4e4e4;
            font-size: 20px;
            font-weight: bold;
        }

        .stat-card.total .value {
            color: #3b82f6;
        }

        .stat-card.online .value {
            color: #10b981;
        }

        .stat-card.offline .value {
            color: #ef4444;
        }

        .stat-card.high-temp .value {
            color: #ef4444;
        }

        .stat-card.warning-temp .value {
            color: #f59e0b;
        }

        .hosts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .host-card {
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #10b981;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 5px solid #10b981;
        }

        .host-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .host-card.offline {
            border-left-color: #ef4444;
            opacity: 0.85;
        }

        .host-card.warning-temp {
            border-left-color: #f59e0b;
            background: rgba(60, 55, 45, 0.95);
        }

        .host-card.high-temp {
            border-left-color: #ef4444;
            background: rgba(60, 45, 45, 0.95);
        }

        .detail-value.temp-warning {
            color: #f59e0b;
            font-weight: bold;
        }

        .detail-value.temp-critical {
            color: #ef4444;
            font-weight: bold;
        }

        .host-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .host-name {
            font-size: 16px;
            font-weight: bold;
            color: #e4e4e4;
            word-break: break-word;
            flex: 1;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .host-name:hover {
            color: #667eea;
            text-decoration: underline;
        }

        .host-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .host-status.online {
            background: #d1fae5;
            color: #065f46;
        }

        .host-status.offline {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Couleurs de latence pour le badge "En ligne" */
        .host-status.latency-green {
            background: #baf595;
            color: #1a5d1a;
        }

        .host-status.latency-yellow {
            background: #fffd6a;
            color: #7a6800;
        }

        .host-status.latency-orange {
            background: #ffb845;
            color: #7a4000;
        }

        .host-ip {
            display: none;
        }

        .host-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            color: #a0aec0;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .detail-value {
            color: #e4e4e4;
            font-size: 12px;
            font-weight: 500;
            word-break: break-all;
        }

        .no-hosts {
            text-align: center;
            padding: 60px 20px;
            background: rgba(45, 55, 72, 0.95);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .no-hosts h2 {
            color: #a0aec0;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .no-hosts p {
            color: #718096;
            font-size: 16px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: '.';
            }

            40% {
                content: '..';
            }

            60%,
            100% {
                content: '...';
            }
        }

        .last-update {
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 20px;
            font-size: 14px;
        }

        /* ==================== Barre de filtre des sites ==================== */
        .sites-filter-bar {
            background: rgba(45, 55, 72, 0.95);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sites-filter-title {
            font-size: 13px;
            font-weight: 700;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sites-chips-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .site-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #e4e4e4;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .site-chip:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .site-chip.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .site-chip.all {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
        }

        .site-chip.all:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .site-chip-icon {
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .hosts-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 24px;
            }

            .header-top {
                flex-direction: column;
                gap: 15px;
            }

            .host-metrics {
                grid-template-columns: 1fr;
            }

            .sites-filter-bar {
                padding: 12px 15px;
            }

            .sites-chips-container {
                gap: 8px;
            }

            .site-chip {
                font-size: 13px;
                padding: 6px 12px;
            }
        }

        .icon {
            font-size: 20px;
        }

        .comment-item {
            grid-column: span 2;
            margin-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 8px;
        }

        .comment-input {
            width: 100%;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            padding: 8px;
            font-size: 13px;
            resize: vertical;
            min-height: 50px;
            font-family: inherit;
            transition: all 0.2s;
            background: rgba(0, 0, 0, 0.3);
            color: #e4e4e4;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        .comment-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2), inset 0 1px 2px rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.4);
        }

        .comment-input::placeholder {
            color: #718096;
        }

        /* ==================== Menu Hamburger & Panneau Lat√©ral ==================== */

        /* Overlay sombre */
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Menu lat√©ral */
        .side-menu {
            position: fixed;
            top: 0;
            left: -340px;
            width: 320px;
            height: 100%;
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(20px);
            box-shadow: 4px 0 30px rgba(0, 0, 0, 0.4);
            z-index: 999;
            transition: left 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .side-menu.active {
            left: 0;
        }

        .side-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .side-menu-header h2 {
            font-size: 22px;
            font-weight: 700;
            margin: 0;
        }

        .close-menu-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 18px;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-menu-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* Sections du menu */
        .menu-section {
            padding: 18px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .menu-section:last-child {
            border-bottom: none;
        }

        .menu-section-title {
            font-size: 13px;
            font-weight: 700;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* User info dans le menu */
        .menu-section .user-info-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .menu-user-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .menu-user-actions .admin-link {
            flex: 1;
            text-align: center;
            padding: 10px 15px;
            border-radius: 10px;
        }

        .logout-btn-menu {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 10px;
            color: #fca5a5;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn-menu:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.02);
        }

        /* S√©lecteurs dans le menu */
        .menu-select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 14px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.3);
            color: #e4e4e4;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .menu-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .menu-select option {
            background: #1e293b;
            color: #e4e4e4;
        }

        .menu-section .site-filter-select {
            min-height: 100px;
            margin-bottom: 10px;
        }

        .menu-section .site-filter-reset-btn {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
        }

        /* Badges dans le menu */
        .badges-container-menu {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .badges-container-menu .status-badge,
        .badges-container-menu .scan-badge {
            justify-content: flex-start;
            width: 100%;
        }

        /* Stats dans le menu */
        .stats-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-card-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }

        .stat-card-menu .label {
            color: #a0aec0;
            font-size: 13px;
            flex: 1;
        }

        .stat-card-menu .value {
            font-size: 18px;
            font-weight: bold;
        }

        .stat-card-menu.total .value {
            color: #3b82f6;
        }

        .stat-card-menu.online .value {
            color: #10b981;
        }

        .stat-card-menu.offline .value {
            color: #ef4444;
        }

        .stat-card-menu.warning-temp .value {
            color: #f59e0b;
        }

        .stat-card-menu.high-temp .value {
            color: #ef4444;
        }

        .mini-stat.warning span {
            color: #d97706;
        }

        .mini-stat.critical span {
            color: #dc2626;
        }

        .stat-card-menu.warning .value {
            color: #d97706;
        }

        .stat-card-menu.critical .value {
            color: #dc2626;
        }

        /* Lang selector dans le menu */
        .menu-section .lang-selector {
            padding: 0;
            background: none;
        }

        .menu-section .lang-selector select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 14px;
            background: rgba(0, 0, 0, 0.3);
            color: #e4e4e4;
        }

        /* Header minimaliste */
        .header-minimal {
            background: rgba(45, 55, 72, 0.95);
            padding: 15px 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-title {
            color: #e4e4e4;
            font-size: 26px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            margin: 0;
        }

        /* Bouton hamburger */
        .hamburger-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            flex-shrink: 0;
        }

        .hamburger-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .hamburger-line {
            width: 24px;
            height: 3px;
            background: white;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 6px);
        }

        .hamburger-btn.active .hamburger-line:nth-child(2) {
            opacity: 0;
            transform: scaleX(0);
        }

        .hamburger-btn.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(6px, -7px);
        }

        /* Mini stats */
        .mini-stats {
            display: flex;
            gap: 15px;
        }

        .mini-stat {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            color: #e4e4e4;
        }

        .mini-stat.online span {
            color: #10b981;
        }

        .mini-stat.offline span {
            color: #ef4444;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-minimal {
                padding: 12px 15px;
                gap: 12px;
            }

            .main-title {
                font-size: 18px;
            }

            .hamburger-btn {
                width: 42px;
                height: 42px;
            }

            .mini-stats {
                gap: 8px;
            }

            .mini-stat {
                padding: 6px 10px;
                font-size: 12px;
            }

            .side-menu {
                width: 280px;
                left: -300px;
            }
        }
    </style>
</head>

<body>
    <!-- Overlay sombre pour fermer le menu -->
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>

    <!-- Menu lat√©ral (slide-in) -->
    <div class="side-menu" id="side-menu">
        <div class="side-menu-header">
            <h2 data-i18n="menu">Menu</h2>
            <button class="close-menu-btn" onclick="toggleMenu()">‚úï</button>
        </div>

        <!-- Section utilisateur -->
        <div class="menu-section">
            <div class="menu-section-title">üë§ <span data-i18n="user">Utilisateur</span></div>
            <div class="user-info-badge" id="user-info-badge">
                <span class="user-icon">üë§</span>
                <span class="user-name" id="current-username">{{ username or '' }}</span>
            </div>
            <div class="menu-user-actions">
                {% if is_admin %}
                <a href="/admin" class="admin-link" title="Administration">
                    ‚öôÔ∏è <span data-i18n="admin">Admin</span>
                </a>
                {% endif %}
                <button class="logout-btn-menu" onclick="logout()">
                    üö™ <span data-i18n="logout">D√©connexion</span>
                </button>
            </div>
        </div>

        <!-- Section langue -->
        <div class="menu-section">
            <div class="menu-section-title">üåç <span data-i18n="language">Langue</span></div>
            <div class="lang-selector">
                <select id="lang-select" onchange="changeLanguage(this.value)">
                    <option value="fr">Fran√ßais</option>
                    <option value="en">English</option>
                </select>
            </div>
        </div>

        <!-- Section statut -->
        <div class="menu-section">
            <div class="menu-section-title">üìä <span data-i18n="status">Statut</span></div>
            <div class="badges-container-menu">
                <span class="status-badge" id="connection-badge">
                    <span class="status-dot"></span>
                    <span data-i18n="connected">Connect√©</span>
                </span>
                <span class="scan-badge" id="scan-badge">
                    <span class="status-dot"></span>
                    <span data-i18n="scan_stopped">Scan arr√™t√©</span>
                </span>
            </div>
        </div>

        <!-- Section tri -->
        <div class="menu-section">
            <div class="menu-section-title">üìã <span data-i18n="sort_by">Trier par</span></div>
            <select id="sort-select" onchange="changeSort()" class="menu-select">
                <option value="status-offline-first" data-i18n="sort_offline_first">Statut (HS en premier)</option>
                <option value="status-online-first" data-i18n="sort_online_first">Statut (En ligne en premier)</option>
                <option value="ip-asc" data-i18n="sort_ip_asc">Adresse IP (Croissant)</option>
                <option value="ip-desc" data-i18n="sort_ip_desc">Adresse IP (D√©croissant)</option>
                <option value="name-asc" data-i18n="sort_name_asc">Nom (A-Z)</option>
                <option value="name-desc" data-i18n="sort_name_desc">Nom (Z-A)</option>
            </select>
        </div>

        <!-- Section filtre par site -->
        <div class="menu-section">
            <div class="menu-section-title">üè¢ <span data-i18n="filter_site">Filtrer par site</span></div>
            <select id="site-filter-select" multiple onchange="applySiteFilterLocal()"
                class="menu-select site-filter-select">
            </select>
            <button onclick="clearSiteFilterLocal()" class="site-filter-reset-btn">
                <span data-i18n="all_sites">Tous</span>
            </button>
        </div>

        <!-- Section statistiques -->
        <div class="menu-section">
            <div class="menu-section-title">üìà <span data-i18n="statistics">Statistiques</span></div>
            <div class="stats-menu">
                <div class="stat-card-menu total">
                    <span class="label" data-i18n="total">Total:</span>
                    <span class="value" id="total-hosts">0</span>
                </div>
                <div class="stat-card-menu online">
                    <span class="icon">üü¢</span>
                    <span class="label" data-i18n="online">En ligne:</span>
                    <span class="value" id="online-hosts">0</span>
                </div>
                <div class="stat-card-menu offline">
                    <span class="icon">üî¥</span>
                    <span class="label" data-i18n="offline">Hors ligne:</span>
                    <span class="value" id="offline-hosts">0</span>
                </div>
                <div class="stat-card-menu warning-temp">
                    <span class="icon">üå°Ô∏è</span>
                    <span class="label" data-i18n="warning_temp"></span>
                    <span class="value" id="warning-temp-hosts">0</span>
                </div>
                <div class="stat-card-menu high-temp">
                    <span class="icon">üî•</span>
                    <span class="label" data-i18n="high_temp"></span>
                    <span class="value" id="high-temp-hosts">0</span>
                </div>
            </div>
            <div class="menu-user-actions" style="margin-top: 15px;">
                <a href="/statistics" class="admin-link"
                    style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                    üìä <span data-i18n="statistics">Statistiques</span>
                </a>
                <a href="/monitoring" class="admin-link"
                    style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white;">
                    üìà <span data-i18n="monitoring">Monitoring</span>
                </a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header minimaliste avec bouton hamburger -->
        <div class="header-minimal">
            <button class="hamburger-btn" id="hamburger-btn" onclick="toggleMenu()" title="Menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <h1 class="main-title">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Ping √º"
                    style="height: 40px; width: auto; vertical-align: middle;">
                <span data-i18n="title">Monitoring R√©seau - Ping √º</span>
            </h1>
            <!-- Mini stats visibles sur la page principale -->
            <div class="mini-stats">
                <span class="scan-badge" id="header-scan-badge">
                    <span class="status-dot"></span>
                    <span data-i18n="scan_stopped">Scan arr√™t√©</span>
                </span>
                <span class="mini-stat online"><span id="mini-online">0</span> üü¢</span>
                <span class="mini-stat offline"><span id="mini-offline">0</span> üî¥</span>
                <span class="mini-stat warning">üå°Ô∏è <span data-i18n="temp_warning"></span> <span
                        id="mini-temp-warning">0</span></span>
                <span class="mini-stat critical">üî• <span data-i18n="temp_critical"></span> <span
                        id="mini-temp-critical">0</span></span>
            </div>
        </div>

        <!-- Barre de filtre rapide des sites -->
        <div class="sites-filter-bar" id="sites-filter-bar" style="display: none;">
            <div class="sites-filter-title">üè¢ Filtrer par site</div>
            <div class="sites-chips-container" id="sites-chips-container">
                <!-- Les chips seront ajout√©es dynamiquement par JavaScript -->
            </div>
        </div>

        <div id="hosts-container">
            <div class="loading" data-i18n="loading">Chargement des h√¥tes</div>
        </div>

        <div class="last-update">
            <span data-i18n="last_update">Derni√®re mise √† jour:</span> <span id="last-update-time">-</span>
        </div>
    </div>

    <script>
        // ==================== Menu Hamburger ====================
        function toggleMenu() {
            const sideMenu = document.getElementById('side-menu');
            const overlay = document.getElementById('menu-overlay');
            const hamburgerBtn = document.getElementById('hamburger-btn');

            sideMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            hamburgerBtn.classList.toggle('active');
        }

        // Fermer le menu avec la touche Escape
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                const sideMenu = document.getElementById('side-menu');
                if (sideMenu && sideMenu.classList.contains('active')) {
                    toggleMenu();
                }
            }
        });

        // ==================== Syst√®me de traduction ====================
        const translations = {
            fr: {
                title: "Monitoring R√©seau - Ping √º",
                menu: "Menu",
                user: "Utilisateur",
                language: "Langue",
                status: "Statut",
                statistics: "Statistiques",
                connected: "Connect√©",
                disconnected: "D√©connect√©",
                scan_running: "Scan en cours",
                scan_stopped: "Scan arr√™t√©",
                sort_by: "Trier par :",
                sort_offline_first: "Statut (HS en premier)",
                sort_online_first: "Statut (En ligne en premier)",
                sort_ip_asc: "Adresse IP (Croissant)",
                sort_ip_desc: "Adresse IP (D√©croissant)",
                sort_name_asc: "Nom (A-Z)",
                sort_name_desc: "Nom (Z-A)",
                total: "Total:",
                online: "En ligne:",
                offline: "Hors ligne:",
                high_temp: "Temp. Critique",
                warning_temp: "Temp. Warning",
                loading: "Chargement des h√¥tes",
                last_update: "Derni√®re mise √† jour:",
                no_hosts_title: "Aucun h√¥te trouv√©",
                no_hosts_message: "Ajoutez des h√¥tes dans l'application pour les voir appara√Ætre ici.",
                no_hosts_for_site: "Aucun h√¥te pour ce(s) site(s)",
                filter_site: "Site",
                all_sites: "Tous",
                connection_error_title: "Erreur de connexion",
                connection_error_message: "Impossible de se connecter au serveur. V√©rifiez que le serveur web est d√©marr√©.",
                admin: "Admin",
                logout: "D√©connexion",
                status_online: "En ligne",
                status_offline: "Hors ligne",
                no_name: "Sans nom",
                mac: "MAC",
                temperature: "Temp√©rature",
                bandwidth_in: "D√©bit IN",
                bandwidth_out: "D√©bit OUT",
                comment: "Commentaire",
                monitoring: "Monitoring"
            },
            en: {
                title: "Network Monitoring - Ping √º",
                menu: "Menu",
                user: "User",
                language: "Language",
                status: "Status",
                statistics: "Statistics",
                connected: "Connected",
                disconnected: "Disconnected",
                scan_running: "Scan running",
                scan_stopped: "Scan stopped",
                sort_by: "Sort by:",
                sort_offline_first: "Status (Offline first)",
                sort_online_first: "Status (Online first)",
                sort_ip_asc: "IP Address (Ascending)",
                sort_ip_desc: "IP Address (Descending)",
                sort_name_asc: "Name (A-Z)",
                sort_name_desc: "Name (Z-A)",
                total: "Total:",
                online: "Online:",
                offline: "Offline:",
                high_temp: "Critical Temp",
                warning_temp: "Warning Temp",
                loading: "Loading hosts",
                last_update: "Last update:",
                no_hosts_title: "No hosts found",
                no_hosts_message: "Add hosts in the application to see them appear here.",
                no_hosts_for_site: "No hosts for this site(s)",
                filter_site: "Site",
                all_sites: "All",
                connection_error_title: "Connection error",
                connection_error_message: "Unable to connect to the server. Check that the web server is running.",
                admin: "Admin",
                logout: "Logout",
                status_online: "Online",
                status_offline: "Offline",
                no_name: "No name",
                mac: "MAC",
                temperature: "Temperature",
                bandwidth_in: "Bandwidth IN",
                bandwidth_out: "Bandwidth OUT",
                comment: "Comment",
                monitoring: "Monitoring"
            }
        };

        let currentLang = 'fr';

        // D√©tecter la langue du navigateur
        function detectBrowserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            // Si la langue commence par 'fr', utiliser fran√ßais, sinon anglais
            return browserLang.startsWith('fr') ? 'fr' : 'en';
        }

        // Charger la langue sauvegard√©e ou d√©tecter automatiquement
        function loadLanguage() {
            const savedLang = localStorage.getItem('ping√º_lang');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
            } else {
                currentLang = detectBrowserLanguage();
            }
            document.getElementById('lang-select').value = currentLang;
            applyTranslations();
        }

        // Changer la langue
        function changeLanguage(lang) {
            if (translations[lang]) {
                currentLang = lang;
                localStorage.setItem('ping√º_lang', lang);
                applyTranslations();
                // Re-render les h√¥tes pour mettre √† jour les textes
                if (hostsData.length > 0) {
                    renderHosts(hostsData);
                }
            }
        }

        // Appliquer les traductions
        function applyTranslations() {
            const t = translations[currentLang];

            // Mettre √† jour les √©l√©ments avec data-i18n
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });

            // Mettre √† jour les options du select
            const sortSelect = document.getElementById('sort-select');
            Array.from(sortSelect.options).forEach(option => {
                const key = option.getAttribute('data-i18n');
                if (key && t[key]) {
                    option.textContent = t[key];
                }
            });

            // Mettre √† jour le titre de la page
            document.title = t.title;

            // Mettre √† jour l'attribut lang du HTML
            document.documentElement.lang = currentLang;
        }

        // Fonction d'aide pour obtenir une traduction
        function t(key) {
            return translations[currentLang][key] || key;
        }

        // ==================== Socket.IO ====================
        const socket = io({
            transports: ['websocket', 'polling'],
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionAttempts: 10
        });

        let hostsData = [];
        let currentSort = 'status-offline-first';
        let tempSeuil = 70; // Seuil critique
        let tempSeuilWarning = 60; // Seuil de warning
        let scanRunning = false;
        let sitesList = [];
        let selectedSitesFilter = []; // Filtre local pour la page monitoring

        // ChargerFunction la liste des sites
        async function loadSitesList() {
            try {
                const response = await fetch('/api/get_sites');
                const data = await response.json();

                if (data.success) {
                    sitesList = data.sites || [];
                    updateSiteFilterSelect();
                    updateSiteChipsBar(); // Mettre √† jour la barre horizontale
                }
            } catch (error) {
                console.error('Erreur chargement sites:', error);
            }
        }

        function updateSiteFilterSelect() {
            const select = document.getElementById('site-filter-select');
            if (!select) return;

            select.innerHTML = sitesList.map(site =>
                `<option value="${escapeHtml(site)}" ${selectedSitesFilter.includes(site) ? 'selected' : ''}>${escapeHtml(site)}</option>`
            ).join('');
        }

        // Mettre √† jour la barre horizontale de chips de sites
        function updateSiteChipsBar() {
            const container = document.getElementById('sites-chips-container');
            const bar = document.getElementById('sites-filter-bar');

            if (!container || !bar) return;

            // Afficher la barre seulement s'il y a des sites
            if (sitesList.length === 0) {
                bar.style.display = 'none';
                return;
            }

            bar.style.display = 'block';

            // Cr√©er le chip "Tous"
            let html = `
                <div class="site-chip all ${selectedSitesFilter.length === 0 ? 'active' : ''}" onclick="selectAllSites()">
                    <span class="site-chip-icon">üåê</span>
                    <span>Tous les sites</span>
                </div>
            `;

            // Cr√©er un chip pour chaque site
            sitesList.forEach(site => {
                const isActive = selectedSitesFilter.includes(site);
                html += `
                    <div class="site-chip ${isActive ? 'active' : ''}" onclick="toggleSiteFilter('${escapeHtml(site).replace(/'/g, "\\'")}')">
                        <span class="site-chip-icon">üè¢</span>
                        <span>${escapeHtml(site)}</span>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // S√©lectionner tous les sites (r√©initialiser le filtre)
        function selectAllSites() {
            selectedSitesFilter = [];
            updateSiteChipsBar();

            // Synchroniser avec le select du menu
            const select = document.getElementById('site-filter-select');
            if (select) {
                Array.from(select.options).forEach(opt => opt.selected = false);
            }

            renderHosts(hostsData);
        }

        // Basculer le filtre d'un site sp√©cifique
        function toggleSiteFilter(site) {
            const index = selectedSitesFilter.indexOf(site);

            if (index > -1) {
                // D√©j√† s√©lectionn√©, on le retire
                selectedSitesFilter.splice(index, 1);
            } else {
                // Pas s√©lectionn√©, on l'ajoute
                selectedSitesFilter.push(site);
            }

            updateSiteChipsBar();

            // Synchroniser avec le select du menu
            const select = document.getElementById('site-filter-select');
            if (select) {
                Array.from(select.options).forEach(opt => {
                    opt.selected = selectedSitesFilter.includes(opt.value);
                });
            }

            renderHosts(hostsData);
        }

        function applySiteFilterLocal() {
            const select = document.getElementById('site-filter-select');
            selectedSitesFilter = Array.from(select.selectedOptions).map(opt => opt.value);
            updateSiteChipsBar(); // Mettre √† jour les chips
            renderHosts(hostsData);
        }

        function clearSiteFilterLocal() {
            selectedSitesFilter = [];
            const select = document.getElementById('site-filter-select');
            if (select) {
                Array.from(select.options).forEach(opt => opt.selected = false);
            }
            updateSiteChipsBar(); // Mettre √† jour les chips
            renderHosts(hostsData);
        }

        function filterHostsBySite(hosts) {
            if (selectedSitesFilter.length === 0) {
                return hosts; // Pas de filtre = tous les h√¥tes
            }
            return hosts.filter(host => selectedSitesFilter.includes(host.site || ''));
        }

        // Charger le seuil de temp√©rature depuis les settings
        async function loadTempSeuil() {
            try {
                const response = await fetch('/api/get_settings');
                const result = await response.json();
                if (result.alerts) {
                    if (result.alerts.temp_seuil) {
                        tempSeuil = result.alerts.temp_seuil;
                    }
                    if (result.alerts.temp_seuil_warning) {
                        tempSeuilWarning = result.alerts.temp_seuil_warning;
                    }
                }
                // Mettre √† jour le statut du scan
                if (typeof result.monitoring_running !== 'undefined') {
                    updateScanBadge(result.monitoring_running);
                }
            } catch (e) {
                console.log('Utilisation du seuil par d√©faut:', tempSeuil);
            }
        }
        loadTempSeuil();

        // Fonction pour v√©rifier si la temp√©rature est √©lev√©e
        function getTempAlertLevel(tempValue) {
            if (!tempValue || tempValue === '-') return 'none';
            const temp = parseFloat(tempValue.replace('¬∞C', '').replace('¬∞', '').trim());
            if (isNaN(temp)) return 'none';
            if (temp >= tempSeuil) return 'critical';
            if (temp >= tempSeuilWarning) return 'warning';
            return 'none';
        }

        // Fonction pour obtenir la classe CSS selon la couleur de latence
        function getLatencyClass(latencyColor) {
            if (!latencyColor) return '';
            switch (latencyColor.toLowerCase()) {
                case '#baf595': return 'latency-green';   // Vert clair < 100ms
                case '#fffd6a': return 'latency-yellow';  // Jaune 100-200ms
                case '#ffb845': return 'latency-orange';  // Orange > 200ms
                case '#f97e7e': return '';                // Rouge = offline (classe d√©j√† g√©r√©e)
                default: return '';
            }
        }

        async function loadSettings() {
            try {
                const response = await fetch('/api/get_settings');
                const result = await response.json();

                if (result.alerts) {
                    // Les seuils ne sont plus affich√©s dans le header, on affiche les compteurs via updateStats
                }
            } catch (error) {
                console.error('Erreur chargement settings:', error);
            }
        }

        socket.on('connect', function () {
            updateStatusBadge(true);
            socket.emit('request_update');
            loadSitesList(); // Charger la liste des sites
            loadSettings(); // Charger les seuils de temp√©rature
        });

        socket.on('disconnect', function () {
            updateStatusBadge(false);
        });

        socket.on('hosts_update', function (hosts) {
            if (!Array.isArray(hosts)) {
                hosts = [];
            }

            hostsData = hosts;
            renderHosts(hosts);
            updateStats(hosts);
            updateLastUpdateTime();
        });

        socket.on('monitoring_status', function (data) {
            updateScanBadge(data.running);
        });

        function changeSort() {
            currentSort = document.getElementById('sort-select').value;
            renderHosts(hostsData);
        }

        function naturalSort(a, b) {
            // Fonction pour le tri naturel (g√®re les nombres dans les cha√Ænes)
            const ax = [], bx = [];

            String(a).replace(/(\d+)|(\D+)/g, function (_, $1, $2) { ax.push([$1 || Infinity, $2 || ""]) });
            String(b).replace(/(\d+)|(\D+)/g, function (_, $1, $2) { bx.push([$1 || Infinity, $2 || ""]) });

            while (ax.length && bx.length) {
                const an = ax.shift();
                const bn = bx.shift();
                const nn = (an[0] - bn[0]) || an[1].localeCompare(bn[1]);
                if (nn) return nn;
            }

            return ax.length - bx.length;
        }

        function getHostStatusScore(host) {
            // 0: Offline (Priorit√© max)
            // 1: Online + Critical Temp
            // 2: Online + Warning Temp (Optionnel, mais logique)
            // 3: Online Normal

            if (host.status === 'offline') return 0;
            if (host.status === 'online') {
                const tempLevel = getTempAlertLevel(host.temp);
                if (tempLevel === 'critical') return 1;
                // Decommenter si on veut aussi trier warning avant normal
                // if (tempLevel === 'warning') return 2; 
            }
            return 3;
        }

        function sortHostsData(hosts) {
            return [...hosts].sort((a, b) => {
                switch (currentSort) {
                    case 'status-offline-first':
                        // Ordre : Offline > Critical Temp > Online
                        const statusScoreA = getHostStatusScore(a);
                        const statusScoreB = getHostStatusScore(b);

                        if (statusScoreA !== statusScoreB) {
                            return statusScoreA - statusScoreB;
                        }

                        // Si m√™me statut/score, trier par IP
                        return compareIPs(a.ip, b.ip);

                    case 'status-online-first':
                        if (a.status === 'online' && b.status === 'offline') return -1;
                        if (a.status === 'offline' && b.status === 'online') return 1;
                        // Si m√™me statut, trier par IP
                        return compareIPs(a.ip, b.ip);

                    case 'ip-asc':
                        return compareIPs(a.ip, b.ip);

                    case 'ip-desc':
                        return compareIPs(b.ip, a.ip);

                    case 'name-asc':
                        return naturalSort(a.nom || a.ip, b.nom || b.ip);

                    case 'name-desc':
                        return naturalSort(b.nom || b.ip, a.nom || a.ip);

                    default:
                        return 0;
                }
            });
        }

        function compareIPs(ipA, ipB) {
            const partsA = ipA.split('.').map(Number);
            const partsB = ipB.split('.').map(Number);

            for (let i = 0; i < 4; i++) {
                if (partsA[i] !== partsB[i]) {
                    return partsA[i] - partsB[i];
                }
            }
            return 0;
        }

        socket.on('connect_error', function (error) {
            updateStatusBadge(false);
            document.getElementById('hosts-container').innerHTML = `
                <div class="no-hosts">
                    <h2>${t('connection_error_title')}</h2>
                    <p>${t('connection_error_message')}</p>
                </div>
            `;
        });

        function updateStatusBadge(connected) {
            const badge = document.getElementById('connection-badge');
            const badgeText = badge.querySelector('span[data-i18n]');

            if (connected) {
                badge.classList.remove('disconnected');
                badge.style.background = '#10b981';
                badgeText.textContent = t('connected');
                badgeText.setAttribute('data-i18n', 'connected');
            } else {
                badge.classList.add('disconnected');
                badge.style.background = '#ef4444';
                badgeText.textContent = t('disconnected');
                badgeText.setAttribute('data-i18n', 'disconnected');
            }
        }

        function updateScanBadge(running) {
            scanRunning = running;
            const badge = document.getElementById('scan-badge');
            const badgeText = badge.querySelector('span[data-i18n]');

            if (running) {
                badge.classList.add('running');
                badgeText.textContent = t('scan_running');
                badgeText.setAttribute('data-i18n', 'scan_running');

                // Update header badge
                const headerBadge = document.getElementById('header-scan-badge');
                if (headerBadge) {
                    headerBadge.classList.add('running');
                    const headerText = headerBadge.querySelector('span[data-i18n]');
                    if (headerText) {
                        headerText.textContent = t('scan_running');
                        headerText.setAttribute('data-i18n', 'scan_running');
                    }
                }
            } else {
                badge.classList.remove('running');
                badgeText.textContent = t('scan_stopped');
                badgeText.setAttribute('data-i18n', 'scan_stopped');

                // Update header badge
                const headerBadge = document.getElementById('header-scan-badge');
                if (headerBadge) {
                    headerBadge.classList.remove('running');
                    const headerText = headerBadge.querySelector('span[data-i18n]');
                    if (headerText) {
                        headerText.textContent = t('scan_stopped');
                        headerText.setAttribute('data-i18n', 'scan_stopped');
                    }
                }
            }
        }

        function renderHosts(hosts) {
            const container = document.getElementById('hosts-container');

            // Appliquer le filtre par site
            const filteredHosts = filterHostsBySite(hosts);

            // Mettre √† jour les stats avec les h√¥tes filtr√©s
            updateStats(filteredHosts);

            if (!filteredHosts || filteredHosts.length === 0) {
                container.innerHTML = `
                    <div class="no-hosts">
                        <h2>${t('no_hosts_title')}</h2>
                        <p>${selectedSitesFilter.length > 0 ? (t('no_hosts_for_site') || 'Aucun h√¥te pour ce(s) site(s)') : t('no_hosts_message')}</p>
                    </div>
                `;
                return;
            }

            // Trier les h√¥tes selon le choix actuel
            const sortedHosts = sortHostsData(filteredHosts);

            // R√©cup√©rer ou cr√©er le conteneur grid
            let grid = container.querySelector('.hosts-grid');
            if (!grid) {
                grid = document.createElement('div');
                grid.className = 'hosts-grid';
                container.innerHTML = '';
                container.appendChild(grid);
            }

            // Mettre √† jour ou cr√©er chaque carte
            sortedHosts.forEach((host, index) => {
                const cardId = `host-card-${host.ip.replace(/\./g, '-')}`;
                let card = document.getElementById(cardId);

                if (!card) {
                    // Cr√©er une nouvelle carte
                    card = createHostCardElement(host, cardId);
                    grid.appendChild(card);
                } else {
                    // Mettre √† jour la carte existante sans recr√©er
                    updateHostCard(card, host);
                }

                // R√©ordonner visuellement en changeant l'ordre dans le DOM si n√©cessaire
                if (grid.children[index] !== card) {
                    grid.insertBefore(card, grid.children[index]);
                }
            });

            // Supprimer les cartes des h√¥tes qui n'existent plus
            const currentCards = grid.querySelectorAll('[id^="host-card-"]');
            const currentIPs = sortedHosts.map(h => h.ip.replace(/\./g, '-'));
            currentCards.forEach(card => {
                const cardIP = card.id.replace('host-card-', '');
                if (!currentIPs.includes(cardIP)) {
                    card.remove();
                }
            });
        }

        function createHostCardElement(host, cardId) {
            const card = document.createElement('div');
            card.id = cardId;

            const temperature = host.temp || '-';
            const tempLevel = getTempAlertLevel(temperature);

            // Classe de la carte: offline prioritaire, puis high-temp/warning-temp, puis online
            let cardClass = `host-card ${host.status}`;
            if (host.status === 'online') {
                if (tempLevel === 'critical') {
                    cardClass += ' high-temp';
                } else if (tempLevel === 'warning') {
                    cardClass += ' warning-temp';
                }
            }
            card.className = cardClass;

            // Appliquer la couleur de latence √† la bordure gauche (si disponible)
            if (host.latency_color && host.status === 'online') {
                card.style.borderLeftColor = host.latency_color;
            }

            const displayName = host.nom || t('no_name');
            const statusText = host.status === 'online' ? t('status_online') : t('status_offline');
            const debitIn = host.debit_in || 'N/A';
            const debitOut = host.debit_out || 'N/A';

            // Helper pour d√©tecter les valeurs vides
            const hasValue = (val) => val && val !== 'N/A' && val !== '-' && val.trim() !== '';

            let tempClass = 'detail-value';
            let tempDisplay = temperature;
            if (tempLevel === 'critical') {
                tempClass = 'detail-value temp-critical';
                tempDisplay += ' ‚ö†Ô∏è';
            } else if (tempLevel === 'warning') {
                tempClass = 'detail-value temp-warning';
            }

            // Classe de latence pour le badge (uniquement si online)
            const latencyClass = host.status === 'online' ? getLatencyClass(host.latency_color) : '';
            const statusClass = latencyClass ? latencyClass : host.status;

            card.innerHTML = `
                <div class="host-header">
                    <div class="host-name" onclick="goToHostStats('${escapeHtml(host.ip)}')" title="Voir les statistiques">${escapeHtml(displayName)}</div>
                    <div class="host-status ${statusClass}">${statusText}</div>
                </div>
                <div class="host-ip">${escapeHtml(host.ip)}</div>
                <div class="host-details">
                    <div class="detail-item">
                        <div class="detail-label">${t('mac')}</div>
                        <div class="detail-value">${escapeHtml(host.mac) || '-'}</div>
                    </div>
                    <div class="detail-item" style="display: ${(temperature !== '-' && temperature) ? 'flex' : 'none'}">
                        <div class="detail-label">üå°Ô∏è ${t('temperature')}</div>
                        <div class="${tempClass}">${escapeHtml(tempDisplay)}</div>
                    </div>
                    <div class="detail-item" style="display: ${hasValue(debitIn) ? 'flex' : 'none'}">
                        <div class="detail-label">üì• ${t('bandwidth_in')}</div>
                        <div class="detail-value">${escapeHtml(debitIn)}</div>
                    </div>
                    <div class="detail-item" style="display: ${hasValue(debitOut) ? 'flex' : 'none'}">
                        <div class="detail-label">üì§ ${t('bandwidth_out')}</div>
                        <div class="detail-value">${escapeHtml(debitOut)}</div>
                    </div>
                    <div class="detail-item comment-item">
                        <div class="detail-label">üí¨ ${t('comment')}</div>
                        <textarea class="comment-input" onblur="updateComment('${host.ip}', this.value)" placeholder="${t('comment')}...">${escapeHtml(host.commentaire || '')}</textarea>
                    </div>
                </div>
            `;

            return card;
        }

        function updateHostCard(card, host) {
            const displayName = host.nom || t('no_name');
            const statusText = host.status === 'online' ? t('status_online') : t('status_offline');
            const temperature = host.temp || '-';
            const tempLevel = getTempAlertLevel(temperature);
            const debitIn = host.debit_in || 'N/A';
            const debitOut = host.debit_out || 'N/A';

            // Mettre √† jour la classe de statut (avec high-temp si applicable)
            let cardClass = `host-card ${host.status}`;
            if (host.status === 'online') {
                if (tempLevel === 'critical') {
                    cardClass += ' high-temp';
                } else if (tempLevel === 'warning') {
                    cardClass += ' warning-temp';
                }
            }
            card.className = cardClass;

            // Mettre √† jour la couleur de latence (bordure gauche)
            if (host.latency_color && host.status === 'online') {
                card.style.borderLeftColor = host.latency_color;
            } else if (host.status === 'offline') {
                card.style.borderLeftColor = '#ef4444'; // Rouge pour offline
            }

            // Mettre √† jour le nom
            const nameEl = card.querySelector('.host-name');
            if (nameEl && nameEl.textContent !== displayName) {
                nameEl.textContent = displayName;
            }

            // Mettre √† jour le statut avec la couleur de latence
            const statusEl = card.querySelector('.host-status');
            if (statusEl) {
                const latencyClass = host.status === 'online' ? getLatencyClass(host.latency_color) : '';
                const statusClass = latencyClass ? latencyClass : host.status;
                statusEl.className = `host-status ${statusClass}`;
                if (statusEl.textContent !== statusText) {
                    statusEl.textContent = statusText;
                }
            }

            // Mettre √† jour les valeurs d√©taill√©es
            const detailItems = card.querySelectorAll('.detail-item');

            // MAC (toujours affich√©)
            if (detailItems[0]) {
                const macValue = detailItems[0].querySelector('.detail-value');
                if (macValue && macValue.textContent !== (host.mac || '-')) {
                    macValue.textContent = host.mac || '-';
                }
            }

            // Temp√©rature - masquer si vide
            if (detailItems[1]) {
                const shouldShow = temperature !== '-' && temperature;
                detailItems[1].style.display = shouldShow ? 'flex' : 'none';

                if (shouldShow) {
                    let tempDisplay = temperature;
                    let tempClass = 'detail-value';

                    if (tempLevel === 'critical') {
                        tempDisplay += ' ‚ö†Ô∏è';
                        tempClass = 'detail-value temp-critical';
                    } else if (tempLevel === 'warning') {
                        tempClass = 'detail-value temp-warning';
                    }

                    const tempValue = detailItems[1].querySelector('.detail-value, .temp-critical, .temp-warning');
                    if (tempValue) {
                        tempValue.className = tempClass;
                        if (tempValue.textContent !== tempDisplay) {
                            tempValue.textContent = tempDisplay;
                        }
                    }
                }
            }

            // D√©bit IN - masquer si vide/N/A
            if (detailItems[2]) {
                const shouldShow = debitIn && debitIn !== 'N/A' && debitIn !== '-' && debitIn.trim() !== '';
                detailItems[2].style.display = shouldShow ? 'flex' : 'none';

                if (shouldShow) {
                    const debitInValue = detailItems[2].querySelector('.detail-value');
                    if (debitInValue && debitInValue.textContent !== debitIn) {
                        debitInValue.textContent = debitIn;
                    }
                }
            }

            // D√©bit OUT - masquer si vide/N/A
            if (detailItems[3]) {
                const shouldShow = debitOut && debitOut !== 'N/A' && debitOut !== '-' && debitOut.trim() !== '';
                detailItems[3].style.display = shouldShow ? 'flex' : 'none';

                if (shouldShow) {
                    const debitOutValue = detailItems[3].querySelector('.detail-value');
                    if (debitOutValue && debitOutValue.textContent !== debitOut) {
                        debitOutValue.textContent = debitOut;
                    }
                }
            }

            // Commentaire (toujours affich√©) - seulement si pas focalis√©
            const commentInput = card.querySelector('.comment-input');
            if (commentInput && document.activeElement !== commentInput) {
                if (commentInput.value !== (host.commentaire || '')) {
                    commentInput.value = host.commentaire || '';
                }
            }
        }

        function updateStats(hosts) {
            const total = hosts.length;
            const online = hosts.filter(h => h.status === 'online').length;
            const offline = total - online;
            const highTempCount = hosts.filter(h => h.status === 'online' && getTempAlertLevel(h.temp) === 'critical').length;
            const warningTempCount = hosts.filter(h => h.status === 'online' && getTempAlertLevel(h.temp) === 'warning').length;

            // Stats dans le menu lat√©ral
            document.getElementById('total-hosts').textContent = total;
            document.getElementById('online-hosts').textContent = online;
            document.getElementById('offline-hosts').textContent = offline;
            document.getElementById('high-temp-hosts').textContent = highTempCount;
            const warningEl = document.getElementById('warning-temp-hosts');
            if (warningEl) warningEl.textContent = warningTempCount;

            // Mini stats dans le header
            const miniOnline = document.getElementById('mini-online');
            const miniOffline = document.getElementById('mini-offline');
            const miniWarning = document.getElementById('mini-temp-warning');
            const miniCritical = document.getElementById('mini-temp-critical');

            if (miniOnline) miniOnline.textContent = online;
            if (miniOffline) miniOffline.textContent = offline;
            if (miniWarning) miniWarning.textContent = warningTempCount;
            if (miniCritical) miniCritical.textContent = highTempCount;
        }

        function updateLastUpdateTime() {
            const now = new Date();
            const locale = currentLang === 'fr' ? 'fr-FR' : 'en-US';
            const timeString = now.toLocaleTimeString(locale);
            document.getElementById('last-update-time').textContent = timeString;
        }

        function goToHostStats(ip) {
            // Naviguer vers la page statistics avec l'IP en param√®tre
            window.location.href = `/statistics?ip=${encodeURIComponent(ip)}`;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function updateComment(ip, comment) {
            try {
                const response = await fetch('/api/update_comment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ ip, comment }),
                });
                const data = await response.json();
                if (!data.success) {
                    console.error('Erreur lors de la mise √† jour du commentaire:', data.error);
                }
            } catch (error) {
                console.error('Erreur r√©seau updateComment:', error);
            }
        }

        async function logout() {
            try {
                const response = await fetch('/api/logout', { method: 'POST' });
                if (response.ok) {
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('Erreur d√©connexion:', error);
                window.location.href = '/login';
            }
        }

        // Demander une mise √† jour toutes les 10 secondes
        setInterval(() => {
            socket.emit('request_update');
        }, 10000);

        // Charger la langue et demander les donn√©es au chargement
        loadLanguage();
        socket.emit('request_update');
    </script>
</body>

</html>